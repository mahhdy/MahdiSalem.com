---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import ShareButtons from '../../../components/ShareButtons.astro';
import { t } from '../../../i18n';
import { getCollection, render } from 'astro:content';

const lang = 'en';

export async function getStaticPaths() {
  const statements = await getCollection('statements', ({ data }) => data.lang === 'en' && !data.draft);
  return statements.map((s) => ({ params: { slug: s.id.replace(/^en\//, '') }, props: { entry: s } }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const dateFormatter = new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
const articleUrl = new URL(Astro.url.pathname, Astro.site).toString();

const typeLabels: Record<string, string> = { statement: 'Statement', press: 'Press Release', position: 'Position' };
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <article class="container-narrow py-16">
    <header class="mb-8">
      <div class="flex items-center gap-3 mb-3">
        <span class="text-xs px-2.5 py-1 rounded-full bg-accent/10 text-accent dark:bg-accent-light/10 dark:text-accent-light font-medium">{typeLabels[entry.data.type] ?? entry.data.type}</span>
        <time datetime={entry.data.publishDate.toISOString()} class="text-sm text-text-muted dark:text-text-dark-muted">{dateFormatter.format(entry.data.publishDate)}</time>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold">{entry.data.title}</h1>
    </header>
    <div class="prose"><Content /></div>
    <div class="mt-8 pt-6 border-t border-border dark:border-border-dark">
      <ShareButtons title={entry.data.title} url={articleUrl} lang={lang} />
    </div>
  </article>
</BaseLayout>
