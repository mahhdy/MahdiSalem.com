---
import ArticleLayout from '../../../layouts/ArticleLayout.astro';
import VideoPlayer from '../../../components/VideoPlayer.astro';
import AudioPlayer from '../../../components/AudioPlayer.astro';
import { getCollection, render } from 'astro:content';

const lang = 'en';

export async function getStaticPaths() {
  const multimedia = await getCollection('multimedia', ({ data }) => data.lang === 'en');
  return multimedia.map((item) => ({
    params: { slug: item.id.replace(/^en\//, '') },
    props: { item },
  }));
}

const { item } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(item);
const slug = item.id.replace(/^en\//, '');
---

<ArticleLayout
  title={item.data.title}
  description={item.data.description}
  lang={lang}
  publishDate={item.data.publishDate}
  updatedDate={item.data.updatedDate}
  author={item.data.author}
  categories={item.data.categories}
  tags={item.data.tags}
  coverImage={item.data.coverImage || item.data.thumbnailUrl}
  rawContent={item.body ?? ''}
  slug={slug}
  draft={item.data.draft}
>
  <!-- Media Player Section -->
  <div class="mb-8">
    {item.data.type === 'video' && (
      <VideoPlayer
        videoUrl={item.data.mediaUrl}
        thumbnailUrl={item.data.thumbnailUrl}
        platform={item.data.platform}
        lang={lang}
        title={item.data.title}
      />
    )}

    {(item.data.type === 'audio' || item.data.type === 'podcast') && (
      <AudioPlayer
        audioUrl={item.data.mediaUrl}
        title={item.data.title}
        lang={lang}
        coverImage={item.data.coverImage || item.data.thumbnailUrl}
        platform={item.data.platform}
      />
    )}
  </div>

  <!-- Podcast Info (if podcast) -->
  {item.data.type === 'podcast' && (item.data.episodeNumber || item.data.seasonNumber || item.data.podcastName) && (
    <div class="mb-6 p-4 bg-surface-dim dark:bg-surface-dark-dim rounded-lg border border-border dark:border-border-dark">
      <div class="flex flex-wrap gap-4 text-sm">
        {item.data.podcastName && (
          <div>
            <span class="text-text-muted dark:text-text-dark-muted">Podcast:</span>
            <span class="font-medium ml-2">{item.data.podcastName}</span>
          </div>
        )}
        {item.data.seasonNumber && (
          <div>
            <span class="text-text-muted dark:text-text-dark-muted">Season:</span>
            <span class="font-medium ml-2">{item.data.seasonNumber}</span>
          </div>
        )}
        {item.data.episodeNumber && (
          <div>
            <span class="text-text-muted dark:text-text-dark-muted">Episode:</span>
            <span class="font-medium ml-2">{item.data.episodeNumber}</span>
          </div>
        )}
        {item.data.duration && (
          <div>
            <span class="text-text-muted dark:text-text-dark-muted">Duration:</span>
            <span class="font-medium ml-2">{Math.floor(item.data.duration / 60)} minutes</span>
          </div>
        )}
      </div>
    </div>
  )}

  <!-- Content (Markdown) -->
  <Content />
</ArticleLayout>
