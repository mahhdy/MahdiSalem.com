@import "tailwindcss";

@theme {
  --color-primary: #0d47a1;
  --color-primary-light: #1976d2;
  --color-primary-dark: #0a2f7a;
  --color-secondary: #c9a227;
  --color-secondary-light: #d4b94e;
  --color-accent: #37474f;
  --color-accent-light: #546e7a;
  --color-surface: #ffffff;
  --color-surface-dim: #f5f5f5;
  --color-surface-dark: #0a1117;
  --color-surface-dark-dim: #161b22;
  --color-text-base: #1a1a1a;
  --color-text-muted: #5a5a5a;
  --color-text-dark: #e8e8e8;
  --color-text-dark-muted: #a9a9a9;
  --color-border: #d9d9d9;
  --color-border-dark: #30363d;

  --font-sans: "Vazirmatn", "Inter", ui-sans-serif, system-ui, sans-serif;
  --font-mono: "JetBrains Mono", ui-monospace, monospace;
}

/* Base styles */
@layer base {
  html {
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* RTL default (Persian) */
  html[dir="rtl"] {
    font-family: "Vazirmatn", ui-sans-serif, system-ui, sans-serif;
    line-height: 1.8;
  }

  /* LTR override (English) */
  html[dir="ltr"] {
    font-family: "Inter", ui-sans-serif, system-ui, sans-serif;
    line-height: 1.7;
  }

  /* Dark mode */
  html.dark {
    color-scheme: dark;
  }

  body {
    @apply bg-surface text-text-base transition-colors duration-200;
  }

  html.dark body {
    @apply bg-surface-dark text-text-dark;
  }

  /* Typography */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply font-bold leading-tight;
  }

  h1 {
    @apply text-3xl md:text-4xl;
  }

  h2 {
    @apply text-2xl md:text-3xl;
  }

  h3 {
    @apply text-xl md:text-2xl;
  }

  h4 {
    @apply text-lg md:text-xl;
  }

  a {
    @apply text-primary hover:text-primary-light transition-colors;
  }

  html.dark a {
    @apply text-primary-light hover:text-secondary-light;
  }

  /* Prose styling for article/book content */
  .prose {
    @apply max-w-prose mx-auto;
  }

  .prose p {
    @apply mb-4 leading-relaxed;
    line-height: 1.8;
  }

  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4 {
    @apply font-bold;
    line-height: 1.2;
    margin-bottom: 1rem;
  }

  .prose h1 {
    @apply mt-8 mb-6;
  }

  .prose h2 {
    @apply mt-10 mb-4;
  }

  .prose h3 {
    @apply mt-8 mb-3;
  }

  .prose ul,
  .prose ol {
    @apply mb-4 ps-6;
    line-height: 1.8;
  }

  .prose ul {
    @apply list-disc;
  }

  .prose ol {
    @apply list-decimal;
  }

  .prose li {
    @apply mb-2;
  }

  .prose blockquote {
    @apply border-s-4 border-primary ps-4 my-6 italic text-text-muted;
    background-color: rgba(13, 71, 161, 0.03);
    padding: 1rem;
    border-radius: 4px;
  }

  html.dark .prose blockquote {
    @apply border-primary-light text-text-dark-muted;
    background-color: rgba(25, 118, 210, 0.08);
  }

  .prose code {
    @apply font-mono text-sm px-1.5 py-0.5 rounded;
    background-color: #f5f5f5;
    color: #d32f2f;
  }

  html.dark .prose code {
    @apply bg-surface-dark-dim;
    background-color: rgba(255, 255, 255, 0.1);
    color: #ff6b6b;
  }

  .prose pre {
    @apply p-4 rounded-lg overflow-x-auto mb-4;
    background: #1e293b;
    color: #e2e8f0;
  }

  .prose pre code {
    @apply bg-transparent p-0;
    color: #e2e8f0;
  }

  .prose img {
    @apply rounded-lg my-6;
    max-width: 100%;
    height: auto;
    border: 1px solid var(--color-border);
  }

  html.dark .prose img {
    border-color: var(--color-border-dark);
  }

  .prose hr {
    @apply my-8 border-border;
  }

  html.dark .prose hr {
    @apply border-border-dark;
  }
}

/* ═══════════════════════════════════════════════════════════════ */
/* Component styles - نمودارها و محتوای خاص                        */
/* ═══════════════════════════════════════════════════════════════ */
@layer components {
  /* ─────────────────────────────────────────────────────────────── */
  /* نمودارهای Mermaid                                              */
  /* ─────────────────────────────────────────────────────────────── */
  .mermaid-wrapper {
    direction: ltr !important;
    text-align: center !important;
    margin: 3rem auto;
    padding: 2rem;
    background: #ffffff;
    border-radius: 16px;
    overflow: hidden; /* Changed to hidden, inner .mermaid handles scroll */
    max-height: none; 
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.04),
      0 2px 8px rgba(0, 0, 0, 0.02);
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  html.dark .mermaid-wrapper {
    background: #0f172a;
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .mermaid-wrapper:hover {
    border-color: var(--color-primary-light);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
  }

  /* Toolbar - Glassmorphism */
  .mermaid-toolbar {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 20;
    display: flex;
    gap: 0.75rem;
    opacity: 0.4;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.7);
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }

  .mermaid-wrapper:hover .mermaid-toolbar {
    opacity: 1;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  html.dark .mermaid-toolbar {
    background: rgba(15, 23, 42, 0.6);
    border-color: rgba(255, 255, 255, 0.1);
  }

  html.dark .mermaid-wrapper:hover .mermaid-toolbar {
    background: rgba(15, 23, 42, 0.9);
  }

  .mermaid-zoom-control {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0 0.75rem;
    border-right: 1px solid rgba(0, 0, 0, 0.1);
  }

  html.dark .mermaid-zoom-control {
    border-color: rgba(255, 255, 255, 0.1);
  }

  .mermaid-zoom-slider {
    width: 100px;
    height: 4px;
    cursor: pointer;
    accent-color: var(--color-primary);
    background: #e2e8f0;
    border-radius: 2px;
    appearance: none;
  }

  .mermaid-tool-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1rem;
    color: #475569;
    transition: all 0.2s ease;
  }

  html.dark .mermaid-tool-btn {
    color: #94a3b8;
  }

  .mermaid-tool-btn:hover {
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-primary);
    transform: translateY(-1px);
  }

  html.dark .mermaid-tool-btn:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--color-primary-light);
  }

  .mermaid-tool-btn.active {
    background: var(--color-primary);
    color: white !important;
  }

  html.dark .mermaid-tool-btn.active {
    background: var(--color-primary-light);
    color: #0f172a !important;
  }

  /* Collapsed State - Intelligent clipping */
  .mermaid-wrapper.is-collapsed {
    max-height: 450px !important;
    cursor: pointer;
  }

  .mermaid-wrapper.is-collapsed::after {
    content: "برای مشاهده کامل کلیک کنید";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 120px;
    background: linear-gradient(to bottom, transparent, #ffffff 90%);
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 1.5rem;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-primary);
    pointer-events: none;
    z-index: 15;
    transition: all 0.3s ease;
  }

  html.dark .mermaid-wrapper.is-collapsed::after {
    background: linear-gradient(to bottom, transparent, #0f172a 90%);
    color: var(--color-primary-light);
  }

  .mermaid-wrapper.is-collapsed:hover::after {
    padding-bottom: 2rem;
    color: var(--color-secondary);
  }

  /* Full Screen Overlay - Immersive */
  .mermaid-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(15, 23, 42, 0.95);
    -webkit-backdrop-filter: blur(12px);
    backdrop-filter: blur(12px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: zoom-out;
    animation: mermaidModalFade 0.3s ease;
  }

  @keyframes mermaidModalFade {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .mermaid-modal .mermaid-content {
    background: transparent;
    width: 90vw;
    height: 90vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: auto;
    cursor: grab;
  }

  .mermaid-modal .close-modal {
    position: fixed;
    top: 2rem;
    right: 2.5rem;
    color: white;
    font-size: 3rem;
    cursor: pointer;
    line-height: 1;
    z-index: 2001;
    transition: transform 0.2s ease;
  }

  .mermaid-modal .close-modal:hover {
    transform: scale(1.1);
  }

  .mermaid-wrapper:hover {
    border-color: var(--color-primary-light);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  html.dark .mermaid-wrapper {
    background: #1e293b;
    border-color: #334155;
  }

  /* Ensure the site header background honors dark mode explicitly
     (some browsers or stacking contexts may preserve translucency differently).
     Use a dedicated class so we don't accidentally affect other headers. */
  .site-header {
    --site-header-height: 4rem;
    background-color: rgba(255, 255, 255, 0.8);
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
  }

  html.dark .site-header {
    background-color: rgba(15, 23, 42, 0.8);
  }

  /* Stronger overrides to ensure the header and links honor dark mode
     even when utility classes or stacking contexts apply. */
  .site-header {
    background-color: rgba(255, 255, 255, 0.85) !important;
    --site-header-height: 4rem;
  }

  html.dark .site-header {
    background-color: rgba(15, 23, 42, 0.85) !important;
  }

  /* Force nav link colors inside the header to follow theme. Use
     container-wide selector to target the main nav anchors. */
  .site-header .container-wide a {
    color: var(--color-text-base) !important;
  }

  html.dark .site-header .container-wide a {
    color: var(--color-text-dark) !important;
  }

  /* Ensure mobile menu anchors also follow the same colors */
  .site-header #mobile-menu a {
    color: var(--color-text-base) !important;
  }

  html.dark .site-header #mobile-menu a {
    color: var(--color-text-dark) !important;
  }

  .mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: "Vazirmatn", sans-serif !important;
    overflow: auto;
    position: relative;
    user-select: none;
    padding: 1rem;
    min-height: 200px;
  }

  /* Diagrams with minimum width for legibility */
  .mermaid-type-gantt .mermaid,
  .mermaid-type-timeline .mermaid {
    justify-content: flex-start; /* Key to allow scrolling without centering clipping */
  }

  .mermaid-type-gantt svg,
  .mermaid-type-timeline svg {
    min-width: 1000px; /* Force minimum width for horizontal diagrams */
  }

  .mermaid-type-mindmap svg {
    min-width: 800px;
  }

  /* Rendered by Mermaid.js - Dynamic Scaling */
  .mermaid svg {
    max-width: 100%;
    height: auto;
    display: inline-block;
    transition: transform 0.1s ease-out;
  }

  /* فیکس فونت فارسی در نمودار */
  .mermaid .node text,
  .mermaid .edgeLabel text,
  .mermaid .cluster-label text,
  .mermaid .nodeLabel,
  .mermaid .edgeLabel,
  .mermaid text {
    font-family: "Vazirmatn", sans-serif !important;
  }

  /* رنگ‌های نمودار در حالت تاریک */
  html.dark .mermaid .node rect,
  html.dark .mermaid .node circle,
  html.dark .mermaid .node polygon {
    fill: #334155;
    stroke: #64748b;
  }

  html.dark .mermaid .node text {
    fill: #e2e8f0;
  }

  html.dark .mermaid .edgePath path {
    stroke: #64748b;
  }

  html.dark .mermaid .edgeLabel {
    background-color: #1e293b;
    color: #e2e8f0;
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* MDX Article Components - کامپوننت‌های مقاله                */
  /* ─────────────────────────────────────────────────────────────── */

  /* Comparison Grid - شبکه مقایسه */
  .compare-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin: 2rem 0;
  }

  @media (max-width: 768px) {
    .compare-grid {
      grid-template-columns: 1fr;
    }
  }

  .compare-grid .col {
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid var(--color-border);
  }

  html.dark .compare-grid .col {
    border-color: var(--color-border-dark);
    background: rgba(0, 0, 0, 0.2);
  }

  .compare-grid .right-col {
    background: #f0f4f8;
    border-color: #2e86c1;
  }

  html.dark .compare-grid .right-col {
    background: rgba(46, 134, 193, 0.1);
    border-color: #64748b;
  }

  .compare-grid .left-col {
    background: #fef2f2;
    border-color: #e74c3c;
  }

  html.dark .compare-grid .left-col {
    background: rgba(231, 76, 60, 0.1);
    border-color: #64748b;
  }

  .compare-grid h4 {
    margin-top: 0;
    font-size: 1.125rem;
    margin-bottom: 1rem;
  }

  .compare-grid p,
  .compare-grid ul,
  .compare-grid li {
    margin-bottom: 0.75rem;
  }

  /* Card Component - کادر */
  .card {
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--color-primary);
    background: #f8fafc;
    margin: 1.5rem 0;
    page-break-inside: avoid;
  }

  html.dark .card {
    background: rgba(0, 0, 0, 0.3);
    border-left-color: var(--color-primary-light);
  }

  .card.left {
    border-left-color: #e74c3c;
    background: #fef2f2;
  }

  html.dark .card.left {
    border-left-color: #ff6b6b;
    background: rgba(231, 76, 60, 0.1);
  }

  .card.right {
    border-left-color: #2e86c1;
    background: #f0f4f8;
  }

  html.dark .card.right {
    border-left-color: #74b5f9;
    background: rgba(46, 134, 193, 0.1);
  }

  .card.accent {
    border-left-color: #f5a623;
    background: #fffbeb;
  }

  html.dark .card.accent {
    border-left-color: #fbbf24;
    background: rgba(245, 166, 35, 0.1);
  }

  .card h4 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.125rem;
  }

  .card p {
    margin-bottom: 0.75rem;
  }

  .card p:last-child {
    margin-bottom: 0;
  }

  /* Table Wrapper - جدول‌ها */
  .table-wrapper {
    overflow-x: auto;
    margin: 1.5rem 0;
    border-radius: 8px;
    border: 1px solid var(--color-border);
  }

  html.dark .table-wrapper {
    border-color: var(--color-border-dark);
  }

  .table-wrapper table {
    margin: 0;
  }

  /* Insight Box - کادر یافته */
  .insight {
    background: linear-gradient(
      135deg,
      rgba(41, 128, 185, 0.05) 0%,
      rgba(41, 128, 185, 0.02) 100%
    );
    border: 1px solid #2980b9;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 2rem 0;
    page-break-inside: avoid;
  }

  html.dark .insight {
    background: linear-gradient(
      135deg,
      rgba(41, 128, 185, 0.1) 0%,
      rgba(41, 128, 185, 0.05) 100%
    );
    border-color: #3498db;
  }

  .insight h4 {
    margin-top: 0;
    color: #2980b9;
    font-size: 1.125rem;
    margin-bottom: 1rem;
  }

  html.dark .insight h4 {
    color: #74b5f9;
  }

  .insight p {
    margin-bottom: 0.75rem;
  }

  .insight ul {
    margin: 1rem 0;
    padding-right: 2rem;
  }

  /* Timeline - جدول زمانی */
  .timeline {
    position: relative;
    padding: 2rem 0;
  }

  .timeline-item {
    position: relative;
    padding: 1.5rem 0 1.5rem 4rem;
    margin-bottom: 1.5rem;
    page-break-inside: avoid;
  }

  .timeline-item::before {
    content: "";
    position: absolute;
    left: 0.5rem;
    top: 0.5rem;
    width: 1rem;
    height: 1rem;
    border-radius: 50%;
    background: #2980b9;
    border: 3px solid #f0f4f8;
    z-index: 2;
  }

  html.dark .timeline-item::before {
    border-color: #1e293b;
    background: #3498db;
  }

  .timeline-item::after {
    content: "";
    position: absolute;
    left: 0.9rem;
    top: 2rem;
    width: 2px;
    height: calc(100% + 1.5rem);
    background: #d0d6d9;
    z-index: 1;
  }

  html.dark .timeline-item::after {
    background: #475569;
  }

  .timeline-item:last-child::after {
    display: none;
  }

  .timeline-item.left-event::before {
    background: #e74c3c;
  }

  html.dark .timeline-item.left-event::before {
    background: #ff6b6b;
  }

  .timeline-item.right-event::before {
    background: #2e86c1;
  }

  html.dark .timeline-item.right-event::before {
    background: #74b5f9;
  }

  .timeline-item.mixed-event::before {
    background: #27ae60;
  }

  html.dark .timeline-item.mixed-event::before {
    background: #2ecc71;
  }

  .timeline-date {
    font-weight: 700;
    font-size: 1rem;
    color: var(--color-primary);
    margin-bottom: 0.5rem;
  }

  html.dark .timeline-date {
    color: var(--color-primary-light);
  }

  .timeline-text {
    line-height: 1.6;
  }

  .timeline-text p {
    margin: 0.5rem 0;
  }

  /* Chapter Divider - جدایه فصول */
  .chapter-divider {
    text-align: center;
    margin: 3rem 0;
    padding: 2rem 0;
    border-top: 2px solid var(--color-border);
    border-bottom: 2px solid var(--color-border);
  }

  html.dark .chapter-divider {
    border-color: var(--color-border-dark);
  }

  .chapter-divider span {
    background: var(--color-surface);
    padding: 0 1rem;
    color: var(--color-primary);
    font-weight: 700;
    font-size: 1.125rem;
  }

  html.dark .chapter-divider span {
    background: var(--color-surface-dark);
    color: var(--color-primary-light);
  }

  /* Tags and Badges - برچسب‌ها */
  .tag {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0.25rem 0.5rem 0.25rem 0;
    white-space: nowrap;
  }

  .tag.left {
    background: #fee;
    color: #d32f2f;
    border: 1px solid #f5a5a5;
  }

  .tag.right {
    background: #e3f2fd;
    color: #1976d2;
    border: 1px solid #90caf9;
  }

  .tag.accent {
    background: #fff3e0;
    color: #f57c00;
    border: 1px solid #ffb74d;
  }

  .tag.neutral {
    background: #f5f5f5;
    color: #424242;
    border: 1px solid #bdbdbd;
  }

  .tag.person {
    background: #eceff1;
    color: #0277bd;
    border: 1px solid #81d4fa;
    font-weight: 600;
  }

  .tag.era {
    background: #fde7d6;
    color: #b85c00;
    border: 1px solid #ffb399;
    font-family: "Vazirmatn", sans-serif;
  }

  html.dark .tag.left {
    background: rgba(231, 76, 60, 0.15);
    color: #ff6b6b;
    border-color: #ff6b6b;
  }

  html.dark .tag.right {
    background: rgba(46, 134, 193, 0.15);
    color: #74b5f9;
    border-color: #74b5f9;
  }

  html.dark .tag.accent {
    background: rgba(245, 166, 35, 0.15);
    color: #ffd93d;
    border-color: #ffd93d;
  }

  /* Section Titles - عنوان‌های بخش */
  .chapter {
    margin-top: 2rem;
    margin-bottom: 1.5rem;
    font-size: 1.875rem;
  }

  .section {
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    font-size: 1.375rem;
    color: var(--color-primary);
  }

  html.dark .section {
    color: var(--color-primary-light);
  }

  .subsection {
    font-size: 1.125rem;
    margin-top: 1.25rem;
    margin-bottom: 0.75rem;
    font-weight: 600;
  }

  /* Caption - عنوان پایین نمودار */
  .caption {
    text-align: center;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: 0.5rem;
    font-style: italic;
  }

  html.dark .caption {
    color: var(--color-text-dark-muted);
  }

  /* Typography utilities */
  .subtitle {
    font-size: 1.125rem;
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  html.dark .subtitle {
    color: var(--color-text-dark-muted);
  }

  .meta {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  html.dark .meta {
    color: var(--color-text-dark-muted);
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* Table of Contents (TOC) - فهرست مطالب                         */
  /* ─────────────────────────────────────────────────────────────── */
  .toc {
    background: #f8fafc;
    border: 2px solid var(--color-primary);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 2rem 0;
    page-break-inside: avoid;
  }

  html.dark .toc {
    background: rgba(46, 134, 193, 0.05);
    border-color: var(--color-primary-light);
  }

  .toc h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.375rem;
    color: var(--color-primary);
  }

  html.dark .toc h2 {
    color: var(--color-primary-light);
  }

  .toc details {
    cursor: pointer;
  }

  .toc summary {
    user-select: none;
    padding: 0.5rem;
    margin: -0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s;
  }

  .toc summary:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  html.dark .toc summary:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .toc summary::marker {
    color: var(--color-primary);
  }

  html.dark .toc summary::marker {
    color: var(--color-primary-light);
  }

  .toc ol {
    margin: 1rem 0 0 2rem;
    padding: 0;
  }

  .toc li {
    margin-bottom: 0.5rem;
  }

  .toc a {
    color: var(--color-primary);
    text-decoration: none;
    transition: all 0.2s;
  }

  html.dark .toc a {
    color: var(--color-primary-light);
  }

  .toc a:hover {
    text-decoration: underline;
    opacity: 0.8;
  }

  .toc ul.sub {
    list-style: circle;
    margin-left: 1.5rem;
    margin-top: 0.5rem;
    padding: 0;
  }

  .toc ul.sub li {
    margin-bottom: 0.25rem;
  }

  .toc ul.sub a {
    font-size: 0.95rem;
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* نمودارهای TikZ (SVG تولیدشده)                                  */
  /* ─────────────────────────────────────────────────────────────── */
  .tikz-diagram {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 2rem auto;
    border-radius: 8px;
  }

  figure.tikz-figure {
    text-align: center;
    margin: 2rem 0;
  }

  figure.tikz-figure figcaption {
    font-size: 0.9rem;
    color: var(--color-text-muted);
    margin-top: 0.75rem;
  }

  html.dark figure.tikz-figure figcaption {
    color: var(--color-text-dark-muted);
  }

  /* اینورت برای حالت تاریک */
  html.dark .tikz-diagram {
    filter: invert(0.88) hue-rotate(180deg);
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* جداول - Enhanced Styling                                      */
  /* ─────────────────────────────────────────────────────────────── */
  .prose table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.95rem;
    background: white;
  }

  html.dark .prose table {
    background: var(--color-surface-dark-dim);
  }

  .prose th,
  .prose td {
    border: 1px solid #bdbdbd;
    padding: 1rem;
    text-align: right;
  }

  html.dark .prose th,
  html.dark .prose td {
    border-color: #475569;
  }

  html[dir="ltr"] .prose th,
  html[dir="ltr"] .prose td {
    text-align: left;
  }

  .prose th {
    background: #0d47a1;
    color: white;
    font-weight: 600;
  }

  .prose tr:nth-child(even) {
    background: #fafafa;
  }

  html.dark .prose tr:nth-child(even) {
    background: rgba(255, 255, 255, 0.05);
  }

  .prose tr:nth-child(odd) {
    background: white;
  }

  html.dark .prose tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.02);
  }

  .prose tr:hover {
    background: rgba(13, 71, 161, 0.05);
  }

  html.dark .prose tr:hover {
    background: rgba(25, 118, 210, 0.1);
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* کادرهای ویژه (Callouts/Admonitions)                            */
  /* ─────────────────────────────────────────────────────────────── */
  .prose blockquote.note,
  .prose blockquote.tip,
  .prose blockquote.warning,
  .prose blockquote.danger,
  .prose blockquote.info {
    border-radius: 0 8px 8px 0;
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    font-style: normal;
  }

  html[dir="ltr"] .prose blockquote.note,
  html[dir="ltr"] .prose blockquote.tip,
  html[dir="ltr"] .prose blockquote.warning,
  html[dir="ltr"] .prose blockquote.danger,
  html[dir="ltr"] .prose blockquote.info {
    border-radius: 8px 0 0 8px;
  }

  .prose blockquote.note,
  .prose blockquote.info {
    background: #eff6ff;
    border-color: #3b82f6;
  }

  .prose blockquote.tip {
    background: #f0fdf4;
    border-color: #22c55e;
  }

  .prose blockquote.warning {
    background: #fffbeb;
    border-color: #f59e0b;
  }

  .prose blockquote.danger {
    background: #fef2f2;
    border-color: #ef4444;
  }

  html.dark .prose blockquote.note,
  html.dark .prose blockquote.info {
    background: rgba(59, 130, 246, 0.1);
  }

  html.dark .prose blockquote.tip {
    background: rgba(34, 197, 94, 0.1);
  }

  html.dark .prose blockquote.warning {
    background: rgba(245, 158, 11, 0.1);
  }

  html.dark .prose blockquote.danger {
    background: rgba(239, 68, 68, 0.1);
  }

  /* ─────────────────────────────────────────────────────────────── */
  /* بلوک‌های کد                                                    */
  /* ─────────────────────────────────────────────────────────────── */
  .prose pre {
    direction: ltr !important;
    text-align: left !important;
    background: #1e293b;
    color: #e2e8f0;
  }

  html.dark .prose pre {
    background: #0f172a;
    border: 1px solid #334155;
  }
}

/* Utility classes */
@layer utilities {
  .container-narrow {
    @apply max-w-3xl mx-auto px-4 sm:px-6;
  }

  .container-wide {
    @apply max-w-6xl mx-auto px-4 sm:px-6;
  }

  .container-article {
    @apply max-w-[60rem] mx-auto px-4 sm:px-6;
  }

  /* Primary color utilities */
  .border-primary {
    border-color: var(--color-primary);
  }

  .text-primary {
    color: var(--color-primary);
  }

  .bg-primary {
    background-color: var(--color-primary);
  }

  .ring-primary {
    --tw-ring-color: var(--color-primary);
  }

  /* Primary light variants */
  .border-primary-light {
    border-color: var(--color-primary-light);
  }

  .text-primary-light {
    color: var(--color-primary-light);
  }

  .hover\:border-primary:hover {
    border-color: var(--color-primary);
  }

  .hover\:text-primary:hover {
    color: var(--color-primary);
  }

  .hover\:bg-primary:hover {
    background-color: var(--color-primary);
  }

  .dark\:border-primary-light {
    @media (prefers-color-scheme: dark) {
      border-color: var(--color-primary-light);
    }
  }

  html.dark .dark\:border-primary-light {
    border-color: var(--color-primary-light);
  }

  .dark\:text-primary-light {
    @media (prefers-color-scheme: dark) {
      color: var(--color-primary-light);
    }
  }

  html.dark .dark\:text-primary-light {
    color: var(--color-primary-light);
  }

  .dark\:hover\:border-primary-light:hover {
    @media (prefers-color-scheme: dark) {
      border-color: var(--color-primary-light);
    }
  }

  html.dark .dark\:hover\:border-primary-light:hover {
    border-color: var(--color-primary-light);
  }

  .dark\:hover\:text-primary-light:hover {
    @media (prefers-color-scheme: dark) {
      color: var(--color-primary-light);
    }
  }

  html.dark .dark\:hover\:text-primary-light:hover {
    color: var(--color-primary-light);
  }

  .group:hover .group-hover\:border-primary {
    border-color: var(--color-primary);
  }

  .group:hover .dark\:group-hover\:border-primary-light {
    @media (prefers-color-scheme: dark) {
      border-color: var(--color-primary-light);
    }
  }

  html.dark .group:hover .dark\:group-hover\:border-primary-light {
    border-color: var(--color-primary-light);
  }

  /* Background opacity */
  .bg-primary\/5 {
    background-color: rgb(26 95 122 / 0.05);
  }

  /* Surface colors */
  .bg-surface {
    background-color: var(--color-surface);
  }

  .bg-surface-dim {
    background-color: var(--color-surface-dim);
  }

  .bg-surface-dark {
    background-color: var(--color-surface-dark);
  }

  .bg-surface-dark-dim {
    background-color: var(--color-surface-dark-dim);
  }

  html.dark .dark\:bg-surface-dark {
    background-color: var(--color-surface-dark);
  }

  html.dark .dark\:bg-surface-dark-dim {
    background-color: var(--color-surface-dark-dim);
  }

  /* Text colors */
  .text-text-base {
    color: var(--color-text-base);
  }

  .text-text-muted {
    color: var(--color-text-muted);
  }

  .text-text-dark {
    color: var(--color-text-dark);
  }

  .text-text-dark-muted {
    color: var(--color-text-dark-muted);
  }

  html.dark .dark\:text-text-dark {
    color: var(--color-text-dark);
  }

  html.dark .dark\:text-text-dark-muted {
    color: var(--color-text-dark-muted);
  }

  .group:hover .group-hover\:text-primary {
    color: var(--color-primary);
  }

  html.dark .group:hover .dark\:group-hover\:text-primary-light {
    color: var(--color-primary-light);
  }

  /* Border colors */
  .border-border {
    border-color: var(--color-border);
  }

  .border-border-dark {
    border-color: var(--color-border-dark);
  }

  html.dark .dark\:border-border-dark {
    border-color: var(--color-border-dark);
  }

  .hover\:bg-primary\/10:hover {
    background-color: rgb(26 95 122 / 0.1);
  }

  html.dark .dark\:hover\:bg-primary-light\/10:hover {
    background-color: rgb(41 128 185 / 0.1);
  }

  /* Hover states for surface colors */
  .hover\:bg-surface-dim:hover {
    background-color: var(--color-surface-dim);
  }

  html.dark .dark\:hover\:bg-surface-dark-dim:hover {
    background-color: var(--color-surface-dark-dim);
  }
}

/* =============================================
   Width Toggle — Content Container Sizing
   ============================================= */

/* Base container styles (NOT inside @layer so they have normal specificity) */
.container-article,
.container-wide {
  margin-left: auto;
  margin-right: auto;
  padding-left: 1rem;
  padding-right: 1rem;
  max-width: 56rem;
  /* 896px default */
  width: 100%;
  transition: max-width 0.35s ease-in-out;
}

@media (min-width: 768px) {
  .container-article,
  .container-wide {
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }
}

@media (min-width: 1024px) {
  .container-article,
  .container-wide {
    padding-left: 2rem;
    padding-right: 2rem;
  }
}

/* CSS-driven width overrides via data attribute on <html> */
html[data-content-width="default"] .container-article,
html[data-content-width="default"] .container-wide {
  max-width: 56rem !important;
  /* 896px */
}

html[data-content-width="1024"] .container-article,
html[data-content-width="1024"] .container-wide {
  max-width: 1024px !important;
}

html[data-content-width="1280"] .container-article,
html[data-content-width="1280"] .container-wide {
  max-width: 1280px !important;
}

html[data-content-width="full"] .container-article,
html[data-content-width="full"] .container-wide {
  max-width: 90vw !important;
}

/* Content offset — header only shows on scroll, no permanent offset needed */
.content-with-header {
  margin-top: 0;
}

/* Scroll padding for anchor links when header is visible */
html {
  scroll-padding-top: 4rem;
}

/* Hide width toggle header on very small screens (optional — remove if unwanted) */
@media (max-width: 639px) {
  #width-toggle-header {
    /* Uncomment below to hide on phones: */
    /* display: none !important; */
  }
}

/* =============================================
   Override Tailwind .prose max-width 
   when width toggle is active
   ============================================= */

/* Allow prose content to fill the full container width */
html[data-content-width="1024"] .prose,
html[data-content-width="1280"] .prose,
html[data-content-width="full"] .prose {
  max-width: none !important;
}

/* At default width, keep the nice .prose reading width */

/* =============================================
   Mermaid Enhanced Interactions & Toolbar
   ============================================= */

.mermaid-wrapper {
  position: relative;
  margin: 2rem 0;
  border: 1px solid var(--color-border);
  border-radius: 12px;
  background: white;
  overflow: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

html.dark .mermaid-wrapper {
  background: #0f172a;
  border-color: #334155;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3);
}

/* Auto-collapse styles */
.mermaid-wrapper.is-collapsed {
  max-height: 400px;
}

.mermaid-wrapper.is-collapsed .mermaid {
  mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
  -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
}

/* Toolbar */
.mermaid-toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 16px;
  background: rgba(248, 250, 252, 0.9);
  border-bottom: 1px solid var(--color-border);
  backdrop-filter: blur(4px);
  z-index: 10;
}

html.dark .mermaid-toolbar {
  background: rgba(30, 41, 59, 0.9);
  border-color: #334155;
}

.mermaid-zoom-control {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.mermaid-zoom-slider {
  width: 100px;
  height: 4px;
  border-radius: 2px;
  accent-color: var(--color-primary);
}

.mermaid-tool-btn {
  background: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1.2rem;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mermaid-tool-btn:hover {
  background: rgba(0, 0, 0, 0.05);
  border-color: var(--color-border);
}

html.dark .mermaid-tool-btn:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: #475569;
}

.mermaid-tool-btn.active {
  background: var(--color-primary);
  color: white;
}

/* Pan Mode Active */
.mermaid-wrapper .mermaid {
  transition: transform 0.2s ease-out;
}

/* Modal / Full Screen */
.mermaid-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

.mermaid-modal .mermaid-content {
  background: white;
  width: 95%;
  height: 95%;
  border-radius: 12px;
  overflow: auto;
  padding: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

html.dark .mermaid-modal .mermaid-content {
  background: #0f172a;
}

.close-modal {
  position: absolute;
  top: 1rem;
  right: 1.5rem;
  color: white;
  font-size: 3rem;
  cursor: pointer;
  z-index: 10001;
}

/* =============================================
   Gantt Chart — RTL / Farsi Specific Fixes
   ============================================= */

/* Gantt containers scroll horizontally on small screens */
.mermaid-type-gantt {
  width: 100%;
  max-width: 100%;
  min-width: 600px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.mermaid-type-gantt .mermaid {
  min-width: 750px;
}

.mermaid-type-gantt svg {
  min-width: 700px;
  width: 100% !important;
  height: auto !important;
}

/* RTL task bar text */
.mermaid-type-gantt .taskText,
.mermaid-type-gantt .taskTextOutsideRight,
.mermaid-type-gantt .taskTextOutsideLeft {
  direction: rtl;
  unicode-bidi: bidi-override;
  font-family: 'Vazirmatn', 'Vazir', 'Tahoma', sans-serif !important;
  font-size: 12px !important;
}

/* Section headers */
.mermaid-type-gantt .sectionTitle {
  direction: rtl;
  font-family: 'Vazirmatn', 'Vazir', 'Tahoma', sans-serif !important;
  font-size: 13px !important;
  font-weight: bold;
}

/* Chart title */
.mermaid-type-gantt .titleText {
  direction: rtl;
  font-family: 'Vazirmatn', 'Vazir', 'Tahoma', sans-serif !important;
  font-size: 16px !important;
  font-weight: bold;
}

/* Axis dates — keep LTR */
.mermaid-type-gantt .tick text {
  direction: ltr;
  font-size: 11px;
}

/* Prevent task text from being clipped */
.mermaid-type-gantt .task {
  overflow: visible !important;
}

/* Text outside narrow bars */
.mermaid-type-gantt .taskTextOutsideRight {
  fill: #333 !important;
  font-size: 11px !important;
}

/* Grid lines */
.mermaid-type-gantt .grid .tick line {
  stroke: #e5e7eb;
  stroke-dasharray: 3;
}

/* Dark mode overrides */
html.dark .mermaid-type-gantt .taskTextOutsideRight {
  fill: #e2e8f0 !important;
}
html.dark .mermaid-type-gantt .grid .tick line {
  stroke: #334155;
}

/* Touch-friendly scrollbar */
.mermaid-type-gantt::-webkit-scrollbar {
  height: 8px;
}
.mermaid-type-gantt::-webkit-scrollbar-thumb {
  background: #94a3b8;
  border-radius: 4px;
}

/* =============================================
   All Mermaid Types — Farsi Font Override
   ============================================= */
.mermaid-wrapper svg text,
.mermaid-wrapper svg .label,
.mermaid-wrapper svg .nodeLabel {
  font-family: 'Vazirmatn', 'Vazir', 'Tahoma', sans-serif !important;
}
