% ╔══════════════════════════════════════════════════════════════════╗
% ║  تعریف کادرها و باکس‌های سند — نسخه ۱.۱                         ║
% ╚══════════════════════════════════════════════════════════════════╝

% ============================================================
% کادر ۱: خلاصه‌ی اجرایی فصل
% ============================================================
\newtcolorbox{executivesummary}{
	enhanced,
	breakable,
	colback=PurpleBG,
	colframe=MainPurple,
	coltitle=white,
	fonttitle=\large\bfseries,
	title={\faFile*[regular]\hspace{8pt}خلاصه‌ی اجرایی این فصل},
	arc=3mm,
	boxrule=1.2pt,
	left=8mm,
	right=8mm,
	top=6mm,
	bottom=6mm,
	toptitle=4mm,
	bottomtitle=4mm,
	before skip=15pt,
	after skip=20pt,
	fuzzy shadow={2mm}{-2mm}{0mm}{0.4mm}{black!30},
	watermark text={\faBookOpen},
	watermark opacity=0.05,
	watermark zoom=1.5
}

% ============================================================
% کادر ۲: نکته‌ی کلیدی
% ============================================================
\newtcolorbox{keypoint}[1][]{
	enhanced,
	breakable,
	colback=MainPurple!5,
	colframe=MainPurple,
	coltitle=white,
	fonttitle=\bfseries,
	title={\faKey\hspace{8pt}نکته‌ی کلیدی},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۳: درس آموخته
% ============================================================
\newtcolorbox{lessonlearned}[1][]{
	enhanced,
	breakable,
	colback=BlueBG,
	colframe=MainBlue,
	coltitle=white,
	fonttitle=\bfseries,
	title={\faGraduationCap\hspace{8pt}درس آموخته},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	borderline west={3pt}{0pt}{MainBlue},
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۴: هشدار
% ============================================================
\newtcolorbox{warningbox}[1][]{
	enhanced,
	breakable,
	colback=RedBG,
	colframe=MainRed,
	coltitle=white,
	fonttitle=\bfseries,
	title={\faExclamationTriangle\hspace{8pt}هشدار},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	borderline west={3pt}{0pt}{MainRed},
	overlay unbroken and first={
		\node[
		anchor=north east,
		font=\fontsize{40}{40}\selectfont,
		text=MainRed!10
		] at ([xshift=-5mm, yshift=-5mm]frame.north east) {\faExclamationTriangle};
	},
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۵: توصیه‌ی اجرایی
% ============================================================
\newtcolorbox{recommendation}[1][]{
	enhanced,
	breakable,
	colback=GreenBG,
	colframe=MainGreen,
	coltitle=white,
	fonttitle=\bfseries,
	title={\faCheckCircle\hspace{8pt}توصیه‌ی اجرایی},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	borderline west={3pt}{0pt}{MainGreen},
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۶: سناریو
% ============================================================
\newtcolorbox{scenariobox}[2][]{
	enhanced,
	breakable,
	colback=OrangeBG,
	colframe=MainOrange,
	coltitle=white,
	fonttitle=\bfseries,
	title={\faRoute\hspace{8pt}سناریو: #2},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۷: تعریف
% ============================================================
\newtcolorbox{definitionbox}[2][]{
	enhanced,
	breakable,
	colback=BlueBG,
	colframe=MainBlue!70,
	coltitle=MainBlue!90!black,
	fonttitle=\bfseries,
	title={\faBookOpen\hspace{8pt}تعریف: #2},
	arc=2mm,
	boxrule=0.6pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۸: مطالعه‌ی موردی
% ============================================================
\newtcolorbox{casestudy}[2][]{
	enhanced,
	breakable,
	colback=VeryLightGray,
	colframe=MediumGray,
	coltitle=white,
	colbacktitle=DarkGray,
	fonttitle=\bfseries,
	title={\faGlobe\hspace{8pt}مطالعه‌ی موردی: #2},
	arc=2mm,
	boxrule=0.6pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۹: نقل‌قول برجسته
% ============================================================
\newtcolorbox{pullquote}[1][]{
	enhanced,
	breakable,
	colback=VeryLightGray!50,
	colframe=LightGray,
	boxrule=0pt,
	borderline west={4pt}{0pt}{MainPurple},
	left=12mm,
	right=8mm,
	top=4mm,
	bottom=4mm,
	before skip=12pt,
	after skip=12pt,
	fontupper=\large\color{DarkGray},
	% ✅ اصلاح: \itshape ممکن است با فارسی مشکل داشته باشد
	#1
}

% ============================================================
% کادر ۱۰: نکته‌ی عملیاتی
% ============================================================
\newtcolorbox{operationalnote}[1][]{
	enhanced,
	breakable,
	colback=YellowBG,
	colframe=MainYellow,
	coltitle=DarkYellow!80!black,
	fonttitle=\bfseries,
	title={\faCogs\hspace{8pt}نکته‌ی عملیاتی},
	arc=2mm,
	boxrule=0.8pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۱۱: مقایسه
% ============================================================
\newtcolorbox{comparisonbox}[2][]{
	enhanced,
	breakable,
	colback=GreenBG,
	colframe=MainGreen!70,
	coltitle=DarkGreen,
	fonttitle=\bfseries,
	title={\faBalanceScale\hspace{8pt}مقایسه: #2},
	arc=2mm,
	boxrule=0.6pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% ============================================================
% کادر ۱۲: پرسش تأملی
% ============================================================
\newtcolorbox{reflectionbox}[1][]{
	enhanced,
	breakable,
	colback=PurpleBG,
	colframe=MainPurple!50,
	boxrule=0.4pt,
	borderline south={2pt}{0pt}{MainPurple},
	left=10mm,
	right=6mm,
	top=4mm,
	bottom=4mm,
	before skip=10pt,
	after skip=10pt,
	overlay unbroken and first={
		\node[
		anchor=north west,
		font=\Large,
		text=MainPurple!40
		] at ([xshift=2mm, yshift=-2mm]frame.north west) {\faQuestion};
	},
	#1
}

% ============================================================
% کادر ۱۳: آمار و ارقام
% ============================================================
\newtcolorbox{statsbox}[1][]{
	enhanced,
	colback=white,
	colframe=MainBlue,
	boxrule=1.5pt,
	arc=0pt,
	left=14mm,
	right=6mm,
	top=6mm,
	bottom=6mm,
	before skip=10pt,
	after skip=10pt,
	overlay unbroken and first={
		\fill[MainBlue] 
		(frame.north west) rectangle 
		([xshift=5mm]frame.south west);
		\node[
		anchor=center,
		font=\Large,
		text=white,
		rotate=90
		] at ([xshift=2.5mm]frame.west) {\faChartBar};
	},
	#1
}

% ============================================================
% کادر ۱۴: خلاصه‌ی فصل
% ============================================================
\newtcolorbox{chaptersummary}{
	enhanced,
	breakable,
	colback=VeryLightGray,
	colframe=DarkGray,
	coltitle=white,
	colbacktitle=DarkGray,
	fonttitle=\large\bfseries,
	title={\faList\hspace{8pt}خلاصه‌ی فصل},
	% ✅ اصلاح: faListAlt → faList
	arc=3mm,
	boxrule=0.8pt,
	left=8mm,
	right=8mm,
	top=6mm,
	bottom=6mm,
	before skip=20pt,
	after skip=15pt,
    fuzzy shadow={1mm}{-1mm}{0mm}{0.3mm}{black!20}
}

% ============================================================
% کادر ۱۵: ارجاع به فصل دیگر
% ============================================================
\newtcolorbox{crossref}[1][]{
	enhanced,
	colback=LightPurple!30,
	colframe=MainPurple!30,
	boxrule=0.3pt,
	arc=1mm,
	left=10mm,
	right=4mm,
	top=2mm,
	bottom=2mm,
	before skip=6pt,
	after skip=6pt,
	fontupper=\small,
	overlay unbroken={
		\node[
		anchor=west,
		font=\small,
		text=MainPurple
		] at ([xshift=3mm]frame.west) {\faArrowRight};
		% ✅ اصلاح برای RTL: فلش به سمت راست
	},
	#1
}

% ============================================================
% کادرهای اضافی برای نیازهای خاص
% ============================================================

% کادر ۱۶: نقل‌قول رسمی (با منبع)
\newtcolorbox{formalquote}[2][]{
	enhanced,
	breakable,
	colback=VeryLightGray,
	colframe=VeryLightGray,
	boxrule=0pt,
	borderline west={3pt}{0pt}{MainPurple},
	left=12mm,
	right=8mm,
	top=6mm,
	bottom=6mm,
	before skip=12pt,
	after skip=12pt,
	overlay unbroken and last={
		\node[
		anchor=south east,
		font=\small\color{MediumGray}
		] at ([xshift=-4mm, yshift=4mm]frame.south east) {— #2};
	},
	#1
}

% کادر ۱۷: چک‌لیست
\newtcolorbox{checklistbox}[2][]{
	enhanced,
	breakable,
	colback=GreenBG!50,
	colframe=MainGreen!50,
	coltitle=DarkGreen,
	fonttitle=\bfseries,
	title={\faClipboardCheck\hspace{8pt}#2},
	arc=2mm,
	boxrule=0.5pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}

% کادر ۱۸: زمان‌بندی
\newtcolorbox{timelinebox}[2][]{
	enhanced,
	breakable,
	colback=BlueBG!50,
	colframe=MainBlue!50,
	coltitle=DarkBlue,
	fonttitle=\bfseries,
	title={\faClock\hspace{8pt}#2},
	arc=2mm,
	boxrule=0.5pt,
	left=6mm,
	right=6mm,
	before skip=10pt,
	after skip=10pt,
	#1
}