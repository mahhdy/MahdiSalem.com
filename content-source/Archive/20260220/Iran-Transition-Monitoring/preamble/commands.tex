% ╔══════════════════════════════════════════════════════════════════╗
% ║  دستورات سفارشی سند — نسخه ۱.۱                                  ║
% ║  ⚠️ این فایل باید پس از xepersian بارگذاری شود                  ║
% ╚══════════════════════════════════════════════════════════════════╝

% ============================================================
% دستورات متنی
% ============================================================

% --- دستورات متنی ---
\newcommand{\bilingual}[2]{#1 (\lr{#2})}
\newcommand{\termfn}[2]{#1\LTRfootnote{#2}}
\newcommand{\abbr}[3]{#1 (\lr{#2}; \lr{#3})}
\newcommand{\org}[2]{\textbf{#1} (\lr{\textit{#2}})}
\newcommand{\person}[2]{#1 (\lr{#2})}

% --- تأکید رنگی ---
\newcommand{\emphpurple}[1]{\textbf{\textcolor{MainPurple}{#1}}}
\newcommand{\emphblue}[1]{\textbf{\textcolor{MainBlue}{#1}}}
\newcommand{\emphgreen}[1]{\textbf{\textcolor{MainGreen}{#1}}}
\newcommand{\emphorange}[1]{\textbf{\textcolor{MainOrange}{#1}}}
\newcommand{\emphred}[1]{\textbf{\textcolor{MainRed}{#1}}}
\newcommand{\emphyellow}[1]{\textbf{\textcolor{DarkYellow}{#1}}}

% \newcommand{\statisticfont}{\fontsize{24}{28}\selectfont\bfseries}
% --- هایلایت ---
\newcommand{\highlight}[1]{\colorbox{HighlightGold!50}{#1}}

% ============================================================
% دستورات نمادی و امتیازدهی — اصلاح‌شده
% ============================================================

% --- ستاره‌های امتیاز (۱ تا ۵) ---
% ✅ بازنویسی کامل بدون \foreach و \numexpr مشکل‌دار
\newcommand{\starrating}[1]{%
	\ifcase#1\relax
	% 0 ستاره
	\textcolor{LightGray}{☆☆☆☆☆}%
	\or
	% 1 ستاره
	\textcolor{MainYellow}{★}\textcolor{LightGray}{☆☆☆☆}%
	\or
	% 2 ستاره
	\textcolor{MainYellow}{★★}\textcolor{LightGray}{☆☆☆}%
	\or
	% 3 ستاره
	\textcolor{MainYellow}{★★★}\textcolor{LightGray}{☆☆}%
	\or
	% 4 ستاره
	\textcolor{MainYellow}{★★★★}\textcolor{LightGray}{☆}%
	\or
	% 5 ستاره
	\textcolor{MainYellow}{★★★★★}%
	\fi
}

% --- دایره‌های امتیاز (۱ تا ۵) ---
\newcommand{\circlerating}[1]{%
	\ifcase#1\relax
	\textcolor{LightGray}{○○○○○}%
	\or
	\textcolor{MainBlue}{●}\textcolor{LightGray}{○○○○}%
	\or
	\textcolor{MainBlue}{●●}\textcolor{LightGray}{○○○}%
	\or
	\textcolor{MainBlue}{●●●}\textcolor{LightGray}{○○}%
	\or
	\textcolor{MainBlue}{●●●●}\textcolor{LightGray}{○}%
	\or
	\textcolor{MainBlue}{●●●●●}%
	\fi
}
% ✅ دستور rating که در فصول استفاده شده
\newcommand{\rating}[1]{%
	\ifcase#1\relax
	\textcolor{LightGray}{○○○○○}%
	\or
	\textcolor{MainPurple}{●}\textcolor{LightGray}{○○○○}%
	\or
	\textcolor{MainPurple}{●●}\textcolor{LightGray}{○○○}%
	\or
	\textcolor{MainPurple}{●●●}\textcolor{LightGray}{○○}%
	\or
	\textcolor{MainPurple}{●●●●}\textcolor{LightGray}{○}%
	\or
	\textcolor{MainPurple}{●●●●●}%
	\fi
}

% --- نشانگرهای وضعیت ---
\newcommand{\statusok}{\textcolor{MainGreen}{\faCheckCircle}}
\newcommand{\statuswarn}{\textcolor{MainOrange}{\faExclamationCircle}}
\newcommand{\statusbad}{\textcolor{MainRed}{\faTimesCircle}}
\newcommand{\statuspending}{\textcolor{MediumGray}{\faClock}}
\newcommand{\statusquestion}{\textcolor{MainBlue}{\faQuestionCircle}}

% --- تیک و ضربدر ---
\newcommand{\cmark}{\textcolor{MainGreen}{\ding{51}}}
\newcommand{\xmark}{\textcolor{MainRed}{\ding{55}}}
\newcommand{\qmark}{\textcolor{MainOrange}{\ding{73}}}

% --- سطح ریسک ---
\newcommand{\riskhigh}{\textcolor{MainRed}{\faArrowUp\ بالا}}
\newcommand{\riskmedium}{\textcolor{MainOrange}{\faMinus\ متوسط}}
\newcommand{\risklow}{\textcolor{MainGreen}{\faArrowDown\ پایین}}
% ✅ اصلاح: \faArrowLeft → \faMinus برای «متوسط»

% --- فلش‌های رنگی ---
\newcommand{\arrowup}{\textcolor{MainGreen}{\faArrowUp}}
\newcommand{\arrowdown}{\textcolor{MainRed}{\faArrowDown}}
\newcommand{\arrowflat}{\textcolor{MainOrange}{\faMinus}}

% --- نمادهای چراغ راهنما ---
\newcommand{\lightgreen}{\textcolor{MainGreen}{\faCircle}}
\newcommand{\lightyellow}{\textcolor{MainYellow}{\faCircle}}
\newcommand{\lightred}{\textcolor{MainRed}{\faCircle}}
\newcommand{\lightgray}{\textcolor{LightGray}{\faCircle}}

% ============================================================
% دستورات ساختاری
% ============================================================

% --- صفحه‌ی آغازین فصل ---
\newcommand{\chapteropening}[5]{%
	% #1 = شماره فصل (فارسی یا عربی)
	% #2 = عنوان فصل
	% #3 = رنگ فصل
	% #4 = نقل‌قول
	% #5 = منبع نقل‌قول
	\clearpage
	\thispagestyle{empty}
	\begin{tikzpicture}[remember picture, overlay]
		% پس‌زمینه
		\fill[#3!8] 
		(current page.south west) rectangle 
		(current page.north east);
		
		% نوار بالایی
		\fill[#3] 
		([yshift=-4cm]current page.north west) rectangle 
		(current page.north east);
		
		% شماره فصل بزرگ
		\node[
		anchor=north east,
		font=\fontsize{100}{100}\selectfont\bfseries,
		text=#3!20
		] at ([xshift=-1cm, yshift=-0.3cm]current page.north east) 
		{#1};
		
		% «فصل»
		\node[
		anchor=north west,
		font=\Large,
		text=white!90
		] at ([xshift=2cm, yshift=-1cm]current page.north west) 
		{فصل};
		
		% عنوان فصل
		\node[
		anchor=north west,
		font=\fontsize{24}{30}\selectfont\bfseries,
		text=white,
		text width=13cm,
		align=right
		] at ([xshift=2cm, yshift=-2cm]current page.north west) 
		{#2};
		
		% خط تزئینی
		\draw[white, line width=1.5pt] 
		([yshift=-4.2cm, xshift=2cm]current page.north west) -- 
		([yshift=-4.2cm, xshift=7cm]current page.north west);
		
		% نقل‌قول
		\node[
		anchor=center,
		text width=12cm,
		align=center,
		font=\large,
		text=#3!70!black
		] at ([yshift=0.5cm]current page.center) 
		{«#4»};
		
		% منبع نقل‌قول
		\node[
		anchor=center,
		font=\normalsize,
		text=#3!50!black
		] at ([yshift=-1.5cm]current page.center) 
		{— #5};
		
		% نوار پایینی
		\fill[#3!50] 
		(current page.south west) rectangle 
		([yshift=0.4cm]current page.south east);
		
	\end{tikzpicture}
	\clearpage
}

% --- نسخه ساده‌تر برای تست ---
\newcommand{\chapteropeningsimple}[2]{%
	% #1 = شماره فصل
	% #2 = عنوان فصل
	\clearpage
	\thispagestyle{empty}
	\vspace*{3cm}
	\begin{center}
		{\fontsize{60}{60}\selectfont\textcolor{MainPurple!30}{#1}}\\[1cm]
		{\huge\bfseries\textcolor{MainPurple}{#2}}
	\end{center}
	\vfill
	\clearpage
}

% --- خلاصه اجرایی سریع ---
\newcommand{\inlinesummary}[1]{%
	\begin{tcolorbox}[
		enhanced,
		colback=PurpleBG!50,
		colframe=MainPurple!30,
		boxrule=0.3pt,
		arc=1mm,
		left=4mm,
		right=4mm,
		top=2mm,
		bottom=2mm
		]
		\small\textcolor{DarkGray}{#1}
	\end{tcolorbox}
}

% --- جداکننده‌ی بخش‌ها ---
\newcommand{\sectiondivider}{%
	\begin{center}
		\vspace{6pt}
		\textcolor{LightGray}{\rule{0.35\textwidth}{0.4pt}}%
		\hspace{6pt}%
		\textcolor{MainPurple}{◆}%
		\hspace{6pt}%
		\textcolor{LightGray}{\rule{0.35\textwidth}{0.4pt}}
		\vspace{6pt}
	\end{center}
}

% --- پایان فصل ---
\newcommand{\chapterend}{%
	\vfill
	\begin{center}
		\textcolor{MainPurple}{\rule{2.5cm}{0.8pt}}\\[4pt]
		\textcolor{MainPurple}{\faBookOpen}\\[4pt]
		\textcolor{MainPurple}{\rule{2.5cm}{0.8pt}}
	\end{center}
	\clearpage
}

% ============================================================
% دستورات جدولی
% ============================================================

% --- فونت‌های جدول ---
\newcommand{\tablefontsize}{\small}
\newcommand{\bigtablefontsize}{\footnotesize}
\newcommand{\hugetablefontsize}{\scriptsize}

% --- چرخش عنوان ستون ---
\newcommand{\rot}[1]{\rotatebox{60}{\parbox{2.5cm}{\raggedleft #1}}}
\newcommand{\rotsmall}[1]{\rotatebox{60}{\parbox{2cm}{\raggedleft\footnotesize #1}}}

% --- سطرهای رنگی ---
\newcommand{\headerrow}{\rowcolor{TableHeaderBG}}
\newcommand{\altrow}{\rowcolor{TableAltRow}}

% --- سلول‌های رنگی ---
\newcommand{\cellgreen}[1]{\cellcolor{GreenBG}#1}
\newcommand{\cellred}[1]{\cellcolor{RedBG}#1}
\newcommand{\cellorange}[1]{\cellcolor{OrangeBG}#1}
\newcommand{\cellyellow}[1]{\cellcolor{YellowBG}#1}
\newcommand{\cellblue}[1]{\cellcolor{BlueBG}#1}
\newcommand{\cellpurple}[1]{\cellcolor{PurpleBG}#1}

% ============================================================
% دستورات ارجاعی
% ============================================================

% --- دستورات ارجاعی ---
\newcommand{\seeChapter}[1]{{\small\textcolor{MainPurple}{\faArrowLeft\ رجوع شود به فصل~\ref{#1}}}}
\newcommand{\seeAppendix}[1]{{\small\textcolor{MainPurple}{\faArrowLeft\ رجوع شود به پیوست~\ref{#1}}}}
\newcommand{\seeTable}[1]{{\small\textcolor{MainBlue}{← جدول~\ref{#1}}}}
\newcommand{\seeFigure}[1]{{\small\textcolor{MainBlue}{← شکل~\ref{#1}}}}
\newcommand{\seePage}[1]{{\small\textcolor{MediumGray}{(صفحه~\pageref{#1})}}}

% ============================================================
% دستورات عددی و تاریخی
% ============================================================

% --- عدد با جداکننده هزارگان ---
\newcommand{\numfa}[1]{%
	\persiandigits{#1}%
}

% --- درصد ---
\newcommand{\pct}[1]{%
	\lr{#1\%}%
}

% --- سال میلادی ---
\newcommand{\yearce}[1]{%
	\lr{#1}%
}

% --- بازه زمانی ---
\newcommand{\daterange}[2]{%
	\lr{#1}–\lr{#2}%
}

% ============================================================
% ✅ minitoc جایگزین (اگر بسته minitoc بارگذاری نشده)
% ============================================================
% \newcommand{\minitoc}{}  % دستور خالی برای جلوگیری از خطا
%\newcommand{\dominitoc}{} % دستور خالی برای جلوگیری از خطا

% یا اگر می‌خواهید متن جایگزین نشان دهد:
% \newcommand{\minitoc}{\textit{فهرست مطالب این فصل در اینجا قرار می‌گیرد.}\par\vspace{1em}}
