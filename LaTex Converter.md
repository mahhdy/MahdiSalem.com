
Ù…Ù† Ø®Ø±ÙˆØ¬ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ Ø±Ø§ Ø¨Ù‡ Ù…Ø¯Ù„ Ø²Ø¨Ø§Ù†ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø®ÙˆØ¯Ù… Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù…! 

# Ø®Ù„Ø§ØµÙ‡ Ø±Ø§Ù‡ Ø­Ù„ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¢Ù†
# Ø³ÛŒØ³ØªÙ… Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…Ø­ØªÙˆØ§ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Preamble

## ğŸ¯ Ø¯Ø±Ú© Ø¯Ù‚ÛŒÙ‚ Ù†ÛŒØ§Ø² Ø´Ù…Ø§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ú†Ø§Ù„Ø´ ÙˆØ§Ù‚Ø¹ÛŒ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ“š Ú©ØªØ§Ø¨ A          ğŸ“š Ú©ØªØ§Ø¨ B          ğŸ“š Ú©ØªØ§Ø¨ C               â”‚
â”‚  â”œâ”€ ÙÙˆÙ†Øª: Vazir     â”œâ”€ ÙÙˆÙ†Øª: Sahel     â”œâ”€ ÙÙˆÙ†Øª: Samim         â”‚
â”‚  â”œâ”€ Ø±Ù†Ú¯: Ø¢Ø¨ÛŒ/Ù‚Ø±Ù…Ø²   â”œâ”€ Ø±Ù†Ú¯: Ø³Ø¨Ø²/Ø·Ù„Ø§ÛŒÛŒ  â”œâ”€ Ø±Ù†Ú¯: Ø¨Ù†ÙØ´/Ù†Ø§Ø±Ù†Ø¬ÛŒ   â”‚
â”‚  â””â”€ Ø§Ø³ØªØ§ÛŒÙ„ TikZ A   â””â”€ Ø§Ø³ØªØ§ÛŒÙ„ TikZ B   â””â”€ Ø§Ø³ØªØ§ÛŒÙ„ TikZ C       â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚  Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ¨Ø¯ÛŒÙ„    â”‚                        â”‚
â”‚              â”‚  (Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø²   â”‚                        â”‚
â”‚              â”‚   Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø¯Ø³ØªÛŒ)       â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚     ÙˆØ¨â€ŒØ³Ø§ÛŒØª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡     â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ù…Ø¹Ù…Ø§Ø±ÛŒ Content Pipeline                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚   â”‚ Ù…Ù†Ø¨Ø¹ Ù…Ø­ØªÙˆØ§  â”‚ â† LaTeX, Markdown, PDF                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚          â”‚                                                        â”‚
â”‚          â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚         Û±. Content Analyzer             â”‚                   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚   â”‚  â”‚  Preamble   â”‚  â”‚   Style         â”‚  â”‚                   â”‚
â”‚   â”‚  â”‚  Parser     â”‚  â”‚   Extractor     â”‚  â”‚                   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚         Û². Config Generator             â”‚                   â”‚
â”‚   â”‚  â€¢ ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø± Ú©ØªØ§Ø¨        â”‚                   â”‚
â”‚   â”‚  â€¢ Ù†Ú¯Ø§Ø´Øª Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ù‡ CSS                  â”‚                   â”‚
â”‚   â”‚  â€¢ ØªØ´Ø®ÛŒØµ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§                        â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚         Û³. Smart Renderer               â”‚                   â”‚
â”‚   â”‚  â€¢ TikZ â†’ SVG (Ø¨Ø§ Ø§Ø³ØªØ§ÛŒÙ„ ØµØ­ÛŒØ­)         â”‚                   â”‚
â”‚   â”‚  â€¢ Tables â†’ HTML                        â”‚                   â”‚
â”‚   â”‚  â€¢ Math â†’ KaTeX                         â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚         Û´. Output Generator             â”‚                   â”‚
â”‚   â”‚  â€¢ Markdown + Frontmatter               â”‚                   â”‚
â”‚   â”‚  â€¢ CSS Variables                        â”‚                   â”‚
â”‚   â”‚  â€¢ Asset Management                     â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø§Ù…Ù„

```
your-site/
â”œâ”€â”€ content-source/                    # Ù…Ù†Ø§Ø¨Ø¹ Ø§ØµÙ„ÛŒ (Ø¯Ø³Øª Ù†Ø²Ù†ÛŒØ¯!)
â”‚   â”œâ”€â”€ books/
â”‚   â”‚   â”œâ”€â”€ transition-guide/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.tex              # ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø§ preamble
â”‚   â”‚   â”‚   â”œâ”€â”€ preamble.tex          # ÛŒØ§ preamble Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
â”‚   â”‚   â”‚   â”œâ”€â”€ chapters/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ch01.tex
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ch02.tex
â”‚   â”‚   â”‚   â””â”€â”€ images/
â”‚   â”‚   â””â”€â”€ another-book/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ articles/
â”‚       â”œâ”€â”€ article1.tex
â”‚       â””â”€â”€ article2.md               # Markdown Ù‡Ù… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´ÙˆØ¯
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ lib/                          # Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
â”‚   â”‚   â”œâ”€â”€ preamble-parser.mjs       # ØªØ­Ù„ÛŒÙ„ preamble
â”‚   â”‚   â”œâ”€â”€ style-extractor.mjs       # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§
â”‚   â”‚   â”œâ”€â”€ tikz-renderer.mjs         # Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
â”‚   â”‚   â”œâ”€â”€ markdown-processor.mjs    # Ù¾Ø±Ø¯Ø§Ø²Ø´ Markdown
â”‚   â”‚   â””â”€â”€ config-generator.mjs      # ØªÙˆÙ„ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
â”‚   â”‚
â”‚   â”œâ”€â”€ process-content.mjs           # Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ
â”‚   â””â”€â”€ watch-content.mjs             # Ù…Ø§Ù†ÛŒØªÙˆØ± ØªØºÛŒÛŒØ±Ø§Øª
â”‚
â”œâ”€â”€ .content-cache/                    # Ú©Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±
â”‚   â”œâ”€â”€ configs/                      # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬â€ŒØ´Ø¯Ù‡
â”‚   â”‚   â”œâ”€â”€ transition-guide.json
â”‚   â”‚   â””â”€â”€ another-book.json
â”‚   â”œâ”€â”€ diagrams/                     # SVG Ù‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡
â”‚   â””â”€â”€ checksums.json                # Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ ØªØºÛŒÛŒØ±Ø§Øª
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content/                      # Ø®Ø±ÙˆØ¬ÛŒ ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡
â”‚   â”‚   â”œâ”€â”€ books/
â”‚   â”‚   â””â”€â”€ articles/
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ book-themes/              # CSS Ù‡Ø± Ú©ØªØ§Ø¨ (Ø®ÙˆØ¯Ú©Ø§Ø±)
â”‚   â”‚       â”œâ”€â”€ transition-guide.css
â”‚   â”‚       â””â”€â”€ another-book.css
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ package.json
```

---

## ğŸ§  Ù…Ø§Ú˜ÙˆÙ„ Û±: Preamble Parser

**ÙØ§ÛŒÙ„ `scripts/lib/preamble-parser.mjs`:**

```javascript
/**
 * ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Preamble
 * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ LaTeX
 */

import fs from 'fs/promises';
import path from 'path';

export class PreambleParser {
  constructor() {
    // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Regex Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬
    this.patterns = {
      // Ø±Ù†Ú¯â€ŒÙ‡Ø§
      defineColor: /\\definecolor\{(\w+)\}\{(\w+)\}\{([^}]+)\}/g,
      colorlet: /\\colorlet\{(\w+)\}\{([^}]+)\}/g,
      
      // ÙÙˆÙ†Øªâ€ŒÙ‡Ø§
      setMainFont: /\\setmainfont(?:\[([^\]]*)\])?\{([^}]+)\}/g,
      setFont: /\\set(\w+)font(?:\[([^\]]*)\])?\{([^}]+)\}/g,
      newFontFamily: /\\newfontfamily\\(\w+)(?:\[([^\]]*)\])?\{([^}]+)\}/g,
      
      // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ TikZ
      tikzLibrary: /\\usetikzlibrary\{([^}]+)\}/g,
      pgfplotsLibrary: /\\usepgfplotslibrary\{([^}]+)\}/g,
      
      // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TikZ
      tikzStyle: /\\tikzstyle\{(\w+)\}\s*=\s*\[([^\]]+)\]/g,
      tikzSet: /\\tikzset\{([^}]+)\}/g,
      
      // Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§
      usePackage: /\\usepackage(?:\[([^\]]*)\])?\{([^}]+)\}/g,
      
      // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ
      newCommand: /\\newcommand\{\\(\w+)\}(?:\[(\d+)\])?\{([^}]+)\}/g,
      renewCommand: /\\renewcommand\{\\(\w+)\}(?:\[(\d+)\])?\{([^}]+)\}/g,
      
      // input/include
      input: /\\input\{([^}]+)\}/g,
      include: /\\include\{([^}]+)\}/g,
    };
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ Ú©Ø§Ù…Ù„ ÛŒÚ© Ù¾Ø±ÙˆÚ˜Ù‡ LaTeX
   */
  async analyzeProject(projectDir) {
    console.log(`\nğŸ” ØªØ­Ù„ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡: ${projectDir}`);
    
    const config = {
      projectDir,
      colors: {},
      fonts: {
        main: null,
        sans: null,
        mono: null,
        custom: {}
      },
      tikz: {
        libraries: new Set(),
        styles: {},
        pgfplotsLibraries: new Set()
      },
      packages: [],
      customCommands: {},
      dependencies: []
    };

    // ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ
    const mainFile = await this.findMainFile(projectDir);
    if (!mainFile) {
      throw new Error(`ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ LaTeX Ø¯Ø± ${projectDir} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
    }

    console.log(`   ğŸ“„ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ: ${mainFile}`);

    // ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ú¯Ø´ØªÛŒ
    await this.parseFileRecursive(mainFile, config, new Set());

    // Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ
    config.tikz.libraries = Array.from(config.tikz.libraries);
    config.tikz.pgfplotsLibraries = Array.from(config.tikz.pgfplotsLibraries);

    console.log(`   ğŸ¨ Ø±Ù†Ú¯â€ŒÙ‡Ø§: ${Object.keys(config.colors).length}`);
    console.log(`   ğŸ”¤ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§: ${Object.keys(config.fonts.custom).length + (config.fonts.main ? 1 : 0)}`);
    console.log(`   ğŸ“Š Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ TikZ: ${config.tikz.libraries.length}`);

    return config;
  }

  /**
   * ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
   */
  async findMainFile(projectDir) {
    const candidates = [
      'main.tex',
      'book.tex', 
      'index.tex',
      'document.tex'
    ];

    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…
    for (const candidate of candidates) {
      const filePath = path.join(projectDir, candidate);
      try {
        await fs.access(filePath);
        return filePath;
      } catch {}
    }

    // Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„ Ø¨Ø§ \documentclass
    const texFiles = await this.findTexFiles(projectDir);
    for (const file of texFiles) {
      const content = await fs.readFile(file, 'utf-8');
      if (content.includes('\\documentclass')) {
        return file;
      }
    }

    return null;
  }

  /**
   * ÛŒØ§ÙØªÙ† Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ .tex
   */
  async findTexFiles(dir) {
    const files = [];
    const entries = await fs.readdir(dir, { withFileTypes: true });
    
    for (const entry of entries) {
      const fullPath = path.join(dir, entry.name);
      if (entry.isDirectory() && !entry.name.startsWith('.')) {
        files.push(...await this.findTexFiles(fullPath));
      } else if (entry.isFile() && entry.name.endsWith('.tex')) {
        files.push(fullPath);
      }
    }
    
    return files;
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ú¯Ø´ØªÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
   */
  async parseFileRecursive(filePath, config, visited) {
    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª
    const absPath = path.resolve(filePath);
    if (visited.has(absPath)) return;
    visited.add(absPath);

    let content;
    try {
      content = await fs.readFile(filePath, 'utf-8');
    } catch (error) {
      console.warn(`   âš ï¸ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯: ${filePath}`);
      return;
    }

    const baseDir = path.dirname(filePath);

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
    this.extractColors(content, config);
    this.extractFonts(content, config);
    this.extractTikzConfig(content, config);
    this.extractPackages(content, config);
    this.extractCustomCommands(content, config);

    // Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø¨Ø³ØªÙ‡
    const dependencies = this.extractDependencies(content, baseDir);
    for (const dep of dependencies) {
      config.dependencies.push(dep);
      await this.parseFileRecursive(dep, config, visited);
    }
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§
   */
  extractColors(content, config) {
    // \definecolor{name}{model}{spec}
    let match;
    const defineColorRegex = new RegExp(this.patterns.defineColor.source, 'g');
    while ((match = defineColorRegex.exec(content)) !== null) {
      const [, name, model, spec] = match;
      config.colors[name] = this.parseColor(model, spec);
    }

    // \colorlet{name}{color}
    const colorletRegex = new RegExp(this.patterns.colorlet.source, 'g');
    while ((match = colorletRegex.exec(content)) !== null) {
      const [, name, baseColor] = match;
      config.colors[name] = { type: 'reference', base: baseColor };
    }
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø±Ù†Ú¯ LaTeX Ø¨Ù‡ CSS
   */
  parseColor(model, spec) {
    switch (model.toLowerCase()) {
      case 'rgb':
        // RGB Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± 0-1
        const rgbParts = spec.split(',').map(v => Math.round(parseFloat(v.trim()) * 255));
        return {
          type: 'rgb',
          r: rgbParts[0],
          g: rgbParts[1],
          b: rgbParts[2],
          css: `rgb(${rgbParts.join(', ')})`
        };
      
      case 'RGB':
        // RGB Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± 0-255
        const RGBParts = spec.split(',').map(v => parseInt(v.trim()));
        return {
          type: 'rgb',
          r: RGBParts[0],
          g: RGBParts[1],
          b: RGBParts[2],
          css: `rgb(${RGBParts.join(', ')})`
        };
      
      case 'HTML':
      case 'hex':
        return {
          type: 'hex',
          css: `#${spec.replace('#', '')}`
        };
      
      case 'cmyk':
        const cmykParts = spec.split(',').map(v => parseFloat(v.trim()));
        const rgb = this.cmykToRgb(...cmykParts);
        return {
          type: 'cmyk',
          original: spec,
          css: `rgb(${rgb.join(', ')})`
        };
      
      default:
        return { type: 'named', name: spec, css: spec };
    }
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ CMYK Ø¨Ù‡ RGB
   */
  cmykToRgb(c, m, y, k) {
    const r = Math.round(255 * (1 - c) * (1 - k));
    const g = Math.round(255 * (1 - m) * (1 - k));
    const b = Math.round(255 * (1 - y) * (1 - k));
    return [r, g, b];
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙÙˆÙ†Øª
   */
  extractFonts(content, config) {
    let match;

    // \setmainfont
    const mainFontRegex = new RegExp(this.patterns.setMainFont.source, 'g');
    while ((match = mainFontRegex.exec(content)) !== null) {
      const [, options, fontName] = match;
      config.fonts.main = {
        name: fontName,
        options: this.parseOptions(options)
      };
    }

    // \setsansfont, \setmonofont
    const setFontRegex = new RegExp(this.patterns.setFont.source, 'g');
    while ((match = setFontRegex.exec(content)) !== null) {
      const [, type, options, fontName] = match;
      const key = type.toLowerCase();
      if (key === 'sans' || key === 'mono') {
        config.fonts[key] = {
          name: fontName,
          options: this.parseOptions(options)
        };
      }
    }

    // \newfontfamily
    const newFontRegex = new RegExp(this.patterns.newFontFamily.source, 'g');
    while ((match = newFontRegex.exec(content)) !== null) {
      const [, commandName, options, fontName] = match;
      config.fonts.custom[commandName] = {
        name: fontName,
        options: this.parseOptions(options)
      };
    }
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙ†Ø¸ÛŒÙ…Ø§Øª TikZ
   */
  extractTikzConfig(content, config) {
    let match;

    // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ TikZ
    const tikzLibRegex = new RegExp(this.patterns.tikzLibrary.source, 'g');
    while ((match = tikzLibRegex.exec(content)) !== null) {
      const libs = match[1].split(',').map(l => l.trim());
      libs.forEach(lib => config.tikz.libraries.add(lib));
    }

    // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ pgfplots
    const pgfLibRegex = new RegExp(this.patterns.pgfplotsLibrary.source, 'g');
    while ((match = pgfLibRegex.exec(content)) !== null) {
      const libs = match[1].split(',').map(l => l.trim());
      libs.forEach(lib => config.tikz.pgfplotsLibraries.add(lib));
    }

    // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TikZ - Ø±ÙˆØ´ Ù‚Ø¯ÛŒÙ…ÛŒ
    const tikzStyleRegex = new RegExp(this.patterns.tikzStyle.source, 'g');
    while ((match = tikzStyleRegex.exec(content)) !== null) {
      const [, name, definition] = match;
      config.tikz.styles[name] = definition;
    }

    // \tikzset
    const tikzSetRegex = new RegExp(this.patterns.tikzSet.source, 'g');
    while ((match = tikzSetRegex.exec(content)) !== null) {
      const definitions = match[1];
      this.parseTikzSet(definitions, config.tikz.styles);
    }
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ \tikzset
   */
  parseTikzSet(definitions, styles) {
    // ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø¯Ù‡ - Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ± Ú©Ø±Ø¯
    const styleRegex = /(\w+)\/\.style\s*=\s*\{([^}]+)\}/g;
    let match;
    while ((match = styleRegex.exec(definitions)) !== null) {
      styles[match[1]] = match[2];
    }
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§
   */
  extractPackages(content, config) {
    const packageRegex = new RegExp(this.patterns.usePackage.source, 'g');
    let match;
    while ((match = packageRegex.exec(content)) !== null) {
      const [, options, packages] = match;
      const pkgList = packages.split(',').map(p => p.trim());
      for (const pkg of pkgList) {
        config.packages.push({
          name: pkg,
          options: options ? options.split(',').map(o => o.trim()) : []
        });
      }
    }
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø³ÙØ§Ø±Ø´ÛŒ
   */
  extractCustomCommands(content, config) {
    const patterns = [this.patterns.newCommand, this.patterns.renewCommand];
    
    for (const pattern of patterns) {
      const regex = new RegExp(pattern.source, 'g');
      let match;
      while ((match = regex.exec(content)) !== null) {
        const [, name, numArgs, definition] = match;
        config.customCommands[name] = {
          args: numArgs ? parseInt(numArgs) : 0,
          definition: definition
        };
      }
    }
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
   */
  extractDependencies(content, baseDir) {
    const deps = [];
    const patterns = [this.patterns.input, this.patterns.include];
    
    for (const pattern of patterns) {
      const regex = new RegExp(pattern.source, 'g');
      let match;
      while ((match = regex.exec(content)) !== null) {
        let depPath = match[1];
        if (!depPath.endsWith('.tex')) {
          depPath += '.tex';
        }
        deps.push(path.resolve(baseDir, depPath));
      }
    }
    
    return deps;
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ options
   */
  parseOptions(optionsStr) {
    if (!optionsStr) return {};
    
    const options = {};
    const parts = optionsStr.split(',');
    
    for (const part of parts) {
      const [key, value] = part.split('=').map(s => s.trim());
      options[key] = value || true;
    }
    
    return options;
  }
}

export default PreambleParser;
```

---

## ğŸ¨ Ù…Ø§Ú˜ÙˆÙ„ Û²: CSS Generator

**ÙØ§ÛŒÙ„ `scripts/lib/style-generator.mjs`:**

```javascript
/**
 * ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± CSS Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª LaTeX
 */

import fs from 'fs/promises';
import path from 'path';

export class StyleGenerator {
  constructor(outputDir = 'src/styles/book-themes') {
    this.outputDir = outputDir;
  }

  /**
   * ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ CSS Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ú©ØªØ§Ø¨
   */
  async generateCSS(config, bookSlug) {
    const css = this.buildCSS(config, bookSlug);
    
    await fs.mkdir(this.outputDir, { recursive: true });
    const outputPath = path.join(this.outputDir, `${bookSlug}.css`);
    await fs.writeFile(outputPath, css, 'utf-8');
    
    console.log(`   ğŸ¨ CSS ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯: ${outputPath}`);
    return outputPath;
  }

  /**
   * Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ÛŒ CSS
   */
  buildCSS(config, bookSlug) {
    const lines = [];
    
    lines.push(`/**`);
    lines.push(` * ØªÙ… Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ: ${bookSlug}`);
    lines.push(` * ØªØ§Ø±ÛŒØ®: ${new Date().toISOString()}`);
    lines.push(` */\n`);

    // CSS Variables Ø¨Ø±Ø§ÛŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§
    lines.push(`/* â•â•â• Ø±Ù†Ú¯â€ŒÙ‡Ø§ â•â•â• */`);
    lines.push(`.book-${bookSlug} {`);
    
    for (const [name, color] of Object.entries(config.colors)) {
      if (color.css) {
        lines.push(`  --color-${this.kebabCase(name)}: ${color.css};`);
      }
    }
    
    // ÙÙˆÙ†Øªâ€ŒÙ‡Ø§
    lines.push(`\n  /* ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ */`);
    if (config.fonts.main) {
      lines.push(`  --font-main: '${config.fonts.main.name}', serif;`);
    }
    if (config.fonts.sans) {
      lines.push(`  --font-sans: '${config.fonts.sans.name}', sans-serif;`);
    }
    if (config.fonts.mono) {
      lines.push(`  --font-mono: '${config.fonts.mono.name}', monospace;`);
    }
    
    lines.push(`}\n`);

    // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TikZ Ø¨Ù‡ Ú©Ù„Ø§Ø³ CSS
    lines.push(`/* â•â•â• Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± â•â•â• */`);
    for (const [styleName, definition] of Object.entries(config.tikz.styles)) {
      lines.push(this.tikzStyleToCSS(styleName, definition, bookSlug));
    }

    // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
    lines.push(`\n/* â•â•â• Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ â•â•â• */`);
    lines.push(this.generateBaseStyles(bookSlug));

    return lines.join('\n');
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø§Ø³ØªØ§ÛŒÙ„ TikZ Ø¨Ù‡ CSS
   */
  tikzStyleToCSS(name, definition, bookSlug) {
    // ØªØ¨Ø¯ÛŒÙ„ Ø³Ø§Ø¯Ù‡ - Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ± Ú©Ø±Ø¯
    const cssProps = [];
    
    // fill
    const fillMatch = definition.match(/fill=([^,\]]+)/);
    if (fillMatch) {
      const color = fillMatch[1].trim();
      cssProps.push(`  background-color: var(--color-${this.kebabCase(color)}, ${color});`);
    }
    
    // draw
    const drawMatch = definition.match(/draw=([^,\]]+)/);
    if (drawMatch) {
      const color = drawMatch[1].trim();
      cssProps.push(`  border-color: var(--color-${this.kebabCase(color)}, ${color});`);
    }
    
    // rounded corners
    if (definition.includes('rounded corners')) {
      const radiusMatch = definition.match(/rounded corners=(\d+)pt/);
      const radius = radiusMatch ? radiusMatch[1] : '8';
      cssProps.push(`  border-radius: ${radius}px;`);
    }
    
    if (cssProps.length === 0) return '';
    
    return `.book-${bookSlug} .tikz-style-${this.kebabCase(name)} {\n${cssProps.join('\n')}\n}\n`;
  }

  /**
   * Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
   */
  generateBaseStyles(bookSlug) {
    return `
.book-${bookSlug} {
  font-family: var(--font-main, 'Vazirmatn', serif);
}

.book-${bookSlug} h1,
.book-${bookSlug} h2,
.book-${bookSlug} h3 {
  font-family: var(--font-main, 'Vazirmatn', serif);
}

.book-${bookSlug} code,
.book-${bookSlug} pre {
  font-family: var(--font-mono, 'Fira Code', monospace);
}

.book-${bookSlug} .tikz-diagram {
  max-width: 100%;
  height: auto;
  margin: 2rem auto;
  display: block;
}

.book-${bookSlug} figure.tikz-figure {
  text-align: center;
  margin: 2rem 0;
}

.book-${bookSlug} figure.tikz-figure figcaption {
  font-size: 0.9rem;
  color: var(--color-gris, #666);
  margin-top: 0.5rem;
}
`;
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ kebab-case
   */
  kebabCase(str) {
    return str
      .replace(/([a-z])([A-Z])/g, '$1-$2')
      .replace(/[_\s]+/g, '-')
      .toLowerCase();
  }
}

export default StyleGenerator;
```

---

## ğŸ”§ Ù…Ø§Ú˜ÙˆÙ„ Û³: Smart Renderer

**ÙØ§ÛŒÙ„ `scripts/lib/smart-renderer.mjs`:**

```javascript
/**
 * Ø±Ù†Ø¯Ø±Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ TikZ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÙˆÛŒØ§
 */

import { exec } from 'child_process';
import { promisify } from 'util';
import fs from 'fs/promises';
import path from 'path';
import crypto from 'crypto';

const execAsync = promisify(exec);

export class SmartRenderer {
  constructor(options = {}) {
    this.tempDir = options.tempDir || path.join(process.env.TEMP || '/tmp', 'smart-renderer');
    this.outputDir = options.outputDir || 'public/diagrams';
    this.cacheDir = options.cacheDir || '.content-cache/diagrams';
    this.isWindows = process.platform === 'win32';
    
    this.stats = {
      rendered: 0,
      cached: 0,
      failed: 0
    };
  }

  /**
   * Ø³Ø§Ø®Øª Template Ù¾ÙˆÛŒØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ config
   */
  buildDynamicTemplate(tikzCode, config) {
    const lines = [];
    
    // Document class
    lines.push('\\documentclass[tikz,border=15pt]{standalone}');
    lines.push('');
    
    // Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
    lines.push('\\usepackage{fontspec}');
    lines.push('\\usepackage{xcolor}');
    lines.push('\\usepackage{tikz}');
    lines.push('\\usepackage{pgfplots}');
    lines.push('\\pgfplotsset{compat=1.18}');
    lines.push('');
    
    // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ TikZ - Ø§Ø² config
    if (config.tikz.libraries.length > 0) {
      lines.push(`\\usetikzlibrary{${config.tikz.libraries.join(',')}}`);
    }
    if (config.tikz.pgfplotsLibraries.length > 0) {
      lines.push(`\\usepgfplotslibrary{${config.tikz.pgfplotsLibraries.join(',')}}`);
    }
    lines.push('');
    
    // ÙÙˆÙ†Øª - Ø§Ø² config
    if (config.fonts.main) {
      const fontName = config.fonts.main.name;
      const options = config.fonts.main.options;
      const optStr = Object.entries(options)
        .map(([k, v]) => v === true ? k : `${k}=${v}`)
        .join(',');
      lines.push(`\\setmainfont${optStr ? `[${optStr}]` : ''}{${fontName}}`);
    } else {
      lines.push('\\setmainfont{Vazirmatn}');
    }
    lines.push('');
    
    // Ø±Ù†Ú¯â€ŒÙ‡Ø§ - Ø§Ø² config
    lines.push('% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡');
    for (const [name, color] of Object.entries(config.colors)) {
      if (color.type === 'rgb') {
        lines.push(`\\definecolor{${name}}{RGB}{${color.r},${color.g},${color.b}}`);
      } else if (color.type === 'hex') {
        lines.push(`\\definecolor{${name}}{HTML}{${color.css.replace('#', '')}}`);
      } else if (color.type === 'reference') {
        lines.push(`\\colorlet{${name}}{${color.base}}`);
      }
    }
    lines.push('');
    
    // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TikZ - Ø§Ø² config
    if (Object.keys(config.tikz.styles).length > 0) {
      lines.push('% Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ TikZ');
      lines.push('\\tikzset{');
      const styleEntries = Object.entries(config.tikz.styles);
      styleEntries.forEach(([name, def], i) => {
        const comma = i < styleEntries.length - 1 ? ',' : '';
        lines.push(`  ${name}/.style={${def}}${comma}`);
      });
      lines.push('}');
    }
    lines.push('');
    
    // Document
    lines.push('\\begin{document}');
    lines.push(tikzCode);
    lines.push('\\end{document}');
    
    return lines.join('\n');
  }

  /**
   * Ø±Ù†Ø¯Ø± TikZ Ø¨Ù‡ SVG
   */
  async render(tikzCode, config, options = {}) {
    const { name = 'diagram', forceRender = false } = options;
    
    // ØªÙˆÙ„ÛŒØ¯ hash ÛŒÚ©ØªØ§
    const contentHash = crypto
      .createHash('md5')
      .update(tikzCode + JSON.stringify(config.colors) + JSON.stringify(config.tikz))
      .digest('hex')
      .slice(0, 12);
    
    const outputName = `${name}-${contentHash}`;
    const svgPath = path.join(this.outputDir, `${outputName}.svg`);
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´
    if (!forceRender) {
      try {
        await fs.access(svgPath);
        this.stats.cached++;
        console.log(`   âš¡ Ú©Ø´: ${outputName}`);
        return { success: true, path: svgPath, cached: true };
      } catch {}
    }
    
    // Ø³Ø§Ø®Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§
    await fs.mkdir(this.tempDir, { recursive: true });
    await fs.mkdir(this.outputDir, { recursive: true });
    
    // Ø³Ø§Ø®Øª template Ù¾ÙˆÛŒØ§
    const texContent = this.buildDynamicTemplate(tikzCode, config);
    const texFile = path.join(this.tempDir, `${outputName}.tex`);
    const pdfFile = path.join(this.tempDir, `${outputName}.pdf`);
    
    try {
      // Ù†ÙˆØ´ØªÙ† ÙØ§ÛŒÙ„
      await fs.writeFile(texFile, texContent, 'utf-8');
      
      // Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„
      console.log(`   ğŸ”„ Ø±Ù†Ø¯Ø±: ${outputName}...`);
      
      const compileCmd = this.isWindows
        ? `cd /d "${this.tempDir}" && xelatex -interaction=nonstopmode -halt-on-error "${outputName}.tex"`
        : `cd "${this.tempDir}" && xelatex -interaction=nonstopmode -halt-on-error "${outputName}.tex"`;
      
      await execAsync(compileCmd, {
        timeout: 120000,
        shell: this.isWindows ? 'cmd.exe' : '/bin/sh'
      });
      
      // PDF â†’ SVG
      await this.convertToSVG(pdfFile, svgPath);
      
      // Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
      await this.optimizeSVG(svgPath, outputName);
      
      this.stats.rendered++;
      console.log(`   âœ… ØªÙˆÙ„ÛŒØ¯: ${outputName}`);
      
      return { success: true, path: svgPath, cached: false };
      
    } catch (error) {
      this.stats.failed++;
      console.error(`   âŒ Ø®Ø·Ø§: ${outputName}`);
      
      // Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§
      await this.saveErrorLog(outputName, error);
      
      return { success: false, error: error.message };
    }
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ PDF Ø¨Ù‡ SVG
   */
  async convertToSVG(pdfPath, svgPath) {
    if (this.isWindows) {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Inkscape Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ²
      await execAsync(
        `inkscape "${pdfPath}" --export-filename="${svgPath}" --export-type=svg`,
        { timeout: 60000 }
      );
    } else {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² pdf2svg Ø¯Ø± Ù„ÛŒÙ†ÙˆÚ©Ø³/Ù…Ú©
      await execAsync(`pdf2svg "${pdfPath}" "${svgPath}"`);
    }
  }

  /**
   * Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ SVG
   */
  async optimizeSVG(svgPath, name) {
    let content = await fs.readFile(svgPath, 'utf-8');
    
    content = content
      // Ø­Ø°Ù Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§
      .replace(/<!--[\s\S]*?-->/g, '')
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³
      .replace('<svg', `<svg class="tikz-diagram" id="${name}"`)
      // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Dark mode
      .replace('</svg>', `
<style>
  @media (prefers-color-scheme: dark) {
    #${name} { filter: invert(0.88) hue-rotate(180deg); }
  }
</style>
</svg>`);
    
    await fs.writeFile(svgPath, content, 'utf-8');
  }

  /**
   * Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§
   */
  async saveErrorLog(name, error) {
    const logDir = path.join(this.cacheDir, 'errors');
    await fs.mkdir(logDir, { recursive: true });
    
    const logContent = {
      name,
      timestamp: new Date().toISOString(),
      error: error.message,
      stack: error.stack
    };
    
    await fs.writeFile(
      path.join(logDir, `${name}.json`),
      JSON.stringify(logContent, null, 2)
    );
  }

  /**
   * Ú¯Ø²Ø§Ø±Ø´ Ø¢Ù…Ø§Ø±
   */
  getStats() {
    return {
      ...this.stats,
      total: this.stats.rendered + this.stats.cached + this.stats.failed
    };
  }
}

export default SmartRenderer;
```

---

## ğŸš€ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡

**ÙØ§ÛŒÙ„ `scripts/process-content.mjs`:**

```javascript
#!/usr/bin/env node
/**
 * Ø³ÛŒØ³ØªÙ… Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø­ØªÙˆØ§
 * ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ ØªØ¨Ø¯ÛŒÙ„ Ùˆ ØªÙˆÙ„ÛŒØ¯ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¨
 */

import fs from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';
import { globby } from 'globby';

import { PreambleParser } from './lib/preamble-parser.mjs';
import { StyleGenerator } from './lib/style-generator.mjs';
import { SmartRenderer } from './lib/smart-renderer.mjs';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  sourceDir: 'content-source',
  outputDir: 'src/content',
  cacheDir: '.content-cache',
  stylesDir: 'src/styles/book-themes',
  diagramsDir: 'public/diagrams'
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ Pipeline
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ContentPipeline {
  constructor() {
    this.parser = new PreambleParser();
    this.styleGen = new StyleGenerator(CONFIG.stylesDir);
    this.renderer = new SmartRenderer({
      outputDir: CONFIG.diagramsDir,
      cacheDir: CONFIG.cacheDir
    });
    
    this.configCache = new Map();
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨
   */
  async processBook(bookDir, options = {}) {
    const { lang = 'fa', slug } = options;
    const bookSlug = slug || path.basename(bookDir);
    
    console.log(`\n${'â•'.repeat(60)}`);
    console.log(`ğŸ“š Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨: ${bookSlug}`);
    console.log(`${'â•'.repeat(60)}`);
    
    // Û±. ØªØ­Ù„ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡
    console.log('\nğŸ“‹ Ù…Ø±Ø­Ù„Ù‡ Û±: ØªØ­Ù„ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡...');
    const config = await this.parser.analyzeProject(bookDir);
    
    // Ø°Ø®ÛŒØ±Ù‡ config Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    await this.saveConfig(bookSlug, config);
    this.configCache.set(bookSlug, config);
    
    // Û². ØªÙˆÙ„ÛŒØ¯ CSS
    console.log('\nğŸ¨ Ù…Ø±Ø­Ù„Ù‡ Û²: ØªÙˆÙ„ÛŒØ¯ CSS...');
    await this.styleGen.generateCSS(config, bookSlug);
    
    // Û³. ÛŒØ§ÙØªÙ† ÙØµÙ„â€ŒÙ‡Ø§
    const chapters = await this.findChapters(bookDir);
    console.log(`\nğŸ“‘ ÛŒØ§ÙØª Ø´Ø¯: ${chapters.length} ÙØµÙ„`);
    
    // Û´. Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ø± ÙØµÙ„
    const outputDir = path.join(CONFIG.outputDir, 'books', lang, bookSlug);
    await fs.mkdir(outputDir, { recursive: true });
    
    for (let i = 0; i < chapters.length; i++) {
      await this.processChapter(chapters[i], {
        config,
        bookSlug,
        chapterNumber: i + 1,
        outputDir,
        lang
      });
    }
    
    // Ûµ. Ø§ÛŒØ¬Ø§Ø¯ index
    await this.generateBookIndex(bookSlug, chapters, outputDir, lang);
    
    // Û¶. Ú¯Ø²Ø§Ø±Ø´
    const stats = this.renderer.getStats();
    console.log(`\nâœ… Ú©ØªØ§Ø¨ ${bookSlug} Ú©Ø§Ù…Ù„ Ø´Ø¯!`);
    console.log(`   ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: ${stats.rendered} Ø±Ù†Ø¯Ø±ØŒ ${stats.cached} Ú©Ø´ØŒ ${stats.failed} Ø®Ø·Ø§`);
    
    return { bookSlug, chapters: chapters.length, stats };
  }

  /**
   * ÛŒØ§ÙØªÙ† ÙØµÙ„â€ŒÙ‡Ø§ÛŒ Ú©ØªØ§Ø¨
   */
  async findChapters(bookDir) {
    const patterns = [
      path.join(bookDir, 'chapters', '*.tex'),
      path.join(bookDir, 'ch*.tex'),
      path.join(bookDir, 'chapter*.tex'),
      path.join(bookDir, 'ÙØµÙ„*.tex')
    ];
    
    let chapters = await globby(patterns);
    
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
    chapters.sort((a, b) => {
      const numA = parseInt(path.basename(a).match(/\d+/)?.[0] || '0');
      const numB = parseInt(path.basename(b).match(/\d+/)?.[0] || '0');
      return numA - numB;
    });
    
    return chapters;
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØµÙ„
   */
  async processChapter(chapterPath, options) {
    const { config, bookSlug, chapterNumber, outputDir, lang } = options;
    
    console.log(`\n   ğŸ“„ ÙØµÙ„ ${chapterNumber}: ${path.basename(chapterPath)}`);
    
    // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø­ØªÙˆØ§
    let content = await fs.readFile(chapterPath, 'utf-8');
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
    content = await this.processAllDiagrams(content, config, `${bookSlug}-ch${chapterNumber}`);
    
    // Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    content = this.preProcess(content);
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
    const markdown = await this.convertWithPandoc(content);
    
    // Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    const finalMd = this.postProcess(markdown, { bookSlug, chapterNumber, lang });
    
    // Ø°Ø®ÛŒØ±Ù‡
    const outputFileName = `ch${String(chapterNumber).padStart(2, '0')}-${path.basename(chapterPath, '.tex')}.md`;
    const outputPath = path.join(outputDir, outputFileName);
    await fs.writeFile(outputPath, finalMd, 'utf-8');
    
    console.log(`      âœ… ${outputFileName}`);
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
   */
  async processAllDiagrams(content, config, prefix) {
    const tikzRegex = /\\begin\{tikzpicture\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{tikzpicture\}/g;
    
    const matches = [...content.matchAll(tikzRegex)];
    console.log(`      ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: ${matches.length}`);
    
    let counter = 0;
    for (const match of matches) {
      counter++;
      const tikzCode = match[0];
      const name = `${prefix}-${counter}`;
      
      const result = await this.renderer.render(tikzCode, config, { name });
      
      if (result.success) {
        const relativePath = `/diagrams/${path.basename(result.path)}`;
        const replacement = `\n\n![Ù†Ù…ÙˆØ¯Ø§Ø± ${counter}](${relativePath}){.tikz-diagram}\n\n`;
        content = content.replace(tikzCode, replacement);
      } else {
        content = content.replace(tikzCode, `\n\n<!-- DIAGRAM_ERROR: ${name} -->\n\n`);
      }
    }
    
    return content;
  }

  /**
   * Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
   */
  preProcess(content) {
    return content
      // ØªØ¨Ø¯ÛŒÙ„ tcolorbox
      .replace(
        /\\begin\{tcolorbox\}\[([^\]]*title=\{([^}]*)\}[^\]]*)\]([\s\S]*?)\\end\{tcolorbox\}/g,
        (_, opts, title, body) => `\n\n> **${title}**\n> ${body.trim().replace(/\n/g, '\n> ')}\n\n`
      )
      // Ø­Ø°Ù Ú©Ø§Ù…Ù†Ø¯Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
      .replace(/\\renewcommand\{[^}]*\}\{[^}]*\}/g, '')
      .replace(/\\setcounter\{[^}]*\}\{[^}]*\}/g, '');
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
   */
  async convertWithPandoc(content) {
    const { exec } = await import('child_process');
    const { promisify } = await import('util');
    const execAsync = promisify(exec);
    
    const tempDir = path.join(CONFIG.cacheDir, 'temp');
    await fs.mkdir(tempDir, { recursive: true });
    
    const inputFile = path.join(tempDir, 'input.tex');
    const outputFile = path.join(tempDir, 'output.md');
    
    await fs.writeFile(inputFile, content, 'utf-8');
    
    const cmd = `pandoc "${inputFile}" -o "${outputFile}" --wrap=none --columns=1000`;
    await execAsync(cmd, { timeout: 60000 });
    
    return fs.readFile(outputFile, 'utf-8');
  }

  /**
   * Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
   */
  postProcess(markdown, options) {
    const { bookSlug, chapterNumber, lang } = options;
    
    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
    let result = markdown
      .replace(/\[node distance[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\\node[\s\S]*?;/g, '')
      .replace(/\\draw[\s\S]*?;/g, '')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†ÙˆØ§Ù†
    const titleMatch = result.match(/^#\s+(.+)$/m);
    const title = titleMatch ? titleMatch[1] : `ÙØµÙ„ ${chapterNumber}`;
    
    // Frontmatter
    const frontmatter = `---
title: "${title}"
description: "${title}"
lang: ${lang}
chapterNumber: ${chapterNumber}
book: "${bookSlug}"
---

`;
    
    return frontmatter + result;
  }

  /**
   * Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
   */
  async saveConfig(bookSlug, config) {
    const configDir = path.join(CONFIG.cacheDir, 'configs');
    await fs.mkdir(configDir, { recursive: true });
    
    await fs.writeFile(
      path.join(configDir, `${bookSlug}.json`),
      JSON.stringify(config, null, 2),
      'utf-8'
    );
  }

  /**
   * Ø§ÛŒØ¬Ø§Ø¯ index Ú©ØªØ§Ø¨
   */
  async generateBookIndex(bookSlug, chapters, outputDir, lang) {
    const content = `---
title: "${bookSlug}"
description: "ÙÙ‡Ø±Ø³Øª ÙØµÙˆÙ„"
lang: ${lang}
---

# ÙÙ‡Ø±Ø³Øª ÙØµÙˆÙ„

${chapters.map((ch, i) => {
  const baseName = path.basename(ch, '.tex');
  return `${i + 1}. [ÙØµÙ„ ${i + 1}](./ch${String(i + 1).padStart(2, '0')}-${baseName})`;
}).join('\n')}
`;
    
    await fs.writeFile(path.join(outputDir, 'index.md'), content, 'utf-8');
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§
   */
  async processAll() {
    console.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§...\n');
    
    // ÛŒØ§ÙØªÙ† Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
    const bookDirs = await globby(path.join(CONFIG.sourceDir, 'books', '*'), {
      onlyDirectories: true
    });
    
    console.log(`ğŸ“š ÛŒØ§ÙØª Ø´Ø¯: ${bookDirs.length} Ú©ØªØ§Ø¨\n`);
    
    const results = [];
    for (const bookDir of bookDirs) {
      try {
        const result = await this.processBook(bookDir);
        results.push(result);
      } catch (error) {
        console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± ${path.basename(bookDir)}:`, error.message);
      }
    }
    
    // Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
    console.log('\n' + 'â•'.repeat(60));
    console.log('ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ:');
    console.log('â•'.repeat(60));
    results.forEach(r => {
      console.log(`   ğŸ“š ${r.bookSlug}: ${r.chapters} ÙØµÙ„`);
    });
    
    return results;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  const args = process.argv.slice(2);
  const pipeline = new ContentPipeline();
  
  if (args.length === 0 || args.includes('--all')) {
    await pipeline.processAll();
  } else if (args.includes('--book')) {
    const bookDir = args[args.indexOf('--book') + 1];
    const slug = args.find(a => a.startsWith('--slug='))?.split('=')[1];
    const lang = args.find(a => a.startsWith('--lang='))?.split('=')[1] || 'fa';
    
    await pipeline.processBook(bookDir, { slug, lang });
  } else {
    console.log(`
ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§:

  Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡:
    node scripts/process-content.mjs --all
  
  Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨:
    node scripts/process-content.mjs --book content-source/books/my-book --slug=my-book --lang=fa
`);
  }
}

main().catch(console.error);

export { ContentPipeline };
```

---

## ğŸ“¦ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ package.json

```json
{
  "name": "your-site",
  "type": "module",
  "scripts": {
    "dev": "astro dev",
    "build": "npm run content:all && astro build",
    "preview": "astro preview",
    
    "content:all": "node scripts/process-content.mjs --all",
    "content:book": "node scripts/process-content.mjs --book",
    "content:watch": "node scripts/watch-content.mjs",
    
    "clean": "rm -rf .content-cache public/diagrams src/styles/book-themes"
  },
  "devDependencies": {
    "globby": "^14.0.0",
    "gray-matter": "^4.0.3",
    "chokidar": "^3.5.3"
  }
}
```

---

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡ Ø±Ø§Ù‡â€ŒØ­Ù„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ - Ú†Ú¯ÙˆÙ†Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Û±. ØªØ­Ù„ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø±:                                                â”‚
â”‚     â€¢ Ø®ÙˆØ§Ù†Ø¯Ù† main.tex Ùˆ preamble.tex                            â”‚
â”‚     â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ \definecolor â†’ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ CSS                        â”‚
â”‚     â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ \setmainfont â†’ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§                            â”‚
â”‚     â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ \tikzstyle â†’ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±                    â”‚
â”‚     â€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ \usetikzlibrary â†’ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…              â”‚
â”‚                                                                   â”‚
â”‚  Û². ØªÙˆÙ„ÛŒØ¯ Ù¾ÙˆÛŒØ§:                                                  â”‚
â”‚     â€¢ CSS Variables Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©ØªØ§Ø¨                                â”‚
â”‚     â€¢ Template Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¯Ø± TikZ                          â”‚
â”‚                                                                   â”‚
â”‚  Û³. Ú©Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯:                                                   â”‚
â”‚     â€¢ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±Ù†Ø¯Ø± Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯                 â”‚
â”‚     â€¢ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø± Ú©ØªØ§Ø¨ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯                              â”‚
â”‚                                                                   â”‚
â”‚  Û´. ÛŒÚ© Ø¯Ø³ØªÙˆØ± Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡:                                          â”‚
â”‚     npm run content:all                                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯:
1. **Ø§Ø³Ú©Ø±ÛŒÙ¾Øª watch** Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§ØªØŸ
2. **Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² PDF** ÙˆØ±ÙˆØ¯ÛŒØŸ
3. **ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ AI** Ø¨Ø±Ø§ÛŒ ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±ØŸ


# Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Watch Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª

## ğŸ”„ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ… Watch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ø³ÛŒØ³ØªÙ… Watch Ù‡ÙˆØ´Ù…Ù†Ø¯                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚  content-source â”‚                                            â”‚
â”‚   â”‚  â”œâ”€â”€ books/     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚   â”‚  â””â”€â”€ articles/  â”‚               â”‚                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                           â”‚
â”‚            â”‚                         â”‚                           â”‚
â”‚            â–¼                         â”‚ chokidar                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ (File Watcher)            â”‚
â”‚   â”‚   ØªØºÛŒÛŒØ± ÙØ§ÛŒÙ„   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚            â”‚                                                      â”‚
â”‚            â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚    Debounce     â”‚ â† Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ú©Ø±Ø±                  â”‚
â”‚   â”‚   (500ms)       â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚            â”‚                                                      â”‚
â”‚            â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚  ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹     â”‚                                            â”‚
â”‚   â”‚  â”œâ”€â”€ Book?     â”‚                                            â”‚
â”‚   â”‚  â”œâ”€â”€ Chapter?  â”‚                                            â”‚
â”‚   â”‚  â””â”€â”€ Article?  â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚            â”‚                                                      â”‚
â”‚            â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯  â”‚                                            â”‚
â”‚   â”‚ (ÙÙ‚Ø· ÙØ§ÛŒÙ„      â”‚                                            â”‚
â”‚   â”‚  ØªØºÛŒÛŒØ±ÛŒØ§ÙØªÙ‡)   â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚            â”‚                                                      â”‚
â”‚            â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚  src/content/   â”‚ â† Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Watch

**ÙØ§ÛŒÙ„ `scripts/watch-content.mjs`:**

```javascript
#!/usr/bin/env node
/**
 * Ø³ÛŒØ³ØªÙ… Watch Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª
 * 
 * ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:
 * - Ù…Ø§Ù†ÛŒØªÙˆØ± ØªØºÛŒÛŒØ±Ø§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ LaTeX Ùˆ Markdown
 * - Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙÙ‚Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡
 * - Debounce Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ú©Ø±Ø±
 * - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙˆÛŒÙ†Ø¯ÙˆØ²
 * - Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ Ø²Ù†Ø¯Ù‡
 */

import chokidar from 'chokidar';
import path from 'path';
import fs from 'fs/promises';
import { fileURLToPath } from 'url';
import { EventEmitter } from 'events';

// Import pipeline
import { ContentPipeline } from './process-content.mjs';
import { PreambleParser } from './lib/preamble-parser.mjs';
import { StyleGenerator } from './lib/style-generator.mjs';
import { SmartRenderer } from './lib/smart-renderer.mjs';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  // Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ watch
  watchPaths: [
    'content-source/**/*.tex',
    'content-source/**/*.md',
    'content-source/**/*.mdx'
  ],
  
  // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ø´ÙˆÙ†Ø¯
  ignorePaths: [
    '**/node_modules/**',
    '**/.git/**',
    '**/build/**',
    '**/*.aux',
    '**/*.log',
    '**/*.out',
    '**/*.toc',
    '**/*.synctex.gz'
  ],
  
  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
  sourceDir: 'content-source',
  outputDir: 'src/content',
  cacheDir: '.content-cache',
  stylesDir: 'src/styles/book-themes',
  diagramsDir: 'public/diagrams',
  
  // Debounce (Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡)
  debounceDelay: 500,
  
  // ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
  maxRetries: 2,
  
  // Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªØ±Ù…ÛŒÙ†Ø§Ù„ (ANSI)
  colors: {
    reset: '\x1b[0m',
    bright: '\x1b[1m',
    dim: '\x1b[2m',
    red: '\x1b[31m',
    green: '\x1b[32m',
    yellow: '\x1b[33m',
    blue: '\x1b[34m',
    magenta: '\x1b[35m',
    cyan: '\x1b[36m',
    white: '\x1b[37m',
    bgBlue: '\x1b[44m',
    bgGreen: '\x1b[42m',
    bgYellow: '\x1b[43m',
    bgRed: '\x1b[41m'
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Logger
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Logger {
  constructor() {
    this.c = CONFIG.colors;
  }

  timestamp() {
    return new Date().toLocaleTimeString('fa-IR', { hour12: false });
  }

  info(msg) {
    console.log(`${this.c.dim}[${this.timestamp()}]${this.c.reset} ${this.c.blue}â„¹${this.c.reset} ${msg}`);
  }

  success(msg) {
    console.log(`${this.c.dim}[${this.timestamp()}]${this.c.reset} ${this.c.green}âœ“${this.c.reset} ${msg}`);
  }

  warn(msg) {
    console.log(`${this.c.dim}[${this.timestamp()}]${this.c.reset} ${this.c.yellow}âš ${this.c.reset} ${msg}`);
  }

  error(msg) {
    console.log(`${this.c.dim}[${this.timestamp()}]${this.c.reset} ${this.c.red}âœ—${this.c.reset} ${msg}`);
  }

  file(action, filePath) {
    const fileName = path.basename(filePath);
    const dirName = path.dirname(filePath);
    
    const actionColors = {
      'change': this.c.yellow,
      'add': this.c.green,
      'unlink': this.c.red,
      'processing': this.c.cyan,
      'done': this.c.green
    };
    
    const color = actionColors[action] || this.c.white;
    const icons = {
      'change': 'ğŸ“',
      'add': 'â•',
      'unlink': 'ğŸ—‘ï¸',
      'processing': 'âš™ï¸',
      'done': 'âœ…'
    };
    
    console.log(
      `${this.c.dim}[${this.timestamp()}]${this.c.reset} ` +
      `${icons[action] || 'â€¢'} ` +
      `${color}${action.toUpperCase().padEnd(10)}${this.c.reset} ` +
      `${this.c.bright}${fileName}${this.c.reset} ` +
      `${this.c.dim}(${dirName})${this.c.reset}`
    );
  }

  banner() {
    console.log('\n' + 'â•'.repeat(60));
    console.log(`${this.c.bgBlue}${this.c.white}${this.c.bright}    ğŸ‘ï¸  Content Watcher - Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±    ${this.c.reset}`);
    console.log('â•'.repeat(60) + '\n');
  }

  ready() {
    console.log(`\n${this.c.green}${this.c.bright}âœ¨ Ø¢Ù…Ø§Ø¯Ù‡! Ù…Ù†ØªØ¸Ø± ØªØºÛŒÛŒØ±Ø§Øª...${this.c.reset}`);
    console.log(`${this.c.dim}   Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬: Ctrl+C${this.c.reset}\n`);
  }

  stats(stats) {
    console.log(`\n${this.c.dim}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${this.c.reset}`);
    console.log(`${this.c.cyan}ğŸ“Š Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡:${this.c.reset}`);
    console.log(`   ${this.c.green}âœ“ Ù…ÙˆÙÙ‚: ${stats.success}${this.c.reset}`);
    console.log(`   ${this.c.red}âœ— Ø®Ø·Ø§: ${stats.failed}${this.c.reset}`);
    console.log(`   ${this.c.yellow}â± Ø§Ø² Ú©Ø´: ${stats.cached}${this.c.reset}`);
    console.log(`${this.c.dim}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${this.c.reset}\n`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ ContentWatcher
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ContentWatcher extends EventEmitter {
  constructor() {
    super();
    
    this.logger = new Logger();
    this.pipeline = new ContentPipeline();
    this.parser = new PreambleParser();
    this.styleGen = new StyleGenerator(CONFIG.stylesDir);
    this.renderer = new SmartRenderer({
      outputDir: CONFIG.diagramsDir,
      cacheDir: CONFIG.cacheDir
    });
    
    // Ú©Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
    this.bookConfigs = new Map();
    
    // ØµÙ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø§ debounce
    this.pendingFiles = new Map();
    this.debounceTimers = new Map();
    
    // Ø¢Ù…Ø§Ø±
    this.stats = {
      success: 0,
      failed: 0,
      cached: 0,
      totalTime: 0
    };
    
    // ÙˆØ¶Ø¹ÛŒØª
    this.isProcessing = false;
    this.queue = [];
  }

  /**
   * Ø´Ø±ÙˆØ¹ watch
   */
  async start() {
    this.logger.banner();
    
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
    await this.loadExistingConfigs();
    
    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ watcher
    this.watcher = chokidar.watch(CONFIG.watchPaths, {
      ignored: CONFIG.ignorePaths,
      persistent: true,
      ignoreInitial: true,
      awaitWriteFinish: {
        stabilityThreshold: 300,
        pollInterval: 100
      },
      // ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒÙ†Ø¯ÙˆØ²
      usePolling: process.platform === 'win32',
      interval: 300
    });

    // Event handlers
    this.watcher
      .on('ready', () => this.onReady())
      .on('change', (filePath) => this.onFileChange(filePath, 'change'))
      .on('add', (filePath) => this.onFileChange(filePath, 'add'))
      .on('unlink', (filePath) => this.onFileDelete(filePath))
      .on('error', (error) => this.onError(error));

    // Handle Ctrl+C
    process.on('SIGINT', () => this.stop());
    process.on('SIGTERM', () => this.stop());
  }

  /**
   * Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
   */
  async loadExistingConfigs() {
    const configDir = path.join(CONFIG.cacheDir, 'configs');
    
    try {
      const files = await fs.readdir(configDir);
      
      for (const file of files) {
        if (file.endsWith('.json')) {
          const bookSlug = path.basename(file, '.json');
          const configPath = path.join(configDir, file);
          const config = JSON.parse(await fs.readFile(configPath, 'utf-8'));
          this.bookConfigs.set(bookSlug, config);
          this.logger.info(`ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: ${bookSlug}`);
        }
      }
    } catch {
      // Ù¾ÙˆØ´Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ - Ø§ÙˆÙ„ÛŒÙ† Ø§Ø¬Ø±Ø§
    }
  }

  /**
   * Event: Ø¢Ù…Ø§Ø¯Ù‡
   */
  onReady() {
    this.logger.info(`Ø¯Ø± Ø­Ø§Ù„ Ù…Ø§Ù†ÛŒØªÙˆØ±: ${CONFIG.watchPaths.join(', ')}`);
    this.logger.ready();
  }

  /**
   * Event: ØªØºÛŒÛŒØ± ÙØ§ÛŒÙ„
   */
  onFileChange(filePath, action) {
    // Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø³ÛŒØ±
    filePath = path.normalize(filePath);
    
    this.logger.file(action, filePath);
    
    // Debounce
    const existing = this.debounceTimers.get(filePath);
    if (existing) {
      clearTimeout(existing);
    }
    
    const timer = setTimeout(() => {
      this.debounceTimers.delete(filePath);
      this.queueFile(filePath);
    }, CONFIG.debounceDelay);
    
    this.debounceTimers.set(filePath, timer);
  }

  /**
   * Event: Ø­Ø°Ù ÙØ§ÛŒÙ„
   */
  async onFileDelete(filePath) {
    filePath = path.normalize(filePath);
    this.logger.file('unlink', filePath);
    
    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ùˆ Ø­Ø°Ù ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ Ù…ØªÙ†Ø§Ø¸Ø±
    const outputPath = this.getOutputPath(filePath);
    if (outputPath) {
      try {
        await fs.unlink(outputPath);
        this.logger.success(`Ø­Ø°Ù Ø´Ø¯: ${path.basename(outputPath)}`);
      } catch {
        // ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
      }
    }
  }

  /**
   * Event: Ø®Ø·Ø§
   */
  onError(error) {
    this.logger.error(`Ø®Ø·Ø§ÛŒ Watcher: ${error.message}`);
  }

  /**
   * Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙ Ù¾Ø±Ø¯Ø§Ø²Ø´
   */
  queueFile(filePath) {
    this.queue.push(filePath);
    this.processQueue();
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙ
   */
  async processQueue() {
    if (this.isProcessing || this.queue.length === 0) {
      return;
    }
    
    this.isProcessing = true;
    
    while (this.queue.length > 0) {
      const filePath = this.queue.shift();
      await this.processFile(filePath);
    }
    
    this.isProcessing = false;
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„
   */
  async processFile(filePath, retryCount = 0) {
    const startTime = Date.now();
    this.logger.file('processing', filePath);
    
    try {
      const fileInfo = this.analyzeFilePath(filePath);
      
      switch (fileInfo.type) {
        case 'preamble':
          await this.processPreambleChange(fileInfo);
          break;
        
        case 'chapter':
          await this.processChapter(fileInfo);
          break;
        
        case 'article':
          await this.processArticle(fileInfo);
          break;
        
        case 'book-main':
          await this.processBookMain(fileInfo);
          break;
        
        default:
          this.logger.warn(`Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡: ${filePath}`);
          return;
      }
      
      const elapsed = Date.now() - startTime;
      this.stats.success++;
      this.stats.totalTime += elapsed;
      
      this.logger.file('done', filePath);
      this.logger.info(`Ø²Ù…Ø§Ù†: ${elapsed}ms`);
      
    } catch (error) {
      if (retryCount < CONFIG.maxRetries) {
        this.logger.warn(`ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ (${retryCount + 1}/${CONFIG.maxRetries})...`);
        await this.delay(1000);
        return this.processFile(filePath, retryCount + 1);
      }
      
      this.stats.failed++;
      this.logger.error(`Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´: ${error.message}`);
      
      // Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§
      await this.saveErrorLog(filePath, error);
    }
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„
   */
  analyzeFilePath(filePath) {
    const relativePath = path.relative(CONFIG.sourceDir, filePath);
    const parts = relativePath.split(path.sep);
    const fileName = path.basename(filePath, path.extname(filePath));
    const ext = path.extname(filePath);
    
    // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
    if (parts[0] === 'books' && parts.length >= 2) {
      const bookSlug = parts[1];
      
      // preamble
      if (fileName === 'preamble' || fileName.includes('preamble')) {
        return {
          type: 'preamble',
          bookSlug,
          filePath,
          lang: this.detectLanguage(filePath)
        };
      }
      
      // main.tex
      if (fileName === 'main' || fileName === 'book' || fileName === 'index') {
        return {
          type: 'book-main',
          bookSlug,
          filePath,
          lang: this.detectLanguage(filePath)
        };
      }
      
      // chapter
      return {
        type: 'chapter',
        bookSlug,
        chapterFile: filePath,
        fileName,
        lang: this.detectLanguage(filePath)
      };
    }
    
    if (parts[0] === 'articles') {
      return {
        type: 'article',
        filePath,
        fileName,
        lang: this.detectLanguage(filePath)
      };
    }
    
    return { type: 'unknown', filePath };
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù†
   */
  detectLanguage(filePath) {
    if (filePath.includes('/en/') || filePath.includes('\\en\\')) {
      return 'en';
    }
    return 'fa';
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØºÛŒÛŒØ± preamble
   */
  async processPreambleChange(fileInfo) {
    const { bookSlug, lang } = fileInfo;
    
    this.logger.info(`ØªØºÛŒÛŒØ± Preamble - Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø¬Ø¯Ø¯ Ú©Ù„ Ú©ØªØ§Ø¨: ${bookSlug}`);
    
    // ØªØ­Ù„ÛŒÙ„ Ù…Ø¬Ø¯Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡
    const bookDir = path.join(CONFIG.sourceDir, 'books', bookSlug);
    const config = await this.parser.analyzeProject(bookDir);
    
    // Ø°Ø®ÛŒØ±Ù‡ config Ø¬Ø¯ÛŒØ¯
    this.bookConfigs.set(bookSlug, config);
    await this.saveConfig(bookSlug, config);
    
    // ØªÙˆÙ„ÛŒØ¯ CSS Ø¬Ø¯ÛŒØ¯
    await this.styleGen.generateCSS(config, bookSlug);
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø¬Ø¯Ø¯ Ù‡Ù…Ù‡ ÙØµÙ„â€ŒÙ‡Ø§
    await this.pipeline.processBook(bookDir, { slug: bookSlug, lang });
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØºÛŒÛŒØ± ÙØµÙ„
   */
  async processChapter(fileInfo) {
    const { bookSlug, chapterFile, fileName, lang } = fileInfo;
    
    // Ø¯Ø±ÛŒØ§ÙØª config Ú©ØªØ§Ø¨
    let config = this.bookConfigs.get(bookSlug);
    
    if (!config) {
      // Ø§Ú¯Ø± config Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ú©Ù„ Ú©ØªØ§Ø¨ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†ÛŒÙ…
      const bookDir = path.join(CONFIG.sourceDir, 'books', bookSlug);
      config = await this.parser.analyzeProject(bookDir);
      this.bookConfigs.set(bookSlug, config);
      await this.saveConfig(bookSlug, config);
    }
    
    // ØªØ´Ø®ÛŒØµ Ø´Ù…Ø§Ø±Ù‡ ÙØµÙ„
    const chapterNumber = this.extractChapterNumber(fileName);
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§ÛŒÙ† ÙØµÙ„
    await this.processSingleChapter(chapterFile, {
      config,
      bookSlug,
      chapterNumber,
      lang
    });
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØµÙ„
   */
  async processSingleChapter(chapterPath, options) {
    const { config, bookSlug, chapterNumber, lang } = options;
    
    // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø­ØªÙˆØ§
    let content = await fs.readFile(chapterPath, 'utf-8');
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
    content = await this.processAllDiagrams(content, config, `${bookSlug}-ch${chapterNumber}`);
    
    // Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    content = this.preProcess(content);
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
    const markdown = await this.convertWithPandoc(content);
    
    // Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    const finalMd = this.postProcess(markdown, { bookSlug, chapterNumber, lang });
    
    // Ø°Ø®ÛŒØ±Ù‡
    const outputDir = path.join(CONFIG.outputDir, 'books', lang, bookSlug);
    await fs.mkdir(outputDir, { recursive: true });
    
    const baseName = path.basename(chapterPath, '.tex');
    const outputFileName = `ch${String(chapterNumber).padStart(2, '0')}-${baseName}.md`;
    const outputPath = path.join(outputDir, outputFileName);
    
    await fs.writeFile(outputPath, finalMd, 'utf-8');
    this.logger.success(`Ø°Ø®ÛŒØ±Ù‡: ${outputFileName}`);
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ù‚Ø§Ù„Ù‡
   */
  async processArticle(fileInfo) {
    const { filePath, fileName, lang } = fileInfo;
    const ext = path.extname(filePath);
    
    const outputDir = path.join(CONFIG.outputDir, 'articles', lang);
    await fs.mkdir(outputDir, { recursive: true });
    
    if (ext === '.md' || ext === '.mdx') {
      // ÙØ§ÛŒÙ„ Markdown - Ú©Ù¾ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…
      const outputPath = path.join(outputDir, path.basename(filePath));
      await fs.copyFile(filePath, outputPath);
      this.logger.success(`Ú©Ù¾ÛŒ: ${path.basename(filePath)}`);
    } else if (ext === '.tex') {
      // ÙØ§ÛŒÙ„ LaTeX - Ù¾Ø±Ø¯Ø§Ø²Ø´
      let content = await fs.readFile(filePath, 'utf-8');
      
      // config Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§Ù„Ø§Øª
      const defaultConfig = await this.getDefaultConfig();
      
      content = await this.processAllDiagrams(content, defaultConfig, fileName);
      content = this.preProcess(content);
      const markdown = await this.convertWithPandoc(content);
      const finalMd = this.postProcess(markdown, { lang });
      
      const outputPath = path.join(outputDir, `${fileName}.md`);
      await fs.writeFile(outputPath, finalMd, 'utf-8');
      this.logger.success(`Ø°Ø®ÛŒØ±Ù‡: ${fileName}.md`);
    }
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ú©ØªØ§Ø¨
   */
  async processBookMain(fileInfo) {
    const { bookSlug, lang } = fileInfo;
    
    this.logger.info(`ØªØºÛŒÛŒØ± ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ - Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù…Ù„ Ú©ØªØ§Ø¨: ${bookSlug}`);
    
    const bookDir = path.join(CONFIG.sourceDir, 'books', bookSlug);
    await this.pipeline.processBook(bookDir, { slug: bookSlug, lang });
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
   */
  async processAllDiagrams(content, config, prefix) {
    const tikzRegex = /\\begin\{tikzpicture\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{tikzpicture\}/g;
    
    const matches = [...content.matchAll(tikzRegex)];
    
    let counter = 0;
    for (const match of matches) {
      counter++;
      const tikzCode = match[0];
      const name = `${prefix}-${counter}`;
      
      const result = await this.renderer.render(tikzCode, config, { name });
      
      if (result.success) {
        if (result.cached) {
          this.stats.cached++;
        }
        const relativePath = `/diagrams/${path.basename(result.path)}`;
        const replacement = `\n\n![Ù†Ù…ÙˆØ¯Ø§Ø± ${counter}](${relativePath}){.tikz-diagram}\n\n`;
        content = content.replace(tikzCode, replacement);
      } else {
        content = content.replace(tikzCode, `\n\n<!-- DIAGRAM_ERROR: ${name} -->\n\n`);
      }
    }
    
    return content;
  }

  /**
   * Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
   */
  preProcess(content) {
    return content
      .replace(
        /\\begin\{tcolorbox\}\[([^\]]*title=\{([^}]*)\}[^\]]*)\]([\s\S]*?)\\end\{tcolorbox\}/g,
        (_, opts, title, body) => `\n\n> **${title}**\n> ${body.trim().replace(/\n/g, '\n> ')}\n\n`
      )
      .replace(/\\renewcommand\{[^}]*\}\{[^}]*\}/g, '')
      .replace(/\\setcounter\{[^}]*\}\{[^}]*\}/g, '');
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
   */
  async convertWithPandoc(content) {
    const { exec } = await import('child_process');
    const { promisify } = await import('util');
    const execAsync = promisify(exec);
    
    const tempDir = path.join(CONFIG.cacheDir, 'temp');
    await fs.mkdir(tempDir, { recursive: true });
    
    const inputFile = path.join(tempDir, `input-${Date.now()}.tex`);
    const outputFile = path.join(tempDir, `output-${Date.now()}.md`);
    
    await fs.writeFile(inputFile, content, 'utf-8');
    
    const cmd = `pandoc "${inputFile}" -o "${outputFile}" --wrap=none --columns=1000`;
    await execAsync(cmd, { timeout: 60000 });
    
    const result = await fs.readFile(outputFile, 'utf-8');
    
    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙ‚Øª
    await fs.unlink(inputFile).catch(() => {});
    await fs.unlink(outputFile).catch(() => {});
    
    return result;
  }

  /**
   * Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
   */
  postProcess(markdown, options = {}) {
    const { bookSlug, chapterNumber, lang = 'fa' } = options;
    
    let result = markdown
      .replace(/\[node distance[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\\node[\s\S]*?;/g, '')
      .replace(/\\draw[\s\S]*?;/g, '')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
    
    const titleMatch = result.match(/^#\s+(.+)$/m);
    const title = titleMatch ? titleMatch[1] : (chapterNumber ? `ÙØµÙ„ ${chapterNumber}` : 'Ù…Ù‚Ø§Ù„Ù‡');
    
    let frontmatter = `---
title: "${title}"
description: "${title}"
lang: ${lang}
`;
    
    if (chapterNumber) {
      frontmatter += `chapterNumber: ${chapterNumber}\n`;
    }
    if (bookSlug) {
      frontmatter += `book: "${bookSlug}"\n`;
    }
    
    frontmatter += `---\n\n`;
    
    return frontmatter + result;
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ù…Ø§Ø±Ù‡ ÙØµÙ„
   */
  extractChapterNumber(fileName) {
    const match = fileName.match(/(\d+)/);
    return match ? parseInt(match[1]) : 1;
  }

  /**
   * config Ù¾ÛŒØ´â€ŒÙØ±Ø¶
   */
  async getDefaultConfig() {
    return {
      colors: {
        bleurepublique: { css: 'rgb(26, 115, 232)' },
        bleulight: { css: 'rgb(232, 244, 248)' },
        vertnapoleon: { css: 'rgb(52, 168, 83)' },
        rougerevolution: { css: 'rgb(234, 67, 53)' },
        gris: { css: 'rgb(95, 99, 104)' }
      },
      fonts: {
        main: { name: 'Vazirmatn' }
      },
      tikz: {
        libraries: ['shapes.geometric', 'arrows.meta', 'positioning', 'calc', 'backgrounds'],
        styles: {},
        pgfplotsLibraries: []
      }
    };
  }

  /**
   * Ø°Ø®ÛŒØ±Ù‡ config
   */
  async saveConfig(bookSlug, config) {
    const configDir = path.join(CONFIG.cacheDir, 'configs');
    await fs.mkdir(configDir, { recursive: true });
    
    await fs.writeFile(
      path.join(configDir, `${bookSlug}.json`),
      JSON.stringify(config, null, 2),
      'utf-8'
    );
  }

  /**
   * Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§
   */
  async saveErrorLog(filePath, error) {
    const logDir = path.join(CONFIG.cacheDir, 'errors');
    await fs.mkdir(logDir, { recursive: true });
    
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const logContent = {
      file: filePath,
      timestamp: new Date().toISOString(),
      error: error.message,
      stack: error.stack
    };
    
    await fs.writeFile(
      path.join(logDir, `error-${timestamp}.json`),
      JSON.stringify(logContent, null, 2)
    );
  }

  /**
   * Ù…Ø³ÛŒØ± Ø®Ø±ÙˆØ¬ÛŒ
   */
  getOutputPath(inputPath) {
    const fileInfo = this.analyzeFilePath(inputPath);
    
    if (fileInfo.type === 'chapter') {
      const { bookSlug, fileName, lang } = fileInfo;
      const chapterNumber = this.extractChapterNumber(fileName);
      return path.join(
        CONFIG.outputDir, 
        'books', 
        lang, 
        bookSlug, 
        `ch${String(chapterNumber).padStart(2, '0')}-${fileName}.md`
      );
    }
    
    if (fileInfo.type === 'article') {
      const { fileName, lang } = fileInfo;
      return path.join(CONFIG.outputDir, 'articles', lang, `${fileName}.md`);
    }
    
    return null;
  }

  /**
   * ØªØ£Ø®ÛŒØ±
   */
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  /**
   * ØªÙˆÙ‚Ù
   */
  async stop() {
    console.log('\n');
    this.logger.info('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ‚Ù...');
    
    if (this.watcher) {
      await this.watcher.close();
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ
    this.logger.stats(this.stats);
    
    process.exit(0);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ø¬Ø±Ø§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  const watcher = new ContentWatcher();
  await watcher.start();
}

main().catch(error => {
  console.error('âŒ Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ:', error);
  process.exit(1);
});

export { ContentWatcher };
```

---

## ğŸ“¦ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ package.json

```json
{
  "name": "your-site",
  "type": "module",
  "scripts": {
    "dev": "astro dev",
    "dev:watch": "npm-run-all --parallel dev content:watch",
    "build": "npm run content:all && astro build",
    "preview": "astro preview",
    
    "content:all": "node scripts/process-content.mjs --all",
    "content:book": "node scripts/process-content.mjs --book",
    "content:watch": "node scripts/watch-content.mjs",
    
    "clean": "rimraf .content-cache public/diagrams src/styles/book-themes"
  },
  "devDependencies": {
    "chokidar": "^3.6.0",
    "globby": "^14.0.0",
    "gray-matter": "^4.0.3",
    "npm-run-all": "^4.1.5",
    "rimraf": "^5.0.5"
  }
}
```

---

## ğŸ”§ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

```powershell
# Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…
npm install -D chokidar npm-run-all rimraf
```

---

## ğŸš€ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø§Ø¬Ø±Ø§ÛŒ Watch Ø¨Ù‡ ØªÙ†Ù‡Ø§ÛŒÛŒ:

```powershell
npm run content:watch
```

### Ø§Ø¬Ø±Ø§ÛŒ Watch Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Astro Dev:

```powershell
npm run dev:watch
```

### Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù…ÙˆÙ†Ù‡:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸ‘ï¸  Content Watcher - Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±    
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[14:32:15] â„¹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: transition-guide
[14:32:15] â„¹ Ø¯Ø± Ø­Ø§Ù„ Ù…Ø§Ù†ÛŒØªÙˆØ±: content-source/**/*.tex, content-source/**/*.md

âœ¨ Ø¢Ù…Ø§Ø¯Ù‡! Ù…Ù†ØªØ¸Ø± ØªØºÛŒÛŒØ±Ø§Øª...
   Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬: Ctrl+C

[14:33:22] ğŸ“ CHANGE     chapter1.tex (content-source\books\transition-guide\chapters)
[14:33:22] âš™ï¸ PROCESSING chapter1.tex (content-source\books\transition-guide\chapters)
[14:33:22]    ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: 5
[14:33:23]    âš¡ Ú©Ø´: transition-guide-ch1-1
[14:33:23]    âš¡ Ú©Ø´: transition-guide-ch1-2
[14:33:24]    ğŸ”„ Ø±Ù†Ø¯Ø±: transition-guide-ch1-3...
[14:33:26]    âœ… ØªÙˆÙ„ÛŒØ¯: transition-guide-ch1-3
[14:33:26]    âš¡ Ú©Ø´: transition-guide-ch1-4
[14:33:26]    âš¡ Ú©Ø´: transition-guide-ch1-5
[14:33:27] âœ… DONE       chapter1.tex (content-source\books\transition-guide\chapters)
[14:33:27] â„¹ Ø²Ù…Ø§Ù†: 4823ms
```

---

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Watch Ù‡ÙˆØ´Ù…Ù†Ø¯                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  âœ… Ù…Ø§Ù†ÛŒØªÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø±                                               â”‚
â”‚     â€¢ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ .tex, .md, .mdx                                   â”‚
â”‚     â€¢ ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ (Ú©ØªØ§Ø¨/ÙØµÙ„/Ù…Ù‚Ø§Ù„Ù‡/preamble)                 â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯                                                â”‚
â”‚     â€¢ ÙÙ‚Ø· ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ±ÛŒØ§ÙØªÙ‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯                         â”‚
â”‚     â€¢ ØªØºÛŒÛŒØ± preamble â†’ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù„ Ú©ØªØ§Ø¨                          â”‚
â”‚     â€¢ ØªØºÛŒÛŒØ± ÙØµÙ„ â†’ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† ÙØµÙ„                                  â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ú©Ø´ Ù‡ÙˆØ´Ù…Ù†Ø¯                                                    â”‚
â”‚     â€¢ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ø² Ú©Ø´ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯                 â”‚
â”‚     â€¢ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯                               â”‚
â”‚                                                                   â”‚
â”‚  âœ… Debounce                                                     â”‚
â”‚     â€¢ Ø°Ø®ÛŒØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯ Ø³Ø±ÛŒØ¹ = ÛŒÚ© Ù¾Ø±Ø¯Ø§Ø²Ø´                          â”‚
â”‚     â€¢ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…ØµØ±Ù Ù…Ù†Ø§Ø¨Ø¹ Ø§Ø¶Ø§ÙÛŒ                               â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ Ø²Ù†Ø¯Ù‡                                               â”‚
â”‚     â€¢ ÙˆØ¶Ø¹ÛŒØª Ù‡Ø± ÙØ§ÛŒÙ„ Ø¨Ø§ Ø±Ù†Ú¯ Ùˆ Ø¢ÛŒÚ©ÙˆÙ†                              â”‚
â”‚     â€¢ Ø¢Ù…Ø§Ø± Ø¬Ù„Ø³Ù‡                                                  â”‚
â”‚     â€¢ Ù„Ø§Ú¯ Ø®Ø·Ø§Ù‡Ø§                                                  â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ ÙˆÛŒÙ†Ø¯ÙˆØ²                                             â”‚
â”‚     â€¢ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² polling Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ²                               â”‚
â”‚     â€¢ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ ØµØ­ÛŒØ­                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù…ÙˆØ±Ø¯ Û² (Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² PDF ÙˆØ±ÙˆØ¯ÛŒ) ÛŒØ§ Ù…ÙˆØ±Ø¯ Û³ (ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ AI Ø¨Ø±Ø§ÛŒ ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ) Ø±Ø§ Ù‡Ù… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒÙ…ØŸ


# Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² PDF Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ AI

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Ù…Ø¹Ù…Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Content Pipeline                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Ù…Ù†Ø§Ø¨Ø¹ ÙˆØ±ÙˆØ¯ÛŒ                           â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚  LaTeX  â”‚  â”‚Markdown â”‚  â”‚   PDF   â”‚  â”‚  Word   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  .tex   â”‚  â”‚ .md/.mdxâ”‚  â”‚  .pdf   â”‚  â”‚  .docx  â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚            â”‚            â”‚            â”‚               â”‚
â”‚           â–¼            â–¼            â–¼            â–¼               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Û±. Content Analyzer                         â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚   Preamble   â”‚  â”‚     PDF      â”‚  â”‚   Format     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚   Parser     â”‚  â”‚   Extractor  â”‚  â”‚   Detector   â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Û². AI Processing Layer                      â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚   Auto       â”‚  â”‚   Content    â”‚  â”‚   Smart      â”‚   â”‚   â”‚
â”‚   â”‚  â”‚   Tagger     â”‚  â”‚   Summarizer â”‚  â”‚   Categorize â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Û³. Rendering Engine                         â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚   TikZâ†’SVG   â”‚  â”‚   Tablesâ†’    â”‚  â”‚   Mathâ†’      â”‚   â”‚   â”‚
â”‚   â”‚  â”‚   Renderer   â”‚  â”‚   HTML       â”‚  â”‚   KaTeX      â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Û´. Output Generator                         â”‚   â”‚
â”‚   â”‚  â€¢ Markdown + Frontmatter (Ø¨Ø§ ØªÚ¯â€ŒÙ‡Ø§ÛŒ AI)                â”‚   â”‚
â”‚   â”‚  â€¢ CSS Variables                                         â”‚   â”‚
â”‚   â”‚  â€¢ SEO Metadata                                          â”‚   â”‚
â”‚   â”‚  â€¢ Search Index                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“„ Ø¨Ø®Ø´ Û±: Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± PDF

### Û±.Û± Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§

```powershell
# Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Node Ø¨Ø±Ø§ÛŒ PDF
npm install -D pdf-parse pdf2pic sharp mammoth

# Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙÛŒØª Ø¨Ù‡ØªØ±)
# Windows - Ø¨Ø§ Chocolatey:
choco install poppler ghostscript -y

# ÛŒØ§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…:
# Poppler: https://github.com/oschwartz10612/poppler-windows/releases
# Ghostscript: https://ghostscript.com/releases/gsdnld.html
```

### Û±.Û² Ù…Ø§Ú˜ÙˆÙ„ PDF Extractor

**ÙØ§ÛŒÙ„ `scripts/lib/pdf-extractor.mjs`:**

```javascript
/**
 * Ø§Ø³ØªØ®Ø±Ø§Ø¬â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø­ØªÙˆØ§ÛŒ PDF
 * 
 * Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:
 * - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªÙ† Ø¨Ø§ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø±
 * - Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØµØ§ÙˆÛŒØ±
 * - ØªØ´Ø®ÛŒØµ Ø¬Ø¯Ø§ÙˆÙ„
 * - Ø§Ø³ØªØ®Ø±Ø§Ø¬ metadata
 * - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§Ø±Ø³ÛŒ/RTL
 */

import fs from 'fs/promises';
import path from 'path';
import { createRequire } from 'module';

const require = createRequire(import.meta.url);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  tempDir: process.env.TEMP || '/tmp',
  imageOutputDir: 'public/images/extracted',
  imageQuality: 90,
  imageDPI: 150,
  maxImageWidth: 1200,
  supportedFormats: ['.pdf', '.docx', '.doc']
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ PDFExtractor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class PDFExtractor {
  constructor(options = {}) {
    this.options = { ...CONFIG, ...options };
    this.stats = {
      pagesProcessed: 0,
      imagesExtracted: 0,
      tablesDetected: 0
    };
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø­ØªÙˆØ§ÛŒ PDF
   */
  async extract(pdfPath, options = {}) {
    const { extractImages = true, extractTables = true } = options;
    
    console.log(`\nğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ PDF: ${path.basename(pdfPath)}`);
    
    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„
    await fs.access(pdfPath);
    
    // Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„
    const dataBuffer = await fs.readFile(pdfPath);
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ø§ pdf-parse
    const pdfParse = require('pdf-parse');
    const data = await pdfParse(dataBuffer, {
      // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÙØ§Ø±Ø´ÛŒ
      pagerender: this.renderPage.bind(this)
    });
    
    const result = {
      metadata: this.extractMetadata(data),
      content: {
        text: data.text,
        pages: [],
        structure: []
      },
      images: [],
      tables: []
    };
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø§Ø®ØªØ§Ø±
    result.content.structure = this.analyzeStructure(data.text);
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØµØ§ÙˆÛŒØ±
    if (extractImages) {
      result.images = await this.extractImages(pdfPath, options.outputDir);
    }
    
    // ØªØ´Ø®ÛŒØµ Ø¬Ø¯Ø§ÙˆÙ„ (Ø³Ø§Ø¯Ù‡)
    if (extractTables) {
      result.tables = this.detectTables(data.text);
    }
    
    console.log(`   ğŸ“Š ØµÙØ­Ø§Øª: ${data.numpages}`);
    console.log(`   ğŸ–¼ï¸ ØªØµØ§ÙˆÛŒØ±: ${result.images.length}`);
    console.log(`   ğŸ“‹ Ø¬Ø¯Ø§ÙˆÙ„: ${result.tables.length}`);
    
    return result;
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ metadata
   */
  extractMetadata(data) {
    return {
      title: data.info?.Title || null,
      author: data.info?.Author || null,
      subject: data.info?.Subject || null,
      keywords: data.info?.Keywords?.split(',').map(k => k.trim()) || [],
      creator: data.info?.Creator || null,
      producer: data.info?.Producer || null,
      creationDate: data.info?.CreationDate || null,
      modificationDate: data.info?.ModDate || null,
      pageCount: data.numpages,
      version: data.version
    };
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø®ØªØ§Ø± Ù…ØªÙ†
   */
  analyzeStructure(text) {
    const structure = [];
    const lines = text.split('\n');
    
    let currentSection = null;
    let currentContent = [];
    
    for (const line of lines) {
      const trimmed = line.trim();
      if (!trimmed) continue;
      
      // ØªØ´Ø®ÛŒØµ Ø¹Ù†Ø§ÙˆÛŒÙ† (Ø³Ø§Ø¯Ù‡)
      const headingMatch = this.detectHeading(trimmed);
      
      if (headingMatch) {
        // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø®Ø´ Ù‚Ø¨Ù„ÛŒ
        if (currentSection) {
          currentSection.content = currentContent.join('\n');
          structure.push(currentSection);
        }
        
        currentSection = {
          type: 'heading',
          level: headingMatch.level,
          text: headingMatch.text,
          content: ''
        };
        currentContent = [];
      } else if (currentSection) {
        currentContent.push(trimmed);
      } else {
        // Ù…Ø­ØªÙˆØ§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÙˆÙ„ÛŒÙ† Ø¹Ù†ÙˆØ§Ù†
        structure.push({
          type: 'paragraph',
          content: trimmed
        });
      }
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø®Ø´
    if (currentSection) {
      currentSection.content = currentContent.join('\n');
      structure.push(currentSection);
    }
    
    return structure;
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø¹Ù†ÙˆØ§Ù†
   */
  detectHeading(line) {
    // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
    const persianPatterns = [
      { regex: /^ÙØµÙ„\s+[\u06F0-\u06F9Û°-Û¹\d]+[:\s]+(.+)$/i, level: 1 },
      { regex: /^Ø¨Ø®Ø´\s+[\u06F0-\u06F9Û°-Û¹\d]+[:\s]+(.+)$/i, level: 1 },
      { regex: /^[\u06F0-\u06F9Û°-Û¹\d]+[-â€“.]\s*[\u06F0-\u06F9Û°-Û¹\d]*[-â€“.]?\s*(.+)$/, level: 2 },
      { regex: /^[Ø§Ù„Ù-ÛŒ]\)\s*(.+)$/, level: 3 },
    ];
    
    // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
    const englishPatterns = [
      { regex: /^Chapter\s+\d+[:\s]+(.+)$/i, level: 1 },
      { regex: /^Section\s+[\d.]+[:\s]+(.+)$/i, level: 2 },
      { regex: /^\d+\.\s+(.+)$/, level: 2 },
      { regex: /^\d+\.\d+\s+(.+)$/, level: 3 },
    ];
    
    const allPatterns = [...persianPatterns, ...englishPatterns];
    
    for (const pattern of allPatterns) {
      const match = line.match(pattern.regex);
      if (match) {
        return { level: pattern.level, text: match[1] || line };
      }
    }
    
    // ØªØ´Ø®ÛŒØµ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø·ÙˆÙ„ Ùˆ ÙØ±Ù…Øª
    if (line.length < 100 && !line.endsWith('.') && !line.endsWith('ØŸ')) {
      const words = line.split(/\s+/);
      if (words.length <= 10) {
        // Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ø¹Ù†ÙˆØ§Ù†
        return { level: 2, text: line };
      }
    }
    
    return null;
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØµØ§ÙˆÛŒØ± Ø§Ø² PDF
   */
  async extractImages(pdfPath, outputDir) {
    const images = [];
    
    try {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² pdf2pic Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ ØµÙØ­Ø§Øª Ø¨Ù‡ ØªØµÙˆÛŒØ±
      const { fromPath } = require('pdf2pic');
      
      const outputPath = outputDir || path.join(this.options.imageOutputDir, path.basename(pdfPath, '.pdf'));
      await fs.mkdir(outputPath, { recursive: true });
      
      const options = {
        density: this.options.imageDPI,
        saveFilename: 'page',
        savePath: outputPath,
        format: 'png',
        width: this.options.maxImageWidth
      };
      
      const converter = fromPath(pdfPath, options);
      
      // ØªØ¨Ø¯ÛŒÙ„ Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª
      const pdfParse = require('pdf-parse');
      const dataBuffer = await fs.readFile(pdfPath);
      const data = await pdfParse(dataBuffer);
      
      for (let i = 1; i <= data.numpages; i++) {
        try {
          const result = await converter(i);
          if (result.path) {
            images.push({
              page: i,
              path: result.path,
              name: result.name
            });
            this.stats.imagesExtracted++;
          }
        } catch (err) {
          console.warn(`   âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ù‡ ${i}`);
        }
      }
      
    } catch (error) {
      console.warn(`   âš ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØµØ§ÙˆÛŒØ± Ù…Ù…Ú©Ù† Ù†Ø´Ø¯: ${error.message}`);
    }
    
    return images;
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø¬Ø¯Ø§ÙˆÙ„ (Ø³Ø§Ø¯Ù‡)
   */
  detectTables(text) {
    const tables = [];
    const lines = text.split('\n');
    
    let inTable = false;
    let currentTable = [];
    
    for (const line of lines) {
      // ØªØ´Ø®ÛŒØµ Ø®Ø·ÙˆØ· Ø¬Ø¯ÙˆÙ„â€ŒÙ…Ø§Ù†Ù†Ø¯
      const isTableLine = this.isTableLine(line);
      
      if (isTableLine) {
        if (!inTable) {
          inTable = true;
          currentTable = [];
        }
        currentTable.push(this.parseTableRow(line));
      } else if (inTable) {
        if (currentTable.length >= 2) {
          tables.push({
            rows: currentTable,
            markdown: this.tableToMarkdown(currentTable)
          });
          this.stats.tablesDetected++;
        }
        inTable = false;
        currentTable = [];
      }
    }
    
    return tables;
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø®Ø· Ø¬Ø¯ÙˆÙ„
   */
  isTableLine(line) {
    // Ø®Ø·ÙˆØ· Ø¨Ø§ ØªØ¨ ÛŒØ§ Ú†Ù†Ø¯ ÙØ§ØµÙ„Ù‡ Ù…ØªÙˆØ§Ù„ÛŒ
    const tabCount = (line.match(/\t/g) || []).length;
    const multiSpaceCount = (line.match(/\s{3,}/g) || []).length;
    
    return tabCount >= 2 || multiSpaceCount >= 2;
  }

  /**
   * Ù¾Ø§Ø±Ø³ Ø±Ø¯ÛŒÙ Ø¬Ø¯ÙˆÙ„
   */
  parseTableRow(line) {
    // ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¨ ÛŒØ§ Ú†Ù†Ø¯ ÙØ§ØµÙ„Ù‡
    return line.split(/\t|\s{3,}/).map(cell => cell.trim()).filter(Boolean);
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¬Ø¯ÙˆÙ„ Ø¨Ù‡ Markdown
   */
  tableToMarkdown(rows) {
    if (rows.length === 0) return '';
    
    const maxCols = Math.max(...rows.map(r => r.length));
    
    // Ù‡Ø¯Ø±
    const header = rows[0].map(cell => cell || '').concat(Array(maxCols - rows[0].length).fill(''));
    const separator = Array(maxCols).fill('---');
    
    let md = `| ${header.join(' | ')} |\n`;
    md += `| ${separator.join(' | ')} |\n`;
    
    // Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i].concat(Array(maxCols - rows[i].length).fill(''));
      md += `| ${row.join(' | ')} |\n`;
    }
    
    return md;
  }

  /**
   * Ø±Ù†Ø¯Ø± ØµÙØ­Ù‡ (callback Ø¨Ø±Ø§ÛŒ pdf-parse)
   */
  renderPage(pageData) {
    return pageData.getTextContent().then(textContent => {
      let text = '';
      let lastY = null;
      
      for (const item of textContent.items) {
        if (lastY !== null && Math.abs(lastY - item.transform[5]) > 5) {
          text += '\n';
        }
        text += item.str;
        lastY = item.transform[5];
      }
      
      return text;
    });
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ PDF Ø¨Ù‡ Markdown
   */
  async toMarkdown(pdfPath, options = {}) {
    const data = await this.extract(pdfPath, options);
    
    let markdown = '';
    
    // Ø¹Ù†ÙˆØ§Ù† Ø§Ø² metadata
    if (data.metadata.title) {
      markdown += `# ${data.metadata.title}\n\n`;
    }
    
    // Ø³Ø§Ø®ØªØ§Ø± Ø¨Ù‡ Markdown
    for (const item of data.content.structure) {
      if (item.type === 'heading') {
        markdown += `${'#'.repeat(item.level + 1)} ${item.text}\n\n`;
        if (item.content) {
          markdown += `${item.content}\n\n`;
        }
      } else if (item.type === 'paragraph') {
        markdown += `${item.content}\n\n`;
      }
    }
    
    // Ø¬Ø¯Ø§ÙˆÙ„
    for (const table of data.tables) {
      markdown += `\n${table.markdown}\n`;
    }
    
    return {
      markdown,
      metadata: data.metadata,
      images: data.images
    };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ WordExtractor (Ø¨Ø±Ø§ÛŒ .docx)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class WordExtractor {
  constructor(options = {}) {
    this.options = options;
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø­ØªÙˆØ§ÛŒ Word
   */
  async extract(docxPath) {
    const mammoth = require('mammoth');
    
    console.log(`\nğŸ“ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Word: ${path.basename(docxPath)}`);
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ HTML
    const result = await mammoth.convertToHtml({ path: docxPath });
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Markdown
    const markdown = await mammoth.convertToMarkdown({ path: docxPath });
    
    return {
      html: result.value,
      markdown: markdown.value,
      messages: result.messages
    };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ UniversalExtractor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class UniversalExtractor {
  constructor(options = {}) {
    this.pdfExtractor = new PDFExtractor(options);
    this.wordExtractor = new WordExtractor(options);
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø² Ù‡Ø± ÙØ±Ù…Øª
   */
  async extract(filePath, options = {}) {
    const ext = path.extname(filePath).toLowerCase();
    
    switch (ext) {
      case '.pdf':
        return this.pdfExtractor.toMarkdown(filePath, options);
      
      case '.docx':
      case '.doc':
        return this.wordExtractor.extract(filePath);
      
      default:
        throw new Error(`ÙØ±Ù…Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯: ${ext}`);
    }
  }
}

export default PDFExtractor;
```

---

## ğŸ¤– Ø¨Ø®Ø´ Û²: ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ AI

### Û².Û± Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§

```powershell
# Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² OpenAI ÛŒØ§ Claude
npm install -D openai @anthropic-ai/sdk

# Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø­Ù„ÛŒ (Ollama)
# Ù†ØµØ¨ Ollama Ø§Ø²: https://ollama.ai/download
# Ø³Ù¾Ø³:
# ollama pull llama3
# ollama pull mistral
```

### Û².Û² Ù…Ø§Ú˜ÙˆÙ„ AI Tagger

**ÙØ§ÛŒÙ„ `scripts/lib/ai-tagger.mjs`:**

```javascript
/**
 * Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ AI
 * 
 * Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:
 * - ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
 * - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
 * - ØªÙˆÙ„ÛŒØ¯ Ø®Ù„Ø§ØµÙ‡
 * - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡
 * - ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù†
 * - ØªØ®Ù…ÛŒÙ† Ø²Ù…Ø§Ù† Ù…Ø·Ø§Ù„Ø¹Ù‡
 * - ØªØ­Ù„ÛŒÙ„ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ
 */

import fs from 'fs/promises';
import path from 'path';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  // Ø§Ù†ØªØ®Ø§Ø¨ Provider
  provider: process.env.AI_PROVIDER || 'openai', // 'openai', 'anthropic', 'ollama'
  
  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª OpenAI
  openai: {
    apiKey: process.env.OPENAI_API_KEY,
    model: 'gpt-4o-mini', // ÛŒØ§ 'gpt-4o' Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙÛŒØª Ø¨Ù‡ØªØ±
    maxTokens: 2000
  },
  
  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Anthropic (Claude)
  anthropic: {
    apiKey: process.env.ANTHROPIC_API_KEY,
    model: 'claude-sonnet-4-20250514',
    maxTokens: 2000
  },
  
  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ollama (Ù…Ø­Ù„ÛŒ)
  ollama: {
    baseUrl: process.env.OLLAMA_URL || 'http://localhost:11434',
    model: process.env.OLLAMA_MODEL || 'llama3'
  },
  
  // Ú©Ø´
  cacheDir: '.content-cache/ai',
  cacheEnabled: true,
  
  // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡
  predefinedCategories: {
    fa: [
      'Ø³ÛŒØ§Ø³Øª', 'Ø§Ù‚ØªØµØ§Ø¯', 'Ø¬Ø§Ù…Ø¹Ù‡', 'ÙØ±Ù‡Ù†Ú¯', 'ØªØ§Ø±ÛŒØ®',
      'ÙÙ†Ø§ÙˆØ±ÛŒ', 'Ø¹Ù„Ù…', 'Ù‡Ù†Ø±', 'ÙˆØ±Ø²Ø´', 'Ø³Ù„Ø§Ù…Øª',
      'Ø¢Ù…ÙˆØ²Ø´', 'Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª', 'Ø­Ù‚ÙˆÙ‚', 'ÙÙ„Ø³ÙÙ‡', 'Ø¯ÛŒÙ†'
    ],
    en: [
      'Politics', 'Economy', 'Society', 'Culture', 'History',
      'Technology', 'Science', 'Art', 'Sports', 'Health',
      'Education', 'Environment', 'Law', 'Philosophy', 'Religion'
    ]
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ AIProvider - Ø±Ø§Ø¨Ø· ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class AIProvider {
  constructor(providerName) {
    this.providerName = providerName;
    this.client = null;
    this.initialized = false;
  }

  async initialize() {
    if (this.initialized) return;

    switch (this.providerName) {
      case 'openai':
        const OpenAI = (await import('openai')).default;
        this.client = new OpenAI({ apiKey: CONFIG.openai.apiKey });
        break;
      
      case 'anthropic':
        const Anthropic = (await import('@anthropic-ai/sdk')).default;
        this.client = new Anthropic({ apiKey: CONFIG.anthropic.apiKey });
        break;
      
      case 'ollama':
        // Ollama Ø§Ø² HTTP API Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        this.client = {
          baseUrl: CONFIG.ollama.baseUrl,
          model: CONFIG.ollama.model
        };
        break;
      
      default:
        throw new Error(`Provider Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡: ${this.providerName}`);
    }

    this.initialized = true;
  }

  async complete(prompt, options = {}) {
    await this.initialize();

    switch (this.providerName) {
      case 'openai':
        return this.completeOpenAI(prompt, options);
      
      case 'anthropic':
        return this.completeAnthropic(prompt, options);
      
      case 'ollama':
        return this.completeOllama(prompt, options);
    }
  }

  async completeOpenAI(prompt, options = {}) {
    const response = await this.client.chat.completions.create({
      model: options.model || CONFIG.openai.model,
      messages: [
        { role: 'system', content: options.systemPrompt || 'You are a helpful assistant.' },
        { role: 'user', content: prompt }
      ],
      max_tokens: options.maxTokens || CONFIG.openai.maxTokens,
      temperature: options.temperature || 0.3,
      response_format: options.jsonMode ? { type: 'json_object' } : undefined
    });

    return response.choices[0].message.content;
  }

  async completeAnthropic(prompt, options = {}) {
    const response = await this.client.messages.create({
      model: options.model || CONFIG.anthropic.model,
      max_tokens: options.maxTokens || CONFIG.anthropic.maxTokens,
      system: options.systemPrompt || 'You are a helpful assistant.',
      messages: [
        { role: 'user', content: prompt }
      ]
    });

    return response.content[0].text;
  }

  async completeOllama(prompt, options = {}) {
    const response = await fetch(`${this.client.baseUrl}/api/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: options.model || this.client.model,
        prompt: prompt,
        stream: false,
        options: {
          temperature: options.temperature || 0.3
        }
      })
    });

    const data = await response.json();
    return data.response;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ AITagger
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class AITagger {
  constructor(options = {}) {
    this.provider = new AIProvider(options.provider || CONFIG.provider);
    this.cacheEnabled = options.cacheEnabled ?? CONFIG.cacheEnabled;
    this.cacheDir = options.cacheDir || CONFIG.cacheDir;
    this.stats = {
      processed: 0,
      cached: 0,
      failed: 0
    };
  }

  /**
   * ØªØ­Ù„ÛŒÙ„ Ú©Ø§Ù…Ù„ Ù…Ø­ØªÙˆØ§
   */
  async analyze(content, options = {}) {
    const { title, forceRefresh = false, lang = 'fa' } = options;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´
    const cacheKey = this.getCacheKey(content, title);
    if (this.cacheEnabled && !forceRefresh) {
      const cached = await this.getFromCache(cacheKey);
      if (cached) {
        this.stats.cached++;
        return cached;
      }
    }
    
    console.log(`   ğŸ¤– ØªØ­Ù„ÛŒÙ„ AI...`);
    
    try {
      // ØªØ­Ù„ÛŒÙ„ Ø§ØµÙ„ÛŒ
      const result = await this.performAnalysis(content, title, lang);
      
      // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
      if (this.cacheEnabled) {
        await this.saveToCache(cacheKey, result);
      }
      
      this.stats.processed++;
      return result;
      
    } catch (error) {
      console.error(`   âŒ Ø®Ø·Ø§ÛŒ AI: ${error.message}`);
      this.stats.failed++;
      
      // Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ù†ØªÛŒØ¬Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
      return this.getDefaultResult(title, lang);
    }
  }

  /**
   * Ø§Ù†Ø¬Ø§Ù… ØªØ­Ù„ÛŒÙ„
   */
  async performAnalysis(content, title, lang) {
    const truncatedContent = content.slice(0, 4000); // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªÙˆÚ©Ù†
    
    const prompt = this.buildPrompt(title, truncatedContent, lang);
    
    const response = await this.provider.complete(prompt, {
      systemPrompt: this.getSystemPrompt(lang),
      jsonMode: true,
      temperature: 0.3
    });
    
    // Ù¾Ø§Ø±Ø³ JSON
    try {
      const result = JSON.parse(response);
      return this.validateAndEnrich(result, lang);
    } catch {
      // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ JSON Ø§Ø² Ù…ØªÙ†
      const jsonMatch = response.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        return this.validateAndEnrich(JSON.parse(jsonMatch[0]), lang);
      }
      throw new Error('Ù¾Ø§Ø³Ø® AI Ù‚Ø§Ø¨Ù„ Ù¾Ø§Ø±Ø³ Ù†ÛŒØ³Øª');
    }
  }

  /**
   * System Prompt
   */
  getSystemPrompt(lang) {
    if (lang === 'fa') {
      return `ØªÙˆ ÛŒÚ© Ø³ÛŒØ³ØªÙ… ØªØ­Ù„ÛŒÙ„ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§Ø±Ø³ÛŒ Ù‡Ø³ØªÛŒ. ÙˆØ¸ÛŒÙÙ‡ ØªÙˆ:
1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·
2. ØªØ¹ÛŒÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÙˆØ¶ÙˆØ¹ÛŒ
3. Ù†ÙˆØ´ØªÙ† Ø®Ù„Ø§ØµÙ‡ Ú©ÙˆØªØ§Ù‡
4. ØªØ®Ù…ÛŒÙ† Ø²Ù…Ø§Ù† Ù…Ø·Ø§Ù„Ø¹Ù‡
5. ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ
6. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…

Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª JSON Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†.`;
    }
    
    return `You are a content analysis system. Your tasks:
1. Extract relevant tags
2. Determine topic category
3. Write a brief summary
4. Estimate reading time
5. Determine difficulty level
6. Extract important keywords

Always return valid JSON.`;
  }

  /**
   * Ø³Ø§Ø®Øª Prompt
   */
  buildPrompt(title, content, lang) {
    const categories = CONFIG.predefinedCategories[lang] || CONFIG.predefinedCategories.en;
    
    if (lang === 'fa') {
      return `
Ø¹Ù†ÙˆØ§Ù†: ${title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}

Ù…ØªÙ†:
${content}

---

Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ† Ù…ØªÙ† Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ù† Ùˆ Ù†ØªÛŒØ¬Ù‡ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª JSON Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ø²ÛŒØ± Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†:

{
  "tags": ["ØªÚ¯Û±", "ØªÚ¯Û²", "ØªÚ¯Û³", "ØªÚ¯Û´", "ØªÚ¯Ûµ"],
  "category": {
    "primary": "Ø¯Ø³ØªÙ‡ Ø§ØµÙ„ÛŒ",
    "secondary": ["Ø¯Ø³ØªÙ‡ ÙØ±Ø¹ÛŒ Û±", "Ø¯Ø³ØªÙ‡ ÙØ±Ø¹ÛŒ Û²"]
  },
  "summary": "Ø®Ù„Ø§ØµÙ‡ Û²-Û³ Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ",
  "description": "ØªÙˆØ¶ÛŒØ­ ÛŒÚ© Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ SEO",
  "keywords": ["Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡Û±", "Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡Û²", "Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡Û³"],
  "readingTime": 5,
  "difficulty": "Ù…ØªÙˆØ³Ø·",
  "audience": ["Ù…Ø®Ø§Ø·Ø¨Û±", "Ù…Ø®Ø§Ø·Ø¨Û²"],
  "sentiment": "Ø®Ù†Ø«ÛŒ",
  "language": "fa",
  "topics": ["Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø±ØªØ¨Ø· Û±", "Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø±ØªØ¨Ø· Û²"]
}

Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²: ${categories.join('ØŒ ')}
Ø³Ø·ÙˆØ­ Ø¯Ø´ÙˆØ§Ø±ÛŒ: Ù…Ø¨ØªØ¯ÛŒØŒ Ù…ØªÙˆØ³Ø·ØŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ØŒ ØªØ®ØµØµÛŒ
Ø§Ø­Ø³Ø§Ø³: Ù…Ø«Ø¨ØªØŒ Ù…Ù†ÙÛŒØŒ Ø®Ù†Ø«ÛŒØŒ ØªØ­Ù„ÛŒÙ„ÛŒØŒ Ø§Ù†ØªÙ‚Ø§Ø¯ÛŒ`;
    }
    
    return `
Title: ${title || 'Untitled'}

Content:
${content}

---

Analyze this text and return JSON with this structure:

{
  "tags": ["tag1", "tag2", "tag3", "tag4", "tag5"],
  "category": {
    "primary": "main category",
    "secondary": ["sub1", "sub2"]
  },
  "summary": "2-3 sentence summary",
  "description": "One sentence SEO description",
  "keywords": ["keyword1", "keyword2", "keyword3"],
  "readingTime": 5,
  "difficulty": "intermediate",
  "audience": ["audience1", "audience2"],
  "sentiment": "neutral",
  "language": "en",
  "topics": ["related topic 1", "related topic 2"]
}

Allowed categories: ${categories.join(', ')}
Difficulty levels: beginner, intermediate, advanced, expert
Sentiment: positive, negative, neutral, analytical, critical`;
  }

  /**
   * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ùˆ ØºÙ†ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ù†ØªÛŒØ¬Ù‡
   */
  validateAndEnrich(result, lang) {
    // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ
    const validated = {
      tags: Array.isArray(result.tags) ? result.tags.slice(0, 10) : [],
      category: result.category || { primary: lang === 'fa' ? 'Ù…ØªÙØ±Ù‚Ù‡' : 'Miscellaneous', secondary: [] },
      summary: result.summary || '',
      description: result.description || result.summary?.slice(0, 160) || '',
      keywords: Array.isArray(result.keywords) ? result.keywords.slice(0, 10) : [],
      readingTime: typeof result.readingTime === 'number' ? result.readingTime : 5,
      difficulty: result.difficulty || (lang === 'fa' ? 'Ù…ØªÙˆØ³Ø·' : 'intermediate'),
      audience: Array.isArray(result.audience) ? result.audience : [],
      sentiment: result.sentiment || (lang === 'fa' ? 'Ø®Ù†Ø«ÛŒ' : 'neutral'),
      language: result.language || lang,
      topics: Array.isArray(result.topics) ? result.topics : [],
      
      // Ù…ØªØ§Ø¯ÛŒØªØ§ÛŒ Ø§Ø¶Ø§ÙÛŒ
      _analyzed: new Date().toISOString(),
      _provider: this.provider.providerName
    };
    
    return validated;
  }

  /**
   * Ù†ØªÛŒØ¬Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
   */
  getDefaultResult(title, lang) {
    return {
      tags: [],
      category: { primary: lang === 'fa' ? 'Ù…ØªÙØ±Ù‚Ù‡' : 'Miscellaneous', secondary: [] },
      summary: '',
      description: '',
      keywords: title ? title.split(/\s+/).slice(0, 5) : [],
      readingTime: 5,
      difficulty: lang === 'fa' ? 'Ù…ØªÙˆØ³Ø·' : 'intermediate',
      audience: [],
      sentiment: lang === 'fa' ? 'Ø®Ù†Ø«ÛŒ' : 'neutral',
      language: lang,
      topics: [],
      _analyzed: new Date().toISOString(),
      _provider: 'fallback'
    };
  }

  /**
   * ØªÙˆÙ„ÛŒØ¯ Ø®Ù„Ø§ØµÙ‡
   */
  async generateSummary(content, options = {}) {
    const { maxLength = 200, lang = 'fa' } = options;
    
    const prompt = lang === 'fa'
      ? `Ø§ÛŒÙ† Ù…ØªÙ† Ø±Ø§ Ø¯Ø± Ø­Ø¯Ø§Ú©Ø«Ø± ${maxLength} Ú©Ù„Ù…Ù‡ Ø®Ù„Ø§ØµÙ‡ Ú©Ù†:\n\n${content.slice(0, 3000)}`
      : `Summarize this text in maximum ${maxLength} words:\n\n${content.slice(0, 3000)}`;
    
    const response = await this.provider.complete(prompt, {
      temperature: 0.5,
      maxTokens: 500
    });
    
    return response.trim();
  }

  /**
   * Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¹Ù†Ø§ÙˆÛŒÙ† Ù…Ø±ØªØ¨Ø·
   */
  async suggestRelatedTopics(content, options = {}) {
    const { count = 5, lang = 'fa' } = options;
    
    const prompt = lang === 'fa'
      ? `Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ† Ù…ØªÙ†ØŒ ${count} Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø±ØªØ¨Ø· Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡ (ÙÙ‚Ø· Ù„ÛŒØ³ØªØŒ Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­):\n\n${content.slice(0, 2000)}`
      : `Based on this text, suggest ${count} related topics (list only, no explanations):\n\n${content.slice(0, 2000)}`;
    
    const response = await this.provider.complete(prompt, {
      temperature: 0.7
    });
    
    // Ù¾Ø§Ø±Ø³ Ù„ÛŒØ³Øª
    return response
      .split('\n')
      .map(line => line.replace(/^[\d\-\*\.]+\s*/, '').trim())
      .filter(Boolean)
      .slice(0, count);
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù†
   */
  detectLanguage(text) {
    // ØªØ´Ø®ÛŒØµ Ø³Ø§Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§
    const persianChars = (text.match(/[\u0600-\u06FF]/g) || []).length;
    const latinChars = (text.match(/[a-zA-Z]/g) || []).length;
    
    if (persianChars > latinChars * 0.3) {
      return 'fa';
    }
    return 'en';
  }

  /**
   * ØªØ®Ù…ÛŒÙ† Ø²Ù…Ø§Ù† Ù…Ø·Ø§Ù„Ø¹Ù‡
   */
  estimateReadingTime(content, lang = 'fa') {
    const words = content.split(/\s+/).length;
    
    // Ø³Ø±Ø¹Øª Ø®ÙˆØ§Ù†Ø¯Ù† (Ú©Ù„Ù…Ù‡ Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡)
    const wpm = lang === 'fa' ? 150 : 200;
    
    return Math.max(1, Math.ceil(words / wpm));
  }

  /**
   * Ú©Ø´
   */
  getCacheKey(content, title) {
    const crypto = require('crypto');
    const hash = crypto
      .createHash('md5')
      .update(content.slice(0, 1000) + (title || ''))
      .digest('hex');
    return hash;
  }

  async getFromCache(key) {
    try {
      const cachePath = path.join(this.cacheDir, `${key}.json`);
      const data = await fs.readFile(cachePath, 'utf-8');
      return JSON.parse(data);
    } catch {
      return null;
    }
  }

  async saveToCache(key, data) {
    await fs.mkdir(this.cacheDir, { recursive: true });
    const cachePath = path.join(this.cacheDir, `${key}.json`);
    await fs.writeFile(cachePath, JSON.stringify(data, null, 2));
  }

  /**
   * Ø¢Ù…Ø§Ø±
   */
  getStats() {
    return { ...this.stats };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ BatchProcessor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class AIBatchProcessor {
  constructor(options = {}) {
    this.tagger = new AITagger(options);
    this.concurrency = options.concurrency || 3;
    this.delayBetweenRequests = options.delay || 1000;
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
   */
  async processBatch(items, options = {}) {
    const results = [];
    const queue = [...items];
    
    console.log(`\nğŸ¤– Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ: ${items.length} Ø¢ÛŒØªÙ…`);
    
    while (queue.length > 0) {
      const batch = queue.splice(0, this.concurrency);
      
      const batchResults = await Promise.all(
        batch.map(async (item, index) => {
          // ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² rate limiting
          if (index > 0) {
            await this.delay(this.delayBetweenRequests);
          }
          
          try {
            const result = await this.tagger.analyze(item.content, {
              title: item.title,
              lang: item.lang || 'fa'
            });
            
            return { ...item, ai: result, success: true };
          } catch (error) {
            return { ...item, error: error.message, success: false };
          }
        })
      );
      
      results.push(...batchResults);
      
      const progress = Math.round((results.length / items.length) * 100);
      console.log(`   ğŸ“Š Ù¾ÛŒØ´Ø±ÙØª: ${progress}%`);
    }
    
    const stats = this.tagger.getStats();
    console.log(`\nâœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù…Ù„ Ø´Ø¯!`);
    console.log(`   Ù…ÙˆÙÙ‚: ${stats.processed}, Ú©Ø´: ${stats.cached}, Ø®Ø·Ø§: ${stats.failed}`);
    
    return results;
  }

  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

export default AITagger;
```

---

## ğŸ”— ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Pipeline Ø§ØµÙ„ÛŒ

### Û³.Û± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ `process-content.mjs`

**ÙØ§ÛŒÙ„ `scripts/process-content.mjs` (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø´Ø¯Ù‡):**

```javascript
#!/usr/bin/env node
/**
 * Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø­ØªÙˆØ§
 * Ù†Ø³Ø®Ù‡ Û².Û° - Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ PDF Ùˆ AI
 */

import fs from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';
import { globby } from 'globby';

// Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ
import { PreambleParser } from './lib/preamble-parser.mjs';
import { StyleGenerator } from './lib/style-generator.mjs';
import { SmartRenderer } from './lib/smart-renderer.mjs';
import { PDFExtractor, UniversalExtractor } from './lib/pdf-extractor.mjs';
import { AITagger, AIBatchProcessor } from './lib/ai-tagger.mjs';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  sourceDir: 'content-source',
  outputDir: 'src/content',
  cacheDir: '.content-cache',
  stylesDir: 'src/styles/book-themes',
  diagramsDir: 'public/diagrams',
  imagesDir: 'public/images/extracted',
  
  // ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡
  supportedFormats: {
    latex: ['.tex'],
    markdown: ['.md', '.mdx'],
    pdf: ['.pdf'],
    word: ['.docx', '.doc']
  },
  
  // AI
  ai: {
    enabled: process.env.AI_ENABLED !== 'false',
    provider: process.env.AI_PROVIDER || 'openai'
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ ContentPipeline (Ù†Ø³Ø®Ù‡ Û²)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class ContentPipeline {
  constructor(options = {}) {
    // Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
    this.parser = new PreambleParser();
    this.styleGen = new StyleGenerator(CONFIG.stylesDir);
    this.renderer = new SmartRenderer({
      outputDir: CONFIG.diagramsDir,
      cacheDir: CONFIG.cacheDir
    });
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
    this.pdfExtractor = new PDFExtractor({
      imageOutputDir: CONFIG.imagesDir
    });
    this.universalExtractor = new UniversalExtractor();
    
    // AI
    this.aiEnabled = options.aiEnabled ?? CONFIG.ai.enabled;
    if (this.aiEnabled) {
      this.aiTagger = new AITagger({
        provider: options.aiProvider || CONFIG.ai.provider
      });
    }
    
    // Ú©Ø´
    this.configCache = new Map();
    
    // Ø¢Ù…Ø§Ø±
    this.stats = {
      latex: 0,
      markdown: 0,
      pdf: 0,
      word: 0,
      aiTagged: 0,
      errors: 0
    };
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„ (Ù‡Ø± ÙØ±Ù…ØªÛŒ)
   */
  async processFile(filePath, options = {}) {
    const ext = path.extname(filePath).toLowerCase();
    const { lang = this.detectLanguage(filePath), outputDir } = options;
    
    console.log(`\nğŸ“„ Ù¾Ø±Ø¯Ø§Ø²Ø´: ${path.basename(filePath)}`);
    
    try {
      let result;
      
      // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´
      if (CONFIG.supportedFormats.latex.includes(ext)) {
        result = await this.processLaTeX(filePath, options);
        this.stats.latex++;
      } 
      else if (CONFIG.supportedFormats.markdown.includes(ext)) {
        result = await this.processMarkdown(filePath, options);
        this.stats.markdown++;
      }
      else if (CONFIG.supportedFormats.pdf.includes(ext)) {
        result = await this.processPDF(filePath, options);
        this.stats.pdf++;
      }
      else if (CONFIG.supportedFormats.word.includes(ext)) {
        result = await this.processWord(filePath, options);
        this.stats.word++;
      }
      else {
        throw new Error(`ÙØ±Ù…Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯: ${ext}`);
      }
      
      // ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ AI
      if (this.aiEnabled && result) {
        result = await this.enrichWithAI(result, lang);
        this.stats.aiTagged++;
      }
      
      // Ø°Ø®ÛŒØ±Ù‡
      if (result && outputDir) {
        await this.saveResult(result, outputDir);
      }
      
      return result;
      
    } catch (error) {
      this.stats.errors++;
      console.error(`   âŒ Ø®Ø·Ø§: ${error.message}`);
      throw error;
    }
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„ LaTeX
   */
  async processLaTeX(filePath, options = {}) {
    const { bookSlug, chapterNumber, config } = options;
    
    let content = await fs.readFile(filePath, 'utf-8');
    
    // Ø¯Ø±ÛŒØ§ÙØª ÛŒØ§ Ø³Ø§Ø®Øª config
    const finalConfig = config || await this.getDefaultConfig();
    
    // Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
    const prefix = bookSlug ? `${bookSlug}-ch${chapterNumber || 0}` : path.basename(filePath, '.tex');
    content = await this.processAllDiagrams(content, finalConfig, prefix);
    
    // Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    content = this.preProcessLaTeX(content);
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
    const markdown = await this.convertWithPandoc(content);
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†ÙˆØ§Ù†
    const title = this.extractTitle(markdown) || path.basename(filePath, '.tex');
    
    return {
      type: 'latex',
      source: filePath,
      title,
      content: markdown,
      metadata: { bookSlug, chapterNumber }
    };
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Markdown
   */
  async processMarkdown(filePath, options = {}) {
    const content = await fs.readFile(filePath, 'utf-8');
    
    // Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† frontmatter
    const { data: frontmatter, content: body } = await this.parseFrontmatter(content);
    
    const title = frontmatter.title || this.extractTitle(body) || path.basename(filePath, '.md');
    
    return {
      type: 'markdown',
      source: filePath,
      title,
      content: body,
      frontmatter,
      metadata: {}
    };
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ PDF
   */
  async processPDF(filePath, options = {}) {
    console.log(`   ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø² PDF...`);
    
    const extracted = await this.pdfExtractor.toMarkdown(filePath, {
      outputDir: path.join(CONFIG.imagesDir, path.basename(filePath, '.pdf'))
    });
    
    const title = extracted.metadata.title || path.basename(filePath, '.pdf');
    
    return {
      type: 'pdf',
      source: filePath,
      title,
      content: extracted.markdown,
      pdfMetadata: extracted.metadata,
      images: extracted.images,
      metadata: {}
    };
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Word
   */
  async processWord(filePath, options = {}) {
    console.log(`   ğŸ“ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø² Word...`);
    
    const extracted = await this.universalExtractor.extract(filePath);
    
    const title = this.extractTitle(extracted.markdown) || path.basename(filePath, '.docx');
    
    return {
      type: 'word',
      source: filePath,
      title,
      content: extracted.markdown,
      metadata: {}
    };
  }

  /**
   * ØºÙ†ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ AI
   */
  async enrichWithAI(result, lang = 'fa') {
    if (!this.aiTagger) return result;
    
    console.log(`   ğŸ¤– ØªØ­Ù„ÛŒÙ„ AI...`);
    
    const aiResult = await this.aiTagger.analyze(result.content, {
      title: result.title,
      lang
    });
    
    return {
      ...result,
      ai: aiResult
    };
  }

  /**
   * Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡
   */
  async saveResult(result, outputDir) {
    await fs.mkdir(outputDir, { recursive: true });
    
    // Ø³Ø§Ø®Øª frontmatter
    const frontmatter = this.buildFrontmatter(result);
    
    // Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
    const finalContent = `---\n${this.stringifyYaml(frontmatter)}\n---\n\n${result.content}`;
    
    // Ù†Ø§Ù… ÙØ§ÛŒÙ„
    const baseName = path.basename(result.source, path.extname(result.source));
    const outputPath = path.join(outputDir, `${baseName}.md`);
    
    await fs.writeFile(outputPath, finalContent, 'utf-8');
    console.log(`   ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡: ${path.basename(outputPath)}`);
    
    return outputPath;
  }

  /**
   * Ø³Ø§Ø®Øª frontmatter
   */
  buildFrontmatter(result) {
    const fm = {
      title: result.title,
      description: result.ai?.description || result.ai?.summary?.slice(0, 160) || '',
      lang: result.metadata?.lang || 'fa',
      publishDate: new Date().toISOString().split('T')[0]
    };
    
    // Ø§Ø² AI
    if (result.ai) {
      if (result.ai.tags?.length) fm.tags = result.ai.tags;
      if (result.ai.category?.primary) fm.category = result.ai.category.primary;
      if (result.ai.keywords?.length) fm.keywords = result.ai.keywords;
      if (result.ai.readingTime) fm.readingTime = result.ai.readingTime;
      if (result.ai.difficulty) fm.difficulty = result.ai.difficulty;
      if (result.ai.summary) fm.summary = result.ai.summary;
    }
    
    // Ù…ØªØ§Ø¯ÛŒØªØ§ÛŒ Ø®Ø§Øµ
    if (result.metadata?.bookSlug) {
      fm.book = result.metadata.bookSlug;
    }
    if (result.metadata?.chapterNumber) {
      fm.chapterNumber = result.metadata.chapterNumber;
    }
    
    // Ù†ÙˆØ¹ Ù…Ù†Ø¨Ø¹
    fm.sourceType = result.type;
    
    return fm;
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ YAML
   */
  stringifyYaml(obj) {
    const lines = [];
    
    for (const [key, value] of Object.entries(obj)) {
      if (value === undefined || value === null) continue;
      
      if (Array.isArray(value)) {
        lines.push(`${key}:`);
        value.forEach(item => lines.push(`  - "${item}"`));
      } else if (typeof value === 'object') {
        lines.push(`${key}:`);
        for (const [k, v] of Object.entries(value)) {
          lines.push(`  ${k}: "${v}"`);
        }
      } else if (typeof value === 'string' && value.includes('\n')) {
        lines.push(`${key}: |`);
        value.split('\n').forEach(line => lines.push(`  ${line}`));
      } else if (typeof value === 'string') {
        lines.push(`${key}: "${value.replace(/"/g, '\\"')}"`);
      } else {
        lines.push(`${key}: ${value}`);
      }
    }
    
    return lines.join('\n');
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
   */
  async processAllDiagrams(content, config, prefix) {
    const tikzRegex = /\\begin\{tikzpicture\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{tikzpicture\}/g;
    const matches = [...content.matchAll(tikzRegex)];
    
    if (matches.length > 0) {
      console.log(`   ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: ${matches.length}`);
    }
    
    let counter = 0;
    for (const match of matches) {
      counter++;
      const tikzCode = match[0];
      const name = `${prefix}-${counter}`;
      
      const result = await this.renderer.render(tikzCode, config, { name });
      
      if (result.success) {
        const relativePath = `/diagrams/${path.basename(result.path)}`;
        const replacement = `\n\n![Ù†Ù…ÙˆØ¯Ø§Ø± ${counter}](${relativePath}){.tikz-diagram}\n\n`;
        content = content.replace(tikzCode, replacement);
      } else {
        content = content.replace(tikzCode, `\n\n<!-- DIAGRAM_ERROR: ${name} -->\n\n`);
      }
    }
    
    return content;
  }

  /**
   * Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ LaTeX
   */
  preProcessLaTeX(content) {
    return content
      .replace(
        /\\begin\{tcolorbox\}\[([^\]]*title=\{([^}]*)\}[^\]]*)\]([\s\S]*?)\\end\{tcolorbox\}/g,
        (_, opts, title, body) => `\n\n> **${title}**\n> ${body.trim().replace(/\n/g, '\n> ')}\n\n`
      )
      .replace(/\\renewcommand\{[^}]*\}\{[^}]*\}/g, '')
      .replace(/\\setcounter\{[^}]*\}\{[^}]*\}/g, '');
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc
   */
  async convertWithPandoc(content) {
    const { exec } = await import('child_process');
    const { promisify } = await import('util');
    const execAsync = promisify(exec);
    
    const tempDir = path.join(CONFIG.cacheDir, 'temp');
    await fs.mkdir(tempDir, { recursive: true });
    
    const timestamp = Date.now();
    const inputFile = path.join(tempDir, `input-${timestamp}.tex`);
    const outputFile = path.join(tempDir, `output-${timestamp}.md`);
    
    await fs.writeFile(inputFile, content, 'utf-8');
    
    await execAsync(`pandoc "${inputFile}" -o "${outputFile}" --wrap=none --columns=1000`, {
      timeout: 60000
    });
    
    const result = await fs.readFile(outputFile, 'utf-8');
    
    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
    await fs.unlink(inputFile).catch(() => {});
    await fs.unlink(outputFile).catch(() => {});
    
    return this.postProcessMarkdown(result);
  }

  /**
   * Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Markdown
   */
  postProcessMarkdown(markdown) {
    return markdown
      .replace(/\[node distance[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\\node[\s\S]*?;/g, '')
      .replace(/\\draw[\s\S]*?;/g, '')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†ÙˆØ§Ù†
   */
  extractTitle(content) {
    const match = content.match(/^#\s+(.+)$/m);
    return match ? match[1].trim() : null;
  }

  /**
   * Ù¾Ø§Ø±Ø³ frontmatter
   */
  async parseFrontmatter(content) {
    const matter = (await import('gray-matter')).default;
    return matter(content);
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù† Ø§Ø² Ù…Ø³ÛŒØ±
   */
  detectLanguage(filePath) {
    if (filePath.includes('/en/') || filePath.includes('\\en\\')) {
      return 'en';
    }
    return 'fa';
  }

  /**
   * config Ù¾ÛŒØ´â€ŒÙØ±Ø¶
   */
  async getDefaultConfig() {
    return {
      colors: {
        bleurepublique: { r: 26, g: 115, b: 232, css: 'rgb(26, 115, 232)' },
        bleulight: { css: 'rgb(232, 244, 248)' },
        vertnapoleon: { css: 'rgb(52, 168, 83)' },
        rougerevolution: { css: 'rgb(234, 67, 53)' },
        gris: { css: 'rgb(95, 99, 104)' }
      },
      fonts: { main: { name: 'Vazirmatn' } },
      tikz: {
        libraries: ['shapes.geometric', 'arrows.meta', 'positioning', 'calc', 'backgrounds'],
        styles: {},
        pgfplotsLibraries: []
      }
    };
  }

    /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§
   */
  async processAll(options = {}) {
    console.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§...\n');
    
    const allFormats = Object.values(CONFIG.supportedFormats).flat();
    const patterns = allFormats.map(ext => `${CONFIG.sourceDir}/**/*${ext}`);
    
    // ÛŒØ§ÙØªÙ† Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    const files = await globby(patterns, {
      ignore: ['**/node_modules/**', '**/.git/**']
    });
    
    console.log(`ğŸ“ ÛŒØ§ÙØª Ø´Ø¯: ${files.length} ÙØ§ÛŒÙ„\n`);
    
    // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹
    const grouped = this.groupFilesByType(files);
    
    // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø±
    console.log('ğŸ“Š ØªÙÚ©ÛŒÚ© ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:');
    Object.entries(grouped).forEach(([type, list]) => {
      console.log(`   ${type}: ${list.length}`);
    });
    console.log('');
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
    const bookDirs = await globby(`${CONFIG.sourceDir}/books/*`, { onlyDirectories: true });
    for (const bookDir of bookDirs) {
      await this.processBook(bookDir, options);
    }
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ù‚Ø§Ù„Ø§Øª
    const articleFiles = [
      ...grouped.latex.filter(f => f.includes('/articles/')),
      ...grouped.markdown.filter(f => f.includes('/articles/')),
      ...grouped.pdf.filter(f => f.includes('/articles/')),
      ...grouped.word.filter(f => f.includes('/articles/'))
    ];
    
    for (const file of articleFiles) {
      const lang = this.detectLanguage(file);
      const outputDir = path.join(CONFIG.outputDir, 'articles', lang);
      
      try {
        await this.processFile(file, { lang, outputDir });
      } catch (error) {
        console.error(`   âŒ Ø®Ø·Ø§ Ø¯Ø± ${path.basename(file)}: ${error.message}`);
      }
    }
    
    // Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
    this.printFinalReport();
    
    return this.stats;
  }

  /**
   * Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
   */
  groupFilesByType(files) {
    const grouped = {
      latex: [],
      markdown: [],
      pdf: [],
      word: []
    };
    
    for (const file of files) {
      const ext = path.extname(file).toLowerCase();
      
      if (CONFIG.supportedFormats.latex.includes(ext)) {
        grouped.latex.push(file);
      } else if (CONFIG.supportedFormats.markdown.includes(ext)) {
        grouped.markdown.push(file);
      } else if (CONFIG.supportedFormats.pdf.includes(ext)) {
        grouped.pdf.push(file);
      } else if (CONFIG.supportedFormats.word.includes(ext)) {
        grouped.word.push(file);
      }
    }
    
    return grouped;
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨
   */
  async processBook(bookDir, options = {}) {
    const bookSlug = path.basename(bookDir);
    const lang = options.lang || this.detectLanguage(bookDir) || 'fa';
    
    console.log(`\n${'â•'.repeat(60)}`);
    console.log(`ğŸ“š Ú©ØªØ§Ø¨: ${bookSlug}`);
    console.log(`${'â•'.repeat(60)}`);
    
    // ØªØ­Ù„ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡
    let config;
    try {
      config = await this.parser.analyzeProject(bookDir);
      this.configCache.set(bookSlug, config);
      
      // ØªÙˆÙ„ÛŒØ¯ CSS
      await this.styleGen.generateCSS(config, bookSlug);
    } catch {
      config = await this.getDefaultConfig();
    }
    
    // ÛŒØ§ÙØªÙ† ÙØµÙ„â€ŒÙ‡Ø§
    const chapters = await this.findChapters(bookDir);
    console.log(`   ğŸ“‘ ÙØµÙ„â€ŒÙ‡Ø§: ${chapters.length}`);
    
    const outputDir = path.join(CONFIG.outputDir, 'books', lang, bookSlug);
    await fs.mkdir(outputDir, { recursive: true });
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ø± ÙØµÙ„
    for (let i = 0; i < chapters.length; i++) {
      const chapterPath = chapters[i];
      const chapterNumber = i + 1;
      
      try {
        const result = await this.processFile(chapterPath, {
          bookSlug,
          chapterNumber,
          config,
          lang
        });
        
        if (result) {
          // Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ
          const baseName = path.basename(chapterPath, path.extname(chapterPath));
          const outputFileName = `ch${String(chapterNumber).padStart(2, '0')}-${baseName}.md`;
          const outputPath = path.join(outputDir, outputFileName);
          
          // Ø³Ø§Ø®Øª frontmatter
          const frontmatter = this.buildFrontmatter({
            ...result,
            metadata: { ...result.metadata, bookSlug, chapterNumber, lang }
          });
          
          const finalContent = `---\n${this.stringifyYaml(frontmatter)}\n---\n\n${result.content}`;
          await fs.writeFile(outputPath, finalContent, 'utf-8');
          
          console.log(`   âœ… ÙØµÙ„ ${chapterNumber}: ${outputFileName}`);
        }
      } catch (error) {
        console.error(`   âŒ ÙØµÙ„ ${chapterNumber}: ${error.message}`);
      }
    }
    
    // Ø§ÛŒØ¬Ø§Ø¯ index.md
    await this.generateBookIndex(bookSlug, chapters, outputDir, lang);
    
    console.log(`   âœ… Ú©ØªØ§Ø¨ ${bookSlug} Ú©Ø§Ù…Ù„ Ø´Ø¯!`);
  }

  /**
   * ÛŒØ§ÙØªÙ† ÙØµÙ„â€ŒÙ‡Ø§ÛŒ Ú©ØªØ§Ø¨
   */
  async findChapters(bookDir) {
    const patterns = [
      path.join(bookDir, 'chapters', '*.tex'),
      path.join(bookDir, 'chapters', '*.md'),
      path.join(bookDir, 'ch*.tex'),
      path.join(bookDir, 'chapter*.tex'),
      path.join(bookDir, '*.pdf'), // PDF Ù‡Ù… Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÙØµÙ„ Ø¨Ø§Ø´Ø¯
    ];
    
    let chapters = await globby(patterns);
    
    // ÙÛŒÙ„ØªØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
    chapters = chapters.filter(f => {
      const name = path.basename(f).toLowerCase();
      return !['main.tex', 'book.tex', 'index.tex', 'preamble.tex'].includes(name);
    });
    
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
    chapters.sort((a, b) => {
      const numA = parseInt(path.basename(a).match(/\d+/)?.[0] || '0');
      const numB = parseInt(path.basename(b).match(/\d+/)?.[0] || '0');
      return numA - numB;
    });
    
    return chapters;
  }

  /**
   * Ø§ÛŒØ¬Ø§Ø¯ index Ú©ØªØ§Ø¨
   */
  async generateBookIndex(bookSlug, chapters, outputDir, lang) {
    const indexContent = `---
title: "${bookSlug}"
description: "ÙÙ‡Ø±Ø³Øª ÙØµÙˆÙ„"
lang: ${lang}
type: book-index
---

# ÙÙ‡Ø±Ø³Øª ÙØµÙˆÙ„

${chapters.map((ch, i) => {
  const baseName = path.basename(ch, path.extname(ch));
  const num = i + 1;
  return `${num}. [ÙØµÙ„ ${num}](./ch${String(num).padStart(2, '0')}-${baseName})`;
}).join('\n')}
`;
    
    await fs.writeFile(path.join(outputDir, 'index.md'), indexContent, 'utf-8');
  }

  /**
   * Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
   */
  printFinalReport() {
    console.log(`\n${'â•'.repeat(60)}`);
    console.log('ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ');
    console.log('â•'.repeat(60));
    console.log(`   ğŸ“„ LaTeX: ${this.stats.latex}`);
    console.log(`   ğŸ“ Markdown: ${this.stats.markdown}`);
    console.log(`   ğŸ“‘ PDF: ${this.stats.pdf}`);
    console.log(`   ğŸ“ƒ Word: ${this.stats.word}`);
    console.log(`   ğŸ¤– ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ AI: ${this.stats.aiTagged}`);
    console.log(`   âŒ Ø®Ø·Ø§Ù‡Ø§: ${this.stats.errors}`);
    console.log('â•'.repeat(60) + '\n');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  const args = process.argv.slice(2);
  
  // Ù¾Ø§Ø±Ø³ Ø¢Ø±Ú¯ÙˆÙ…Ø§Ù†â€ŒÙ‡Ø§
  const options = {
    aiEnabled: !args.includes('--no-ai'),
    aiProvider: args.find(a => a.startsWith('--ai-provider='))?.split('=')[1],
    lang: args.find(a => a.startsWith('--lang='))?.split('=')[1] || 'fa'
  };
  
  const pipeline = new ContentPipeline(options);
  
  if (args.includes('--help') || args.includes('-h')) {
    printHelp();
    return;
  }
  
  if (args.includes('--all') || args.length === 0) {
    await pipeline.processAll(options);
  } 
  else if (args.includes('--book')) {
    const bookDir = args[args.indexOf('--book') + 1];
    if (!bookDir) {
      console.error('âŒ Ù…Ø³ÛŒØ± Ú©ØªØ§Ø¨ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯');
      process.exit(1);
    }
    await pipeline.processBook(bookDir, options);
  }
  else if (args.includes('--file')) {
    const filePath = args[args.indexOf('--file') + 1];
    const outputDir = args.find(a => a.startsWith('--output='))?.split('=')[1] || 'src/content/articles/fa';
    
    if (!filePath) {
      console.error('âŒ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯');
      process.exit(1);
    }
    
    await pipeline.processFile(filePath, { outputDir, lang: options.lang });
  }
  else {
    // ÙØ±Ø¶: Ø§ÙˆÙ„ÛŒÙ† Ø¢Ø±Ú¯ÙˆÙ…Ø§Ù† Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ Ø§Ø³Øª
    const filePath = args[0];
    const outputDir = args[1] || 'src/content/articles/fa';
    
    await pipeline.processFile(filePath, { outputDir, lang: options.lang });
  }
}

function printHelp() {
  console.log(`
ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Content Pipeline

Ø¯Ø³ØªÙˆØ±Ø§Øª:
  node scripts/process-content.mjs --all              Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§
  node scripts/process-content.mjs --book <path>      Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨
  node scripts/process-content.mjs --file <path>      Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„
  node scripts/process-content.mjs <file> [output]    Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø±ÛŒØ¹

Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:
  --no-ai                    ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† AI
  --ai-provider=<name>       Ø§Ù†ØªØ®Ø§Ø¨ provider (openai, anthropic, ollama)
  --lang=<code>              Ø²Ø¨Ø§Ù† (fa, en)
  --output=<dir>             Ù¾ÙˆØ´Ù‡ Ø®Ø±ÙˆØ¬ÛŒ

ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡:
  â€¢ LaTeX (.tex)
  â€¢ Markdown (.md, .mdx)
  â€¢ PDF (.pdf)
  â€¢ Word (.docx, .doc)

Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§:
  node scripts/process-content.mjs --all
  node scripts/process-content.mjs --book content-source/books/my-book
  node scripts/process-content.mjs --file document.pdf --output=src/content/articles/fa
  node scripts/process-content.mjs document.tex
`);
}

main().catch(error => {
  console.error('âŒ Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ:', error);
  process.exit(1);
});

export { ContentPipeline };

```
----
## ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Watch Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

**ÙØ§ÛŒÙ„ `scripts/watch-content.mjs` (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø´Ø¯Ù‡):**

```javascript
#!/usr/bin/env node
/**
 * Ø³ÛŒØ³ØªÙ… Watch Ù‡ÙˆØ´Ù…Ù†Ø¯ - Ù†Ø³Ø®Ù‡ Û²
 * Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² PDFØŒ Word Ùˆ AI
 */

import chokidar from 'chokidar';
import path from 'path';
import fs from 'fs/promises';
import { fileURLToPath } from 'url';
import { EventEmitter } from 'events';

import { ContentPipeline } from './process-content.mjs';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  watchPaths: [
    'content-source/**/*.tex',
    'content-source/**/*.md',
    'content-source/**/*.mdx',
    'content-source/**/*.pdf',
    'content-source/**/*.docx'
  ],
  
  ignorePaths: [
    '**/node_modules/**',
    '**/.git/**',
    '**/*.aux',
    '**/*.log',
    '**/*.out',
    '**/*.toc',
    '**/*.synctex.gz',
    '**/.content-cache/**'
  ],
  
  sourceDir: 'content-source',
  outputDir: 'src/content',
  
  debounceDelay: 500,
  maxRetries: 2,
  
  // AI
  ai: {
    enabled: process.env.AI_ENABLED !== 'false',
    provider: process.env.AI_PROVIDER || 'openai'
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Logger Ø¨Ø§ Ø±Ù†Ú¯ Ùˆ Ø¢ÛŒÚ©ÙˆÙ†
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const COLORS = {
  reset: '\x1b[0m',
  bright: '\x1b[1m',
  dim: '\x1b[2m',
  red: '\x1b[31m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  blue: '\x1b[34m',
  magenta: '\x1b[35m',
  cyan: '\x1b[36m',
  white: '\x1b[37m',
  bgBlue: '\x1b[44m',
  bgGreen: '\x1b[42m'
};

const ICONS = {
  tex: 'ğŸ“„',
  md: 'ğŸ“',
  pdf: 'ğŸ“‘',
  docx: 'ğŸ“ƒ',
  change: 'âœï¸',
  add: 'â•',
  delete: 'ğŸ—‘ï¸',
  process: 'âš™ï¸',
  done: 'âœ…',
  error: 'âŒ',
  ai: 'ğŸ¤–',
  cache: 'ğŸ’¾',
  watch: 'ğŸ‘ï¸'
};

class Logger {
  timestamp() {
    return new Date().toLocaleTimeString('fa-IR', { hour12: false });
  }

  log(level, icon, msg, color = COLORS.white) {
    const time = `${COLORS.dim}[${this.timestamp()}]${COLORS.reset}`;
    console.log(`${time} ${icon} ${color}${msg}${COLORS.reset}`);
  }

  info(msg) { this.log('info', 'â„¹ï¸', msg, COLORS.blue); }
  success(msg) { this.log('success', 'âœ…', msg, COLORS.green); }
  warn(msg) { this.log('warn', 'âš ï¸', msg, COLORS.yellow); }
  error(msg) { this.log('error', 'âŒ', msg, COLORS.red); }
  
  file(action, filePath, extra = '') {
    const ext = path.extname(filePath).slice(1) || 'file';
    const icon = ICONS[ext] || 'ğŸ“„';
    const actionIcon = ICONS[action] || 'â€¢';
    const name = path.basename(filePath);
    const dir = path.dirname(filePath);
    
    const colors = {
      change: COLORS.yellow,
      add: COLORS.green,
      unlink: COLORS.red,
      process: COLORS.cyan,
      done: COLORS.green
    };
    
    console.log(
      `${COLORS.dim}[${this.timestamp()}]${COLORS.reset} ` +
      `${icon} ${actionIcon} ` +
      `${colors[action] || COLORS.white}${action.toUpperCase().padEnd(8)}${COLORS.reset} ` +
      `${COLORS.bright}${name}${COLORS.reset} ` +
      `${COLORS.dim}(${dir})${COLORS.reset}` +
      (extra ? ` ${extra}` : '')
    );
  }

  banner() {
    console.log('\n' + 'â•'.repeat(65));
    console.log(`${COLORS.bgBlue}${COLORS.white}${COLORS.bright}   ${ICONS.watch} Content Watcher v2 - Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ AI   ${COLORS.reset}`);
    console.log('â•'.repeat(65));
    console.log(`${COLORS.dim}   ÙØ±Ù…Øªâ€ŒÙ‡Ø§: LaTeX | Markdown | PDF | Word${COLORS.reset}`);
    console.log(`${COLORS.dim}   AI: ${CONFIG.ai.enabled ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}${COLORS.reset}`);
    console.log('â•'.repeat(65) + '\n');
  }

  ready() {
    console.log(`\n${COLORS.green}${COLORS.bright}âœ¨ Ø¢Ù…Ø§Ø¯Ù‡! Ù…Ù†ØªØ¸Ø± ØªØºÛŒÛŒØ±Ø§Øª...${COLORS.reset}`);
    console.log(`${COLORS.dim}   Ctrl+C Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬${COLORS.reset}\n`);
  }

  stats(stats) {
    console.log(`\n${COLORS.dim}${'â”€'.repeat(40)}${COLORS.reset}`);
    console.log(`${COLORS.cyan}ğŸ“Š Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡:${COLORS.reset}`);
    console.log(`   ${ICONS.tex} LaTeX: ${stats.latex}`);
    console.log(`   ${ICONS.md} Markdown: ${stats.markdown}`);
    console.log(`   ${ICONS.pdf} PDF: ${stats.pdf}`);
    console.log(`   ${ICONS.docx} Word: ${stats.word}`);
    console.log(`   ${ICONS.ai} AI: ${stats.aiTagged}`);
    console.log(`   ${ICONS.error} Ø®Ø·Ø§: ${stats.errors}`);
    console.log(`${COLORS.dim}${'â”€'.repeat(40)}${COLORS.reset}\n`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ ContentWatcher Ù†Ø³Ø®Ù‡ Û²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ContentWatcher extends EventEmitter {
  constructor(options = {}) {
    super();
    
    this.logger = new Logger();
    this.pipeline = new ContentPipeline({
      aiEnabled: options.aiEnabled ?? CONFIG.ai.enabled,
      aiProvider: options.aiProvider || CONFIG.ai.provider
    });
    
    this.debounceTimers = new Map();
    this.queue = [];
    this.isProcessing = false;
    
    this.stats = {
      latex: 0,
      markdown: 0,
      pdf: 0,
      word: 0,
      aiTagged: 0,
      errors: 0
    };
  }

  /**
   * Ø´Ø±ÙˆØ¹ watch
   */
  async start() {
    this.logger.banner();
    
    this.watcher = chokidar.watch(CONFIG.watchPaths, {
      ignored: CONFIG.ignorePaths,
      persistent: true,
      ignoreInitial: true,
      awaitWriteFinish: {
        stabilityThreshold: 500,
        pollInterval: 100
      },
      usePolling: process.platform === 'win32',
      interval: 300
    });

    this.watcher
      .on('ready', () => this.onReady())
      .on('change', (fp) => this.onFileChange(fp, 'change'))
      .on('add', (fp) => this.onFileChange(fp, 'add'))
      .on('unlink', (fp) => this.onFileDelete(fp))
      .on('error', (err) => this.logger.error(err.message));

    process.on('SIGINT', () => this.stop());
    process.on('SIGTERM', () => this.stop());
  }

  onReady() {
    this.logger.info('Ù…Ø§Ù†ÛŒØªÙˆØ± ÙØ¹Ø§Ù„ Ø´Ø¯');
    this.logger.ready();
  }

  onFileChange(filePath, action) {
    filePath = path.normalize(filePath);
    this.logger.file(action, filePath);
    
    // Debounce
    const existing = this.debounceTimers.get(filePath);
    if (existing) clearTimeout(existing);
    
    const timer = setTimeout(() => {
      this.debounceTimers.delete(filePath);
      this.queueFile(filePath);
    }, CONFIG.debounceDelay);
    
    this.debounceTimers.set(filePath, timer);
  }

  async onFileDelete(filePath) {
    filePath = path.normalize(filePath);
    this.logger.file('unlink', filePath);
    
    // Ø­Ø°Ù ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ
    const outputPath = this.getOutputPath(filePath);
    if (outputPath) {
      try {
        await fs.unlink(outputPath);
        this.logger.success(`Ø­Ø°Ù Ø´Ø¯: ${path.basename(outputPath)}`);
      } catch {}
    }
  }

  queueFile(filePath) {
    this.queue.push(filePath);
    this.processQueue();
  }

  async processQueue() {
    if (this.isProcessing || this.queue.length === 0) return;
    
    this.isProcessing = true;
    
    while (this.queue.length > 0) {
      const filePath = this.queue.shift();
      await this.processFile(filePath);
    }
    
    this.isProcessing = false;
  }

  async processFile(filePath, retryCount = 0) {
    const startTime = Date.now();
    this.logger.file('process', filePath);
    
    try {
      const fileInfo = this.analyzeFilePath(filePath);
      const outputDir = this.getOutputDir(fileInfo);
      
      await this.pipeline.processFile(filePath, {
        ...fileInfo,
        outputDir
      });
      
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
      this.updateStats(fileInfo.type);
      
      const elapsed = Date.now() - startTime;
      this.logger.file('done', filePath, `${COLORS.dim}(${elapsed}ms)${COLORS.reset}`);
      
    } catch (error) {
      if (retryCount < CONFIG.maxRetries) {
        this.logger.warn(`ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯... (${retryCount + 1})`);
        await new Promise(r => setTimeout(r, 1000));
        return this.processFile(filePath, retryCount + 1);
      }
      
      this.stats.errors++;
      this.logger.error(`${path.basename(filePath)}: ${error.message}`);
    }
  }

  analyzeFilePath(filePath) {
    const relativePath = path.relative(CONFIG.sourceDir, filePath);
    const parts = relativePath.split(path.sep);
    const ext = path.extname(filePath).toLowerCase();
    const fileName = path.basename(filePath, ext);
    
    // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
    let type = 'unknown';
    if (['.tex'].includes(ext)) type = 'latex';
    else if (['.md', '.mdx'].includes(ext)) type = 'markdown';
    else if (['.pdf'].includes(ext)) type = 'pdf';
    else if (['.docx', '.doc'].includes(ext)) type = 'word';
    
    // ØªØ´Ø®ÛŒØµ context
    let context = 'article';
    let bookSlug = null;
    let chapterNumber = null;
    
    if (parts[0] === 'books' && parts.length >= 2) {
      context = 'book';
      bookSlug = parts[1];
      
      // ØªØ´Ø®ÛŒØµ Ø´Ù…Ø§Ø±Ù‡ ÙØµÙ„
      const numMatch = fileName.match(/(\d+)/);
      chapterNumber = numMatch ? parseInt(numMatch[1]) : null;
    }
    
    // ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù†
    const lang = filePath.includes('/en/') || filePath.includes('\\en\\') ? 'en' : 'fa';
    
    return {
      type,
      context,
      bookSlug,
      chapterNumber,
      lang,
      fileName,
      filePath
    };
  }

  getOutputDir(fileInfo) {
    const { context, bookSlug, lang } = fileInfo;
    
    if (context === 'book' && bookSlug) {
      return path.join(CONFIG.outputDir, 'books', lang, bookSlug);
    }
    
    return path.join(CONFIG.outputDir, 'articles', lang);
  }

  getOutputPath(inputPath) {
    const fileInfo = this.analyzeFilePath(inputPath);
    const outputDir = this.getOutputDir(fileInfo);
    
    let outputName = fileInfo.fileName;
    if (fileInfo.chapterNumber) {
      outputName = `ch${String(fileInfo.chapterNumber).padStart(2, '0')}-${fileInfo.fileName}`;
    }
    
    return path.join(outputDir, `${outputName}.md`);
  }

  updateStats(type) {
    if (type === 'latex') this.stats.latex++;
    else if (type === 'markdown') this.stats.markdown++;
    else if (type === 'pdf') this.stats.pdf++;
    else if (type === 'word') this.stats.word++;
    
    if (CONFIG.ai.enabled) this.stats.aiTagged++;
  }

  async stop() {
    console.log('\n');
    this.logger.info('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ‚Ù...');
    
    if (this.watcher) {
      await this.watcher.close();
    }
    
    this.logger.stats(this.stats);
    process.exit(0);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ø¬Ø±Ø§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  const args = process.argv.slice(2);
  
  const options = {
    aiEnabled: !args.includes('--no-ai'),
    aiProvider: args.find(a => a.startsWith('--ai-provider='))?.split('=')[1]
  };
  
  const watcher = new ContentWatcher(options);
  await watcher.start();
}

main().catch(error => {
  console.error('âŒ Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ:', error);
  process.exit(1);
});

export { ContentWatcher };
```

---

## ğŸ“¦ ÙØ§ÛŒÙ„ `package.json` Ù†Ù‡Ø§ÛŒÛŒ

```json
{
  "name": "content-site",
  "type": "module",
  "version": "2.0.0",
  "scripts": {
    "dev": "astro dev",
    "dev:watch": "npm-run-all --parallel dev content:watch",
    "build": "npm run content:all && astro build",
    "preview": "astro preview",
    
    "content:all": "node scripts/process-content.mjs --all",
    "content:book": "node scripts/process-content.mjs --book",
    "content:file": "node scripts/process-content.mjs --file",
    "content:watch": "node scripts/watch-content.mjs",
    "content:watch:no-ai": "node scripts/watch-content.mjs --no-ai",
    
    "clean": "rimraf .content-cache public/diagrams public/images/extracted src/styles/book-themes"
  },
  "dependencies": {
    "astro": "^4.0.0",
    "@astrojs/tailwind": "^5.0.0",
    "@astrojs/mdx": "^2.0.0"
  },
  "devDependencies": {
    "chokidar": "^3.6.0",
    "globby": "^14.0.0",
    "gray-matter": "^4.0.3",
    "npm-run-all": "^4.1.5",
    "rimraf": "^5.0.5",
    "pdf-parse": "^1.1.1",
    "mammoth": "^1.6.0",
    "sharp": "^0.33.0",
    "openai": "^4.20.0",
    "@anthropic-ai/sdk": "^0.10.0"
  }
}
```

---

## âš™ï¸ ÙØ§ÛŒÙ„ `.env`

```env
# AI Settings
AI_ENABLED=true
AI_PROVIDER=openai

# OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx

# Anthropic (Claude)
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxx

# Ollama (Local)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3
```

---

## ğŸš€ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ

```powershell
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù†ØµØ¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm install

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run content:all

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„ Ø®Ø§Øµ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ÙØ§ÛŒÙ„ LaTeX
npm run content:file -- content-source/articles/my-article.tex

# ÙØ§ÛŒÙ„ PDF
npm run content:file -- content-source/articles/document.pdf

# ÙØ§ÛŒÙ„ Word
npm run content:file -- content-source/articles/report.docx

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run content:book -- content-source/books/my-book

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Watch Mode (Ø¨Ø§ AI)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run content:watch

# Watch Ø¨Ø¯ÙˆÙ† AI (Ø³Ø±ÛŒØ¹â€ŒØªØ±)
npm run content:watch:no-ai

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ØªÙˆØ³Ø¹Ù‡ (Astro + Watch Ù‡Ù…Ø²Ù…Ø§Ù†)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run dev:watch

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Build Ù†Ù‡Ø§ÛŒÛŒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

npm run build
```

---

## ğŸ“Š Ø®Ù„Ø§ØµÙ‡ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø­ØªÙˆØ§ v2.0                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ“„ ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:                                              â”‚
â”‚     âœ… LaTeX (.tex) - Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ TikZ                          â”‚
â”‚     âœ… Markdown (.md, .mdx)                                      â”‚
â”‚     âœ… PDF (.pdf) - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªÙ† Ùˆ ØªØµØ§ÙˆÛŒØ±                        â”‚
â”‚     âœ… Word (.docx, .doc)                                        â”‚
â”‚                                                                   â”‚
â”‚  ğŸ¤– Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ AI:                                               â”‚
â”‚     âœ… ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±                                           â”‚
â”‚     âœ… Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ                                         â”‚
â”‚     âœ… ØªÙˆÙ„ÛŒØ¯ Ø®Ù„Ø§ØµÙ‡                                               â”‚
â”‚     âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡                                          â”‚
â”‚     âœ… ØªØ®Ù…ÛŒÙ† Ø²Ù…Ø§Ù† Ù…Ø·Ø§Ù„Ø¹Ù‡                                         â”‚
â”‚     âœ… ØªØ­Ù„ÛŒÙ„ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ                                          â”‚
â”‚                                                                   â”‚
â”‚  ğŸ”„ Watch Mode:                                                  â”‚
â”‚     âœ… Ù…Ø§Ù†ÛŒØªÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± ØªØºÛŒÛŒØ±Ø§Øª                                    â”‚
â”‚     âœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙÙ‚Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ±ÛŒØ§ÙØªÙ‡                            â”‚
â”‚     âœ… Debounce Ù‡ÙˆØ´Ù…Ù†Ø¯                                           â”‚
â”‚     âœ… Ú©Ø´ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§                                               â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“Š Ø®Ø±ÙˆØ¬ÛŒ:                                                       â”‚
â”‚     âœ… Markdown Ø¨Ø§ Frontmatter Ú©Ø§Ù…Ù„                              â”‚
â”‚     âœ… Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ SVG                                             â”‚
â”‚     âœ… CSS Ø§Ø®ØªØµØ§ØµÛŒ Ù‡Ø± Ú©ØªØ§Ø¨                                       â”‚
â”‚     âœ… Ù…ØªØ§Ø¯ÛŒØªØ§ÛŒ SEO                                              â”‚
â”‚                                                                   â”‚
â”‚  ğŸ”§ Providers AI:                                                â”‚
â”‚     â€¢ OpenAI (GPT-4)                                             â”‚
â”‚     â€¢ Anthropic (Claude)                                         â”‚
â”‚     â€¢ Ollama (Ù…Ø­Ù„ÛŒ)                                              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Ø¢ÛŒØ§ Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø¨Ø®Ø´ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ
# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ØµØ¨ Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ² Û±Û±

## ğŸ–¥ï¸ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ² Û±Û±                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  âœ… Windows 11 (ÛŒØ§ Windows 10 Ù†Ø³Ø®Ù‡ 1903+)                       â”‚
â”‚  âœ… Ø­Ø¯Ø§Ù‚Ù„ 8GB RAM (16GB ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)                           â”‚
â”‚  âœ… Ø­Ø¯Ø§Ù‚Ù„ 10GB ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¯ÛŒØ³Ú©                                   â”‚
â”‚  âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Administrator                                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Ø±ÙˆØ´ Û±: Ù†ØµØ¨ Ø¨Ø§ Package Manager (ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)

### Ú¯Ø§Ù… Û±.Û±: Ù†ØµØ¨ Winget (Ø§Ú¯Ø± Ù†Ø¯Ø§Ø±ÛŒØ¯)

Winget Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ² Û±Û± Ø§Ø² Ù¾ÛŒØ´ Ù†ØµØ¨ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ:

```powershell
# Ø¯Ø± PowerShell (Run as Administrator)
winget --version
```

Ø§Ú¯Ø± Ù†ØµØ¨ Ù†ÛŒØ³ØªØŒ Ø§Ø² Microsoft Store Ø¨Ø±Ù†Ø§Ù…Ù‡ "App Installer" Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯.

### Ú¯Ø§Ù… Û±.Û²: Ù†ØµØ¨ Chocolatey (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†)

```powershell
# Ø¯Ø± PowerShell (Run as Administrator)
Set-ExecutionPolicy Bypass -Scope Process -Force
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# Ø¨Ø³ØªÙ† Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ PowerShell
# Ø³Ù¾Ø³ Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨:
choco --version
```

---

## ğŸ”§ Ú¯Ø§Ù… Û²: Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ

### Û².Û± Ù†ØµØ¨ Node.js

```powershell
# Ø¨Ø§ Winget
winget install OpenJS.NodeJS.LTS

# ÛŒØ§ Ø¨Ø§ Chocolatey
choco install nodejs-lts -y

# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ (Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ ØªØ±Ù…ÛŒÙ†Ø§Ù„)
node --version
npm --version
```

### Û².Û² Ù†ØµØ¨ Git

```powershell
# Ø¨Ø§ Winget
winget install Git.Git

# ÛŒØ§ Ø¨Ø§ Chocolatey
choco install git -y

# Ø¨Ø±Ø±Ø³ÛŒ
git --version
```

### Û².Û³ Ù†ØµØ¨ MiKTeX (ØªÙˆØ²ÛŒØ¹ LaTeX Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²)

**Ø±ÙˆØ´ Û±: Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… (ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)**

1. Ø¨Ø±Ùˆ Ø¨Ù‡: https://miktex.org/download
2. Ø¯Ø§Ù†Ù„ÙˆØ¯ "MiKTeX Installer" Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²
3. Ø§Ø¬Ø±Ø§ Ùˆ Ù†ØµØ¨ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
4. âœ… Ø­ØªÙ…Ø§Ù‹ Ú¯Ø²ÛŒÙ†Ù‡ "Install missing packages on-the-fly: Yes" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯

**Ø±ÙˆØ´ Û²: Ø¨Ø§ Chocolatey**

```powershell
# Ø¯Ø± PowerShell (Administrator)
choco install miktex -y
```

**Ù¾Ø³ Ø§Ø² Ù†ØµØ¨ MiKTeX:**

```powershell
# Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† MiKTeX Console
# Start Menu â†’ MiKTeX Console

# Ø¯Ø± MiKTeX Console:
# 1. Ø¨Ù‡ Updates Ø¨Ø±ÙˆÛŒØ¯ Ùˆ Ù‡Ù…Ù‡ Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†ÛŒØ¯
# 2. Ø¨Ù‡ Packages Ø¨Ø±ÙˆÛŒØ¯ Ùˆ Ø§ÛŒÙ† Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯:
#    - xetex
#    - fontspec
#    - tikz (pgf)
#    - xcolor
#    - standalone
#    - pgfplots
```

### Û².Û´ Ù†ØµØ¨ pdf2svg Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²

**Ø±ÙˆØ´ Û±: Ø¨Ø§ Chocolatey**

```powershell
choco install pdf2svg -y
```

**Ø±ÙˆØ´ Û²: Ù†ØµØ¨ Ø¯Ø³ØªÛŒ**

1. Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø²: https://github.com/jalios/pdf2svg-windows/releases
2. Extract Ø¨Ù‡ `C:\Program Files\pdf2svg\`
3. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ PATH (ØªÙˆØ¶ÛŒØ­ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ†)

**Ø±ÙˆØ´ Û³: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Inkscape Ø¨Ù‡ Ø¬Ø§ÛŒ pdf2svg**

```powershell
# Ù†ØµØ¨ Inkscape
winget install Inkscape.Inkscape

# ÛŒØ§
choco install inkscape -y
```

### Û².Ûµ Ù†ØµØ¨ ÙÙˆÙ†Øª Vazirmatn

```powershell
# Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙÙˆÙ†Øª
Invoke-WebRequest -Uri "https://github.com/rastikerdar/vazirmatn/releases/download/v33.003/Vazirmatn-v33.003.zip" -OutFile "$env:TEMP\vazirmatn.zip"

# Ø§Ø³ØªØ®Ø±Ø§Ø¬
Expand-Archive -Path "$env:TEMP\vazirmatn.zip" -DestinationPath "$env:TEMP\vazirmatn"

# Ù†ØµØ¨ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ (Ú©Ù¾ÛŒ Ø¨Ù‡ Ù¾ÙˆØ´Ù‡ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²)
Copy-Item "$env:TEMP\vazirmatn\fonts\ttf\*.ttf" -Destination "$env:WINDIR\Fonts" -Force

# ÛŒØ§ Ù†ØµØ¨ Ø¯Ø³ØªÛŒ:
# 1. Ø¨Ø±Ùˆ Ø¨Ù‡ Ù¾ÙˆØ´Ù‡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡
# 2. ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ .ttf Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†
# 3. Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© â†’ Install for all users
```

---

## âš™ï¸ Ú¯Ø§Ù… Û³: ØªÙ†Ø¸ÛŒÙ… Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ (PATH)

### Û³.Û± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ PATH

```powershell
# Ø¯Ø± PowerShell (Administrator)

# Ø¨Ø±Ø±Ø³ÛŒ PATH ÙØ¹Ù„ÛŒ
$env:PATH -split ';'

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† MiKTeX Ø¨Ù‡ PATH (Ø§Ú¯Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ø´Ø¯Ù‡)
$miktexPath = "C:\Program Files\MiKTeX\miktex\bin\x64"
[Environment]::SetEnvironmentVariable("PATH", $env:PATH + ";$miktexPath", "Machine")

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† pdf2svg (Ø§Ú¯Ø± Ù†ØµØ¨ Ø¯Ø³ØªÛŒ Ú©Ø±Ø¯ÛŒØ¯)
$pdf2svgPath = "C:\Program Files\pdf2svg"
[Environment]::SetEnvironmentVariable("PATH", $env:PATH + ";$pdf2svgPath", "Machine")
```

### Û³.Û² Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ ØµØ­ÛŒØ­

```powershell
# Ø¨Ø³ØªÙ† Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ PowerShellØŒ Ø³Ù¾Ø³:

# Ø¨Ø±Ø±Ø³ÛŒ XeLaTeX
xelatex --version

# Ø¨Ø±Ø±Ø³ÛŒ pdf2svg
pdf2svg

# Ø¨Ø±Ø±Ø³ÛŒ Node
node --version

# Ø¨Ø±Ø±Ø³ÛŒ npm
npm --version
```

---

## ğŸ“ Ú¯Ø§Ù… Û´: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡

### Û´.Û± Clone ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡

```powershell
# Ø±ÙØªÙ† Ø¨Ù‡ Ù¾ÙˆØ´Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§
cd C:\Users\YourUsername\Projects

# Ø§Ú¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±ÛŒØ¯
cd your-existing-site

# ÛŒØ§ clone Ø§Ø² GitHub
git clone https://github.com/your-username/your-site.git
cd your-site
```

### Û´.Û² Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Node

```powershell
npm install
```

### Û´.Û³ Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§

```powershell
# Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…
New-Item -ItemType Directory -Force -Path "scripts"
New-Item -ItemType Directory -Force -Path "content-source\books"
New-Item -ItemType Directory -Force -Path "content-source\articles"
New-Item -ItemType Directory -Force -Path "public\diagrams"
```

### Û´.Û´ Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ npm

```powershell
npm install -D globby gray-matter
```

---

## ğŸ“ Ú¯Ø§Ù… Ûµ: Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª (Ù†Ø³Ø®Ù‡ ÙˆÛŒÙ†Ø¯ÙˆØ²)

### Ûµ.Û± ÙØ§ÛŒÙ„ ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§

**Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ `scripts/color-definitions.tex`:**

```powershell
# Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„
New-Item -ItemType File -Path "scripts\color-definitions.tex" -Force
```

Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§ÛŒÙ„ (Ø¨Ø§ Notepad ÛŒØ§ VS Code Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯):

```latex
% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
% ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

\usepackage{xcolor}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨ÛŒ
\definecolor{bleurepublique}{RGB}{26, 115, 232}
\definecolor{bleulight}{RGB}{232, 244, 248}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø²
\definecolor{vertnapoleon}{RGB}{52, 168, 83}
\definecolor{vertlight}{RGB}{232, 248, 237}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ù†ÙØ´
\definecolor{violetempire}{RGB}{142, 68, 173}
\definecolor{violetlight}{RGB}{245, 238, 248}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ù…Ø²
\definecolor{rougerevolution}{RGB}{234, 67, 53}
\definecolor{rougelight}{RGB}{252, 237, 236}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø·Ù„Ø§ÛŒÛŒ/Ù†Ø§Ø±Ù†Ø¬ÛŒ
\definecolor{orroyal}{RGB}{251, 188, 4}
\definecolor{orroyaldark}{RGB}{230, 150, 0}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
\definecolor{gris}{RGB}{95, 99, 104}
\definecolor{grisclair}{RGB}{218, 220, 224}
\definecolor{grislight}{RGB}{248, 249, 250}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ
\definecolor{scenario1}{RGB}{66, 133, 244}
\definecolor{scenario2}{RGB}{52, 168, 83}
\definecolor{scenario3}{RGB}{251, 188, 4}
\definecolor{scenario4}{RGB}{234, 67, 53}
```

### Ûµ.Û² Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ù†Ø³Ø®Ù‡ ÙˆÛŒÙ†Ø¯ÙˆØ²)

**Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ `scripts/process-book.mjs`:**

```javascript
#!/usr/bin/env node
/**
 * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ LaTeX Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Markdown
 * Ù†Ø³Ø®Ù‡ Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ ÙˆÛŒÙ†Ø¯ÙˆØ²
 */

import { exec } from 'child_process';
import { promisify } from 'util';
import fs from 'fs/promises';
import path from 'path';
import crypto from 'crypto';
import { fileURLToPath } from 'url';

const execAsync = promisify(exec);
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª - Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ ÙˆÛŒÙ†Ø¯ÙˆØ²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÙˆØ´Ù‡ temp ÙˆÛŒÙ†Ø¯ÙˆØ²
  tempDir: path.join(process.env.TEMP || 'C:\\Temp', 'latex-processor'),
  outputDiagramsDir: './public/diagrams',
  colorDefsFile: path.join(__dirname, 'color-definitions.tex'),
  
  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²
  isWindows: process.platform === 'win32',
  
  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Inkscape Ø¨Ù‡ Ø¬Ø§ÛŒ pdf2svg Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ²
  useInkscape: true,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± TikZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class TikZProcessor {
  constructor() {
    this.processedCount = 0;
    this.failedCount = 0;
    this.cache = new Map();
  }

  generateHash(code) {
    return crypto.createHash('md5').update(code).digest('hex').slice(0, 10);
  }

  buildStandaloneTeX(tikzCode, options = {}) {
    const { scale = 1, font = 'Vazirmatn' } = options;
    
    // Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ Ø±Ù†Ú¯â€ŒÙ‡Ø§ - ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ ÙØ±Ù…Øª ÙˆÛŒÙ†Ø¯ÙˆØ²
    const colorDefPath = CONFIG.colorDefsFile.replace(/\\/g, '/');
    
    return `
\\documentclass[tikz,border=15pt]{standalone}

\\usepackage{fontspec}
\\usepackage{xcolor}
\\usepackage{tikz}
\\usepackage{pgfplots}
\\pgfplotsset{compat=1.18}

\\usetikzlibrary{
  shapes.geometric,
  shapes.misc,
  arrows.meta,
  positioning,
  calc,
  backgrounds,
  fit,
  decorations.pathreplacing,
  shadows,
  trees
}

\\setmainfont[Scale=${scale}]{${font}}

\\input{${colorDefPath}}

\\begin{document}
${tikzCode}
\\end{document}
`;
  }

  async pdfToSvg(pdfFile, svgFile) {
    if (CONFIG.useInkscape) {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Inkscape
      await execAsync(
        `inkscape "${pdfFile}" --export-filename="${svgFile}" --export-type=svg`,
        { timeout: 60000 }
      );
    } else {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² pdf2svg
      await execAsync(`pdf2svg "${pdfFile}" "${svgFile}"`);
    }
  }

  async renderToSVG(tikzCode, outputName) {
    const hash = this.generateHash(tikzCode);
    const svgFileName = `${outputName}-${hash}.svg`;
    const svgPath = path.join(CONFIG.outputDiagramsDir, svgFileName);
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´
    if (this.cache.has(hash)) {
      console.log(`   âš¡ Ø§Ø² Ú©Ø´: ${outputName}`);
      return this.cache.get(hash);
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯
    try {
      await fs.access(svgPath);
      console.log(`   ğŸ“ Ù…ÙˆØ¬ÙˆØ¯: ${outputName}`);
      this.cache.set(hash, svgPath);
      return svgPath;
    } catch {}
    
    // Ø³Ø§Ø®Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§
    await fs.mkdir(CONFIG.tempDir, { recursive: true });
    await fs.mkdir(CONFIG.outputDiagramsDir, { recursive: true });
    
    const texContent = this.buildStandaloneTeX(tikzCode);
    const texFile = path.join(CONFIG.tempDir, `${outputName}.tex`);
    const pdfFile = path.join(CONFIG.tempDir, `${outputName}.pdf`);
    
    try {
      // Ù†ÙˆØ´ØªÙ† ÙØ§ÛŒÙ„ TeX
      await fs.writeFile(texFile, texContent, 'utf-8');
      
      // Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø¨Ø§ XeLaTeX
      console.log(`   ğŸ”„ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„: ${outputName}...`);
      
      // ØªØºÛŒÛŒØ± Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ XeLaTeX
      const xelatexCmd = CONFIG.isWindows
        ? `cd /d "${CONFIG.tempDir}" && xelatex -interaction=nonstopmode -halt-on-error "${outputName}.tex"`
        : `cd "${CONFIG.tempDir}" && xelatex -interaction=nonstopmode -halt-on-error "${outputName}.tex"`;
      
      await execAsync(xelatexCmd, { 
        timeout: 120000,
        shell: CONFIG.isWindows ? 'cmd.exe' : '/bin/sh'
      });
      
      // ØªØ¨Ø¯ÛŒÙ„ PDF Ø¨Ù‡ SVG
      await this.pdfToSvg(pdfFile, svgPath);
      
      // Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ SVG
      let svgContent = await fs.readFile(svgPath, 'utf-8');
      svgContent = this.optimizeSVG(svgContent, outputName);
      await fs.writeFile(svgPath, svgContent, 'utf-8');
      
      console.log(`   âœ… ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯: ${outputName}`);
      this.processedCount++;
      this.cache.set(hash, svgPath);
      
      return svgPath;
      
    } catch (error) {
      console.error(`   âŒ Ø®Ø·Ø§ Ø¯Ø± ${outputName}:`, error.message);
      this.failedCount++;
      
      // Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ø®Ø·Ø§
      try {
        const logFile = path.join(CONFIG.tempDir, `${outputName}.log`);
        const logContent = await fs.readFile(logFile, 'utf-8');
        const errorLines = logContent.split('\n')
          .filter(l => l.includes('!') || l.includes('Error'))
          .slice(0, 5);
        if (errorLines.length > 0) {
          console.error(`   ğŸ“‹ Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§:`);
          errorLines.forEach(line => console.error(`      ${line}`));
        }
      } catch {}
      
      return null;
    }
  }

  optimizeSVG(svgContent, name) {
    return svgContent
      .replace(/<!--[\s\S]*?-->/g, '')
      .replace(
        '<svg',
        `<svg class="tikz-diagram" id="diagram-${name}" role="img" aria-label="Ù†Ù…ÙˆØ¯Ø§Ø± ${name}"`
      );
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± Ø§ØµÙ„ÛŒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class LaTeXToMarkdownProcessor {
  constructor() {
    this.tikzProcessor = new TikZProcessor();
    this.diagramCounter = 0;
  }

  extractTikZBlocks(content) {
    const blocks = [];
    
    const patterns = [
      /\\begin\{tikzpicture\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{tikzpicture\}/g,
      /\\begin\{forest\}([\s\S]*?)\\end\{forest\}/g,
    ];
    
    for (const pattern of patterns) {
      let match;
      const regex = new RegExp(pattern.source, 'g');
      
      while ((match = regex.exec(content)) !== null) {
        blocks.push({
          full: match[0],
          code: match[0],
          index: match.index,
          type: this.detectTikZType(match[0])
        });
      }
    }
    
    return blocks.sort((a, b) => b.index - a.index);
  }

  detectTikZType(code) {
    if (code.includes('\\begin{forest}')) return 'tree';
    if (code.includes('gantt')) return 'gantt';
    if (code.includes('axis') || code.includes('\\addplot')) return 'chart';
    if (code.includes('mindmap')) return 'mindmap';
    return 'diagram';
  }

  async processFile(inputPath, outputDir, options = {}) {
    const { bookSlug, chapterNumber, lang = 'fa' } = options;
    
    console.log(`\n${'â•'.repeat(60)}`);
    console.log(`ğŸ“„ Ù¾Ø±Ø¯Ø§Ø²Ø´: ${inputPath}`);
    console.log(`${'â•'.repeat(60)}`);
    
    let content = await fs.readFile(inputPath, 'utf-8');
    
    // Û±. Ù¾Ø±Ø¯Ø§Ø²Ø´ TikZ
    console.log('\nğŸ“Š Ù…Ø±Ø­Ù„Ù‡ Û±: Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§...');
    content = await this.processTikZBlocks(content, bookSlug || 'diagram');
    
    // Û². Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    console.log('\nğŸ”§ Ù…Ø±Ø­Ù„Ù‡ Û²: Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´...');
    content = this.preProcessForPandoc(content);
    
    // Û³. Pandoc
    console.log('\nğŸ“ Ù…Ø±Ø­Ù„Ù‡ Û³: ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc...');
    await fs.mkdir(CONFIG.tempDir, { recursive: true });
    const tempTexFile = path.join(CONFIG.tempDir, 'processed.tex');
    await fs.writeFile(tempTexFile, content, 'utf-8');
    
    const tempMdFile = path.join(CONFIG.tempDir, 'output.md');
    
    // Ø¯Ø³ØªÙˆØ± Pandoc Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ ÙˆÛŒÙ†Ø¯ÙˆØ²
    const pandocCmd = `pandoc "${tempTexFile}" -o "${tempMdFile}" --wrap=none --columns=1000`;
    await execAsync(pandocCmd, { 
      timeout: 60000,
      shell: CONFIG.isWindows ? 'cmd.exe' : '/bin/sh'
    });
    
    let markdown = await fs.readFile(tempMdFile, 'utf-8');
    
    // Û´. Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´
    console.log('\nâœ¨ Ù…Ø±Ø­Ù„Ù‡ Û´: Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´...');
    markdown = this.postProcessMarkdown(markdown, { lang });
    
    // Ûµ. Frontmatter
    markdown = this.addFrontmatter(markdown, inputPath, options);
    
    // Û¶. Ø°Ø®ÛŒØ±Ù‡
    await fs.mkdir(outputDir, { recursive: true });
    const outputFileName = this.generateOutputFileName(inputPath, options);
    const outputPath = path.join(outputDir, outputFileName);
    await fs.writeFile(outputPath, markdown, 'utf-8');
    
    console.log(`\nâœ… Ø®Ø±ÙˆØ¬ÛŒ: ${outputPath}`);
    console.log(`   ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: ${this.tikzProcessor.processedCount} Ù…ÙˆÙÙ‚ØŒ ${this.tikzProcessor.failedCount} Ù†Ø§Ù…ÙˆÙÙ‚`);
    
    return outputPath;
  }

  async processTikZBlocks(content, prefix) {
    const blocks = this.extractTikZBlocks(content);
    console.log(`   ÛŒØ§ÙØª Ø´Ø¯: ${blocks.length} Ù†Ù…ÙˆØ¯Ø§Ø±`);
    
    for (const block of blocks) {
      this.diagramCounter++;
      const diagramName = `${prefix}-${this.diagramCounter}-${block.type}`;
      
      const svgPath = await this.tikzProcessor.renderToSVG(block.code, diagramName);
      
      if (svgPath) {
        const relativePath = `/diagrams/${path.basename(svgPath)}`;
        const replacement = `\n\n![${block.type}](${relativePath}){.tikz-diagram}\n\n`;
        content = content.replace(block.full, replacement);
      } else {
        content = content.replace(block.full, `\n\n<!-- TIKZ_ERROR: ${diagramName} -->\n\n`);
      }
    }
    
    return content;
  }

  preProcessForPandoc(content) {
    return content
      .replace(/\\begin\{tcolorbox\}\[([^\]]*title=\{([^}]*)\}[^\]]*)\]([\s\S]*?)\\end\{tcolorbox\}/g, 
        (_, opts, title, body) => `\n\n> **${title}**\n> ${body.trim().replace(/\n/g, '\n> ')}\n\n`)
      .replace(/\\begin\{itemize\}\[([^\]]*)\]/g, '\\begin{itemize}')
      .replace(/\\begin\{enumerate\}\[([^\]]*)\]/g, '\\begin{enumerate}')
      .replace(/\n{4,}/g, '\n\n\n');
  }

  postProcessMarkdown(markdown, options = {}) {
    return markdown
      .replace(/\[node distance[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\[scale[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\\node[\s\S]*?;/g, '')
      .replace(/\\draw[\s\S]*?;/g, '')
      .replace(/!\[(.*?)\]\((.+?)\)\{\.tikz-diagram\}/g, 
        '\n<figure class="tikz-figure">\n  <img src="$2" alt="$1" class="tikz-diagram" loading="lazy" />\n</figure>\n')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
  }

  addFrontmatter(markdown, inputPath, options = {}) {
    const { bookSlug, chapterNumber, lang = 'fa', title } = options;
    
    const titleMatch = markdown.match(/^#\s+(.+)$/m);
    const extractedTitle = titleMatch ? titleMatch[1] : path.basename(inputPath, '.tex');
    
    return `---
title: "${title || extractedTitle}"
description: "${title || extractedTitle}"
lang: ${lang}
${chapterNumber ? `chapterNumber: ${chapterNumber}` : ''}
${bookSlug ? `book: "${bookSlug}"` : ''}
---

${markdown}`;
  }

  generateOutputFileName(inputPath, options = {}) {
    const { chapterNumber } = options;
    const baseName = path.basename(inputPath, '.tex');
    
    if (chapterNumber) {
      return `ch${String(chapterNumber).padStart(2, '0')}-${baseName}.md`;
    }
    return `${baseName}.md`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ø¬Ø±Ø§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  const args = process.argv.slice(2);
  
  if (args.length === 0) {
    console.log(`
ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:

  Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„:
    node scripts/process-book.mjs <input.tex> [output-dir]
  
  Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨:
    node scripts/process-book.mjs <book-dir> --book --slug=my-book --lang=fa

Ù…Ø«Ø§Ù„:
    node scripts/process-book.mjs content-source\\books\\my-book\\chapter1.tex src\\content\\articles\\fa
`);
    process.exit(1);
  }
  
  const inputPath = args[0];
  const isBook = args.includes('--book');
  const lang = args.find(a => a.startsWith('--lang='))?.split('=')[1] || 'fa';
  const slug = args.find(a => a.startsWith('--slug='))?.split('=')[1] || path.basename(inputPath, '.tex');
  
  const processor = new LaTeXToMarkdownProcessor();
  const outputDir = args[1] || `src/content/articles/${lang}`;
  
  await processor.processFile(inputPath, outputDir, { 
    lang, 
    bookSlug: isBook ? slug : undefined 
  });
}

main().catch(error => {
  console.error('âŒ Ø®Ø·Ø§:', error);
  process.exit(1);
});

export { LaTeXToMarkdownProcessor, TikZProcessor };
```

---

## ğŸ§ª Ú¯Ø§Ù… Û¶: ØªØ³Øª Ù†ØµØ¨

### Û¶.Û± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ ØªØ³Øª

**Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ `content-source/test.tex`:**

```latex
\documentclass{article}
\usepackage{tikz}
\usetikzlibrary{positioning, shapes.geometric}

\begin{document}

\section{ØªØ³Øª Ù†Ù…ÙˆØ¯Ø§Ø±}

\begin{tikzpicture}[
    node distance=1.5cm,
    box/.style={rectangle, rounded corners, draw=blue!50, fill=blue!10, 
                minimum width=3cm, minimum height=1cm, align=center}
]
    \node[box] (a) {Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„};
    \node[box, below=of a] (b) {Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ…};
    \node[box, below=of b] (c) {Ù…Ø±Ø­Ù„Ù‡ Ø³ÙˆÙ…};
    
    \draw[->, thick] (a) -- (b);
    \draw[->, thick] (b) -- (c);
\end{tikzpicture}

\section{Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ}

Ø§ÛŒÙ† ÛŒÚ© Ù…ØªÙ† Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ø§Ø³Øª.

\end{document}
```

### Û¶.Û² Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª

```powershell
# Ø¯Ø± PowerShell
node scripts/process-book.mjs content-source/test.tex src/content/articles/fa/

# Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
Get-Content src/content/articles/fa/test.md

# Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
dir public/diagrams/
```

---

## ğŸš€ Ú¯Ø§Ù… Û·: Ø§Ø¬Ø±Ø§ÛŒ Ú©Ø§Ù…Ù„

### Û·.Û± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ package.json

```json
{
  "scripts": {
    "dev": "astro dev",
    "build": "npm run process:all && astro build",
    "preview": "astro preview",
    "process:all": "node scripts/process-book.mjs",
    "process:file": "node scripts/process-book.mjs"
  }
}
```

### Û·.Û² Ø¯Ø³ØªÙˆØ±Ø§Øª Ø±ÙˆØ²Ù…Ø±Ù‡

```powershell
# Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„
npm run process:file content-source\books\my-book\chapter1.tex src\content\books\fa\my-book\

# Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± ØªÙˆØ³Ø¹Ù‡
npm run dev

# Build Ù†Ù‡Ø§ÛŒÛŒ
npm run build
```

---

## ğŸ”§ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²

### Ù…Ø´Ú©Ù„ Û±: xelatex ÛŒØ§ÙØª Ù†Ø´Ø¯

```powershell
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨
where xelatex

# Ø§Ú¯Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯ØŒ MiKTeX Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯
# ÛŒØ§ PATH Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
$env:PATH -split ';' | Select-String -Pattern "miktex"
```

### Ù…Ø´Ú©Ù„ Û²: Ø®Ø·Ø§ÛŒ ÙÙˆÙ†Øª

```powershell
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ ÙÙˆÙ†Øª
Get-ChildItem "$env:WINDIR\Fonts" | Where-Object { $_.Name -like "*Vazir*" }

# Ø§Ú¯Ø± Ù†ØµØ¨ Ù†ÛŒØ³ØªØŒ ÙÙˆÙ†Øª Ø±Ø§ Ø¯Ø³ØªÛŒ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯
```

### Ù…Ø´Ú©Ù„ Û³: Ø®Ø·Ø§ÛŒ Pandoc

```powershell
# Ù†ØµØ¨ Pandoc
winget install JohnMacFarlane.Pandoc

# ÛŒØ§ Ø¨Ø§ Chocolatey
choco install pandoc -y

# Ø¨Ø±Ø±Ø³ÛŒ
pandoc --version
```

### Ù…Ø´Ú©Ù„ Û´: Ø®Ø·Ø§ÛŒ Inkscape

```powershell
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨
where inkscape

# Ø§Ú¯Ø± PATH Ù†Ø¯Ø§Ø±Ø¯:
$inkscapePath = "C:\Program Files\Inkscape\bin"
$env:PATH += ";$inkscapePath"
```

---

## ğŸ“‹ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù†Ù‡Ø§ÛŒÛŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù†ØµØ¨ ÙˆÛŒÙ†Ø¯ÙˆØ²                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â˜ Node.js Ù†ØµØ¨ Ø´Ø¯Ù‡     â†’ node --version                        â”‚
â”‚  â˜ Git Ù†ØµØ¨ Ø´Ø¯Ù‡         â†’ git --version                         â”‚
â”‚  â˜ MiKTeX Ù†ØµØ¨ Ø´Ø¯Ù‡      â†’ xelatex --version                     â”‚
â”‚  â˜ Pandoc Ù†ØµØ¨ Ø´Ø¯Ù‡      â†’ pandoc --version                      â”‚
â”‚  â˜ Inkscape Ù†ØµØ¨ Ø´Ø¯Ù‡    â†’ inkscape --version                    â”‚
â”‚  â˜ ÙÙˆÙ†Øª Vazirmatn Ù†ØµØ¨ Ø´Ø¯Ù‡                                       â”‚
â”‚  â˜ Ù¾ÙˆØ´Ù‡ scripts Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡                                       â”‚
â”‚  â˜ ÙØ§ÛŒÙ„ color-definitions.tex Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡                        â”‚
â”‚  â˜ ÙØ§ÛŒÙ„ process-book.mjs Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡                             â”‚
â”‚  â˜ npm install Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡                                         â”‚
â”‚  â˜ ØªØ³Øª Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯                                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Ø¢ÛŒØ§ Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø±Ø§Ø­Ù„ Ù†ØµØ¨ Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø±Ø§Ø­Ù„ Ø±Ø§ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡Ù…ØŸ
# Ù†Ù…ÙˆÙ†Ù‡ Ø®Ø±ÙˆØ¬ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨
```markdown
---

title: "Ù…Ù‚Ø¯Ù…Ù‡: Ú†Ø±Ø§ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ú†Ø±Ø§ Ø§Ú©Ù†ÙˆÙ†ØŸ"

description: "Ù…Ù‚Ø¯Ù…Ù‡: Ú†Ø±Ø§ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ú†Ø±Ø§ Ø§Ú©Ù†ÙˆÙ†ØŸ"

lang: fa

order: 1

chapterNumber: 1

  

---

  
  
  

[Ø®Ù„Ø§ØµÙ‡ ÙØµÙ„]

Ø§ÛŒÙ† ÙØµÙ„ Ø¨Ù‡ Ø³Ù‡ Ù¾Ø±Ø³Ø´ Ø¨Ù†ÛŒØ§Ø¯ÛŒÙ† Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯: Ú†Ø±Ø§ Ú¯Ø°Ø§Ø± Ø§Ø² Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ùˆ ÙÙˆØ±ÛŒ Ø´Ø¯Ù‡ Ø§Ø³ØªØŸ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú†Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ùˆ Ø¨Ø§ Ú†Ù‡ Ø±ÙˆÛŒÚ©Ø±Ø¯ÛŒ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ØŸ Ùˆ Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯ØŸ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯ Ú©Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø¯Ù… Ù‚Ø§Ø¨Ù„ ØªØ­Ù…Ù„ Ø§Ø³Øª Ùˆ Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ù… Ù‚Ø§Ø¨Ù„ Ø§Ø¯Ø§Ù…Ù‡. Ø§Ù…Ø§ Ú¯Ø°Ø§Ø± Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ ÙØ§Ø¬Ø¹Ù‡ Ø¨ÛŒÙ†Ø¬Ø§Ù…Ø¯.

  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ø¶Ø±ÙˆØ±Øª Ùˆ ÙÙˆØ±ÛŒØª: Ú†Ø±Ø§ Ø§Ù„Ø§Ù†ØŸ

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

### Ù†Ù‚Ø·Ù‡ Ø¹Ø·Ù Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´

  

Ø¯Ø± Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´ØŒ Ø§ÛŒØ±Ø§Ù† Ø´Ø§Ù‡Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† Ø®ÛŒØ²Ø´ Ù…Ø±Ø¯Ù…ÛŒ ØªØ§Ø±ÛŒØ® Ø®ÙˆØ¯ Ø¨ÙˆØ¯. Ø¢Ù†Ú†Ù‡ Ø¨Ø§ Ø§Ø¹ØªØ±Ø§Ø¶ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ù† ØªÙ‡Ø±Ø§Ù† Ø¨Ù‡ Ø³ÛŒØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø¢ØºØ§Ø² Ø´Ø¯ØŒ Ø¯Ø± Ø¹Ø±Ø¶ Ø±ÙˆØ²Ù‡Ø§ Ø¨Ù‡ Ø¬Ù†Ø¨Ø´ÛŒ ÙØ±Ø§Ú¯ÛŒØ± ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯ Ú©Ù‡ Ø­Ø¯ÙˆØ¯ Û³Û° Ù…ÛŒÙ„ÛŒÙˆÙ† Ù†ÙØ± Ø±Ø§ Ø¯Ø± Ø¨ÛŒØ´ Ø§Ø² Û´Û°Û° Ø´Ù‡Ø± Ø¨Ù‡ Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§ Ú©Ø´Ø§Ù†Ø¯.

  
  
  

Â  Â  % Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¬Ù†Ø¨Ø´â€ŒÙ‡Ø§ - Ù†Ù…ÙˆØ¯Ø§Ø± Ø³ØªÙˆÙ†ÛŒ

Â  Â  Â  Â  % Ù…Ø­ÙˆØ± Ø¹Ù…ÙˆØ¯ÛŒ

Â  Â  Â  Â  [->, line width=1pt] (0,0) -- (0,7) node[above, font=] {Ù…ÛŒÙ„ÛŒÙˆÙ† Ù†ÙØ±};

Â  Â  Â  Â  % Ù…Ø­ÙˆØ± Ø§ÙÙ‚ÛŒ

Â  Â  Â  Â  [->, line width=1pt] (0,0) -- (11,0);

Â  Â  Â  Â  % Ø®Ø·ÙˆØ· Ø±Ø§Ù‡Ù†Ù…Ø§

Â  Â  Â  Â  Â  in {1,2,3,4,5,6} {

Â  Â  Â  Â  Â  Â  [dashed, color=grisclair] (0,) -- (10.5,);

Â  Â  Â  Â  Â  Â  [left, font=] at (0,) {};

Â  Â  Â  Â  }

Â  Â  Â  Â  % Ø³ØªÙˆÙ†â€ŒÙ‡Ø§

Â  Â  Â  Â  [scenario1] (1,0) rectangle (2,0.6);

Â  Â  Â  Â  [below, font=, align=center] at (1.5,-0.1) {Ø§Ù†Ù‚Ù„Ø§Ø¨ ÛµÛ·\\(ØªØ®Ù…ÛŒÙ†)};

Â  Â  Â  Â  [above, font=] at (1.5,0.6) {Û³};

Â  Â  Â  Â  [scenario2] (3,0) rectangle (4,0.4);

Â  Â  Â  Â  [below, font=, align=center] at (3.5,-0.1) {Ø¬Ù†Ø¨Ø´ Ø³Ø¨Ø²\\Û¸Û¸};

Â  Â  Â  Â  [above, font=] at (3.5,0.4) {Û²};

Â  Â  Â  Â  [scenario3] (5,0) rectangle (6,0.3);

Â  Â  Â  Â  [below, font=, align=center] at (5.5,-0.1) {Ø¢Ø¨Ø§Ù†\\Û¹Û¸};

Â  Â  Â  Â  [above, font=] at (5.5,0.3) {Û±.Ûµ};

Â  Â  Â  Â  [scenario4] (7,0) rectangle (8,1);

Â  Â  Â  Â  [below, font=, align=center] at (7.5,-0.1) {Ù…Ù‡Ø³Ø§\\Û±Û´Û°Û±};

Â  Â  Â  Â  [above, font=] at (7.5,1) {Ûµ};

Â  Â  Â  Â  [rougerevolution] (9,0) rectangle (10,6);

Â  Â  Â  Â  [below, font=, align=center] at (9.5,-0.1) {Ø¯ÛŒâ€ŒÙ…Ø§Ù‡\\Û±Û´Û°Û´};

Â  Â  Â  Â  [above, font=, color=rougerevolution] at (9.5,6) {**Û³Û°**};

  
  
  

Ù¾Ø§Ø³Ø® Ù†Ø¸Ø§Ù… Ø¨Ù‡ Ø§ÛŒÙ† Ø®ÛŒØ²Ø´ØŒ Ø¨ÛŒâ€ŒØ³Ø§Ø¨Ù‚Ù‡â€ŒØªØ±ÛŒÙ† Ø³Ø±Ú©ÙˆØ¨ Ø¯Ø± ØªØ§Ø±ÛŒØ® Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø¨ÙˆØ¯:

  
  

{1.5}

{|>{}r|r|l|}

  
  

{**Ø´Ø§Ø®Øµ**} & {**Ø¨Ø±Ø¢ÙˆØ±Ø¯**} & {**ØªÙˆØ¶ÛŒØ­**} \\

  

Ú©Ø´ØªÙ‡â€ŒØ´Ø¯Ú¯Ø§Ù† & Û±Û²Ù¬Û°Û°Û° - Û¸Û´Ù¬Û°Û°Û° & Ø¹Ù…Ø¯ØªØ§Ù‹ Ø¨Ø§ Ø´Ù„ÛŒÚ© Ù…Ø³ØªÙ‚ÛŒÙ… Ú¯Ù„ÙˆÙ„Ù‡ Ø¬Ù†Ú¯ÛŒ \\

  

Ù…Ø¬Ø±ÙˆØ­Ø§Ù† & +Û³Û°Û°Ù¬Û°Û°Û° & Ø¨Ø³ÛŒØ§Ø±ÛŒ Ø¨Ø§ Ø¬Ø±Ø§Ø­Ø§Øª Ø¯Ø§Ø¦Ù…ÛŒ \\

  

Ø¨Ø§Ø²Ø¯Ø§Ø´Øªâ€ŒØ´Ø¯Ú¯Ø§Ù† & Ø¯Ù‡â€ŒÙ‡Ø§ Ù‡Ø²Ø§Ø± & ÙˆØ¶Ø¹ÛŒØª Ø¨Ø³ÛŒØ§Ø±ÛŒ Ù†Ø§Ù…Ø¹Ù„ÙˆÙ… \\

  

Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø¯Ø±Ú¯ÛŒØ± & +Û´Û°Û° & Ú¯Ø³ØªØ±Ø¯Ú¯ÛŒ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ø¨ÛŒâ€ŒØ³Ø§Ø¨Ù‚Ù‡ \\

  
  
  
  

[Ú†Ø±Ø§ Ø§ÛŒÙ† Ø§Ø±Ù‚Ø§Ù… Ù…Ù‡Ù… Ø§Ø³ØªØŸ]

Ú©Ø´ØªØ§Ø± Û¸Û°Ù¬Û°Û°Û° Ù†ÙØ± Ø¯Ø± Ø¯Ùˆ Ø±ÙˆØ² --- Ø§Ú¯Ø± Ø¨Ø±Ø¢ÙˆØ±Ø¯ Ø¨Ø§Ù„Ø§ Ø¯Ø±Ø³Øª Ø¨Ø§Ø´Ø¯ --- Ø§ÛŒÙ† Ù†Ø¸Ø§Ù… Ø±Ø§ Ø¯Ø± Ø±Ø¯ÛŒÙ Ø®ÙˆÙ†ÛŒÙ†â€ŒØªØ±ÛŒÙ† Ø³Ø±Ú©ÙˆØ¨â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ù…Ø¹Ø§ØµØ± Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø§ÛŒÙ† Ø³Ø·Ø­ Ø§Ø² Ø®Ø´ÙˆÙ†Øª Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ú†Ù†Ø¯ Ú†ÛŒØ² Ø§Ø³Øª:

[rightmargin=2em]

Â  Â  - Ù†Ø¸Ø§Ù… Ø­Ø§Ø¶Ø± Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ø¨Ù‚Ø§ØŒ Ù‡Ø± Ù‚ÛŒÙ…ØªÛŒ Ø¨Ù¾Ø±Ø¯Ø§Ø²Ø¯

Â  Â  - Ø¸Ø±ÙÛŒØª Ùˆ Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø³Ø±Ú©ÙˆØ¨ ÙØ±Ø§ØªØ± Ø§Ø² ØªØµÙˆØ± Ø¨Ø³ÛŒØ§Ø±ÛŒ Ø¨ÙˆØ¯

Â  Â  - Ù¾ÛŒÙˆÙ†Ø¯ Ø¹Ø§Ø·ÙÛŒ Ø¨ÛŒÙ† Ø­Ú©ÙˆÙ…Øª Ùˆ Ù…Ø±Ø¯Ù… Ø¨Ù‡â€ŒØ·ÙˆØ± Ø¨Ø§Ø²Ú¯Ø´Øªâ€ŒÙ†Ø§Ù¾Ø°ÛŒØ± Ú¯Ø³Ø³ØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª

  
  
  

### Ú†Ø±Ø§ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù‚Ø¨Ù„ Ù…Ù…Ú©Ù† Ù†ÛŒØ³ØªØŸ

  
  

[

Â  Â  node distance=1.5cm,

Â  Â  factor/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=8pt,

Â  Â  Â  Â  draw=bleurepublique,

Â  Â  Â  Â  line width=1pt,

Â  Â  Â  Â  fill=bleulight,

Â  Â  Â  Â  minimum width=4cm,

Â  Â  Â  Â  minimum height=1.2cm,

Â  Â  Â  Â  align=center,

Â  Â  Â  Â  font=

Â  Â  },

Â  Â  center/.style={

Â  Â  Â  Â  ellipse,

Â  Â  Â  Â  draw=rougerevolution,

Â  Â  Â  Â  line width=2pt,

Â  Â  Â  Â  fill=rougelight,

Â  Â  Â  Â  minimum width=4cm,

Â  Â  Â  Â  minimum height=2cm,

Â  Â  Â  Â  align=center,

Â  Â  Â  Â  font=

Â  Â  },

Â  Â  arrow/.style={

Â  Â  Â  Â  ->,

Â  Â  Â  Â  >=Stealth,

Â  Â  Â  Â  line width=1pt,

Â  Â  Â  Â  color=gris

Â  Â  }

]

Â  Â  % Ù…Ø±Ú©Ø²

Â  Â  [center] (center) {

Â  Â  Â  Â  {c}

Â  Â  Â  Â  Ø¨Ø§Ø²Ú¯Ø´Øªâ€ŒÙ†Ø§Ù¾Ø°ÛŒØ±ÛŒ\\

Â  Â  Â  Â  ÙˆØ¶Ø¹ÛŒØª

Â  Â  };

Â  Â  % Ø¹ÙˆØ§Ù…Ù„

Â  Â  [factor, above=of center] (trauma) {ØªØ±ÙˆÙ…Ø§ Ùˆ Ø®Ø´Ù… Ø¬Ù…Ø¹ÛŒ};

Â  Â  [factor, below=of center] (econ) {ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ};

Â  Â  [factor, left=of center] (legit) {Ø¨Ø­Ø±Ø§Ù† Ù…Ø´Ø±ÙˆØ¹ÛŒØª};

Â  Â  [factor, right=of center] (intl) {Ø§Ù†Ø²ÙˆØ§ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ};

Â  Â  [factor, above left=1cm and 0.5cm of center] (youth) {Ú¯Ø³Ø³Øª Ù†Ø³Ù„ÛŒ};

Â  Â  [factor, above right=1cm and 0.5cm of center] (region) {Ø¶Ø¹Ù Ù…Ù†Ø·Ù‚Ù‡â€ŒØ§ÛŒ};

Â  Â  % Ù¾ÛŒÚ©Ø§Ù†â€ŒÙ‡Ø§

Â  Â  [arrow] (trauma) -- (center);

Â  Â  [arrow] (econ) -- (center);

Â  Â  [arrow] (legit) -- (center);

Â  Â  [arrow] (intl) -- (center);

Â  Â  [arrow] (youth) -- (center);

Â  Â  [arrow] (region) -- (center);

  
  
  

[label=**.**, rightmargin=2em]

Â  Â  - **ØªØ±ÙˆÙ…Ø§ Ùˆ Ø®Ø´Ù… Ø¬Ù…Ø¹ÛŒ:** Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒØ§Ù†ØŒ Ø²Ø®Ù…ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø´Ø§Ù‡Ø¯Ø§Ù† Ú©Ø´ØªØ§Ø± Ù‡Ø±Ú¯Ø² ÙØ±Ø§Ù…ÙˆØ´ Ù†Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú©Ø±Ø¯. Ø§ÛŒÙ† Ø­Ø§ÙØ¸Ù‡ Ø¬Ù…Ø¹ÛŒ Ø¨Ù‡ Ù†ÛŒØ±ÙˆÛŒ Ù…Ø­Ø±Ú©Ù‡ Ù…Ø¨Ø§Ø±Ø²Ù‡ ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Ù‡ Ø§Ø³Øª.

Â  Â  - **Ú¯Ø³Ø³Øª Ù†Ø³Ù„ÛŒ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØ±Ù…ÛŒÙ…:** Ù†Ø³Ù„ Ø¬ÙˆØ§Ù† Ø§ÛŒØ±Ø§Ù† --- Ú©Ù‡ Ø§Ú©Ø«Ø±ÛŒØª Ø¬Ù…Ø¹ÛŒØª Ø±Ø§ ØªØ´Ú©ÛŒÙ„ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ --- Ù‡ÛŒÚ† Ù¾ÛŒÙˆÙ†Ø¯ Ù‡ÙˆÛŒØªÛŒ ÛŒØ§ Ø§ÛŒØ¯Ø¦ÙˆÙ„ÙˆÚ˜ÛŒÚ© Ø¨Ø§ Ù†Ø¸Ø§Ù… Ù†Ø¯Ø§Ø±Ø¯.

Â  Â  - **ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ:** ØªØ­Ø±ÛŒÙ…â€ŒÙ‡Ø§ØŒ ÙØ³Ø§Ø¯ Ø³ÛŒØ³ØªÙ…Ø§ØªÛŒÚ© Ùˆ Ù†Ø§Ú©Ø§Ø±Ø¢Ù…Ø¯ÛŒØŒ Ø§Ù‚ØªØµØ§Ø¯ Ø±Ø§ Ø¨Ù‡ Ù…Ø±Ø² ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ø±Ø³Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª. Ù†Ø¸Ø§Ù… ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ø±ÙØ§Ù‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.

Â  Â  - **Ø¶Ø¹Ù Ù…Ù†Ø·Ù‚Ù‡â€ŒØ§ÛŒ:** Ø³Ù‚ÙˆØ· Ø§Ø³Ø¯ Ø¯Ø± Ø³ÙˆØ±ÛŒÙ‡ØŒ Ø¶Ø±Ø¨Ø§Øª Ø³Ù†Ú¯ÛŒÙ† Ø¨Ù‡ Ø­Ø²Ø¨â€ŒØ§Ù„Ù„Ù‡ Ùˆ ÙØ´Ø§Ø± Ø¨Ø± Ø´Ø¨Ú©Ù‡ Ù†ÛŒØ§Ø¨ØªÛŒØŒ Ø¹Ù…Ù‚ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© Ù†Ø¸Ø§Ù… Ø±Ø§ ØªØ¶Ø¹ÛŒÙ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.

Â  Â  - **Ø§Ù†Ø²ÙˆØ§ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ:** ØªÙ†Ø´ Ø¨Ø§ ØºØ±Ø¨ Ø¨Ù‡ Ø§ÙˆØ¬ Ø±Ø³ÛŒØ¯Ù‡ Ùˆ Ø­ØªÛŒ Ù…ØªØ­Ø¯Ø§Ù† Ù†Ø¸ÛŒØ± Ø±ÙˆØ³ÛŒÙ‡ Ùˆ Ú†ÛŒÙ† Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ø±Ø§Ø¨Ø·Ù‡ Ù‡Ø³ØªÙ†Ø¯.

  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú©ÛŒØ³ØªØŸ

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø·ÛŒÙ ÙˆØ³ÛŒØ¹ÛŒ Ø§Ø² Ù…Ø®Ø§Ø·Ø¨Ø§Ù† Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª:

  
  

[

Â  Â  node distance=0.3cm,

Â  Â  audience/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=5pt,

Â  Â  Â  Â  draw=#1,

Â  Â  Â  Â  line width=1.5pt,

Â  Â  Â  Â  fill=#1!15,

Â  Â  Â  Â  minimum width=12cm,

Â  Â  Â  Â  minimum height=1.5cm,

Â  Â  Â  Â  align=right,

Â  Â  Â  Â  text width=11cm,

Â  Â  Â  Â  font=

Â  Â  }

]

Â  Â  [audience=bleurepublique] (a1) {

Â  Â  Â  Â  **ÙØ¹Ø§Ù„Ø§Ù† Ø³ÛŒØ§Ø³ÛŒ Ùˆ Ù…Ø¯Ù†ÛŒ Ø¯Ø§Ø®Ù„ Ú©Ø´ÙˆØ±:**

Â  Â  Â  Â  Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø± Ø®Ø· Ù…Ù‚Ø¯Ù… Ù…Ø¨Ø§Ø±Ø²Ù‡ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¨Ù‡ Ø±Ø§Ù‡Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù†Ø¯

Â  Â  };

Â  Â  [audience=vertnapoleon, below=of a1] (a2) {

Â  Â  Â  Â  **Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ† Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ø´ÙˆØ±:**

Â  Â  Â  Â  Ø¬Ø±ÛŒØ§Ù†â€ŒÙ‡Ø§ Ùˆ Ø´Ø®ØµÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯ Ù†Ù‚Ø´ Ù…Ø¤Ø«Ø±ØªØ±ÛŒ Ø§ÛŒÙØ§ Ú©Ù†Ù†Ø¯

Â  Â  };

Â  Â  [audience=violetempire, below=of a2] (a3) {

Â  Â  Â  Â  **Ø¯ÛŒØ§Ø³Ù¾ÙˆØ±Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ:**

Â  Â  Â  Â  Ù…ÛŒÙ„ÛŒÙˆÙ†â€ŒÙ‡Ø§ Ø§ÛŒØ±Ø§Ù†ÛŒ Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ø´ÙˆØ± Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯ Ú©Ù…Ú© Ú©Ù†Ù†Ø¯

Â  Â  };

Â  Â  [audience=orroyaldark, below=of a3] (a4) {

Â  Â  Â  Â  **ØªØ­Ù„ÛŒÙ„â€ŒÚ¯Ø±Ø§Ù† Ùˆ Ø³ÛŒØ§Ø³Øªâ€ŒÚ¯Ø°Ø§Ø±Ø§Ù† Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ:**

Â  Â  Â  Â  Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¨Ù‡ Ø¯Ø±Ú© Ø¹Ù…ÛŒÙ‚â€ŒØªØ± Ø§Ø² Ù¾ÙˆÛŒØ§ÛŒÛŒ ØªØ­ÙˆÙ„Ø§Øª Ø§ÛŒØ±Ø§Ù† Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù†Ø¯

Â  Â  };

Â  Â  [audience=gris, below=of a4] (a5) {

Â  Â  Â  Â  **Ø¹Ù…ÙˆÙ… Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯Ø§Ù†:**

Â  Â  Â  Â  Ù‡Ø± Ú©Ø³ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ø¨ÙÙ‡Ù…Ø¯ Ú†Ù‡ Ù…ÛŒâ€ŒÚ¯Ø°Ø±Ø¯ Ùˆ Ú†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ú©Ø±Ø¯

Â  Â  };

  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ø±ÙˆÛŒÚ©Ø±Ø¯ Ùˆ Ø±ÙˆØ´â€ŒØ´Ù†Ø§Ø³ÛŒ

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

### Ø§ØµÙˆÙ„ Ø±Ø§Ù‡Ù†Ù…Ø§

  

[Ù¾Ù†Ø¬ Ø§ØµÙ„ Ù…Ø­ÙˆØ±ÛŒ Ø§ÛŒÙ† Ù¾Ú˜ÙˆÙ‡Ø´]

[label=**.**, rightmargin=2em]

Â  Â  - **Ø¹Ù…Ù„â€ŒÚ¯Ø±Ø§ÛŒÛŒ:** Ù‡Ø¯Ù Ø§Ù†Ø¨Ø§Ø´Øª Ø¯Ø§Ù†Ø´ Ù†Ø¸Ø±ÛŒ Ù†ÛŒØ³ØªØ› Ù‡Ø¯Ù Ø§Ø±Ø§Ø¦Ù‡ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª.

Â  Â  - **ÙˆØ§Ù‚Ø¹â€ŒØ¨ÛŒÙ†ÛŒ:** Ù†Ù‡ Ø®ÙˆØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¯Ù‡â€ŒÙ„ÙˆØ­Ø§Ù†Ù‡ØŒ Ù†Ù‡ Ø¨Ø¯Ø¨ÛŒÙ†ÛŒ ÙÙ„Ø¬â€ŒÚ©Ù†Ù†Ø¯Ù‡. Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ØµØ§Ø¯Ù‚Ø§Ù†Ù‡ ÙØ±ØµØªâ€ŒÙ‡Ø§ Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§.

Â  Â  - **ÙØ±Ø§Ú¯ÛŒØ±ÛŒ:** Ø§Ø­ØªØ±Ø§Ù… Ø¨Ù‡ ØªÙ†ÙˆØ¹ Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø´ØªØ±Ú©Ø§Øª.

Â  Â  - **Ù…Ø³Ø¦ÙˆÙ„ÛŒØª:** Ø¢Ú¯Ø§Ù‡ÛŒ Ø§Ø² Ù¾ÛŒØ§Ù…Ø¯Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ Ùˆ Ø§ÙˆÙ„ÙˆÛŒØª Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø­ÙØ¸ Ø¬Ø§Ù† Ø§Ù†Ø³Ø§Ù†â€ŒÙ‡Ø§.

Â  Â  - **ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø§Ø² ØªØ§Ø±ÛŒØ®:** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ¬Ø±Ø¨ÛŒØ§Øª Ø³Ø§ÛŒØ± Ú©Ø´ÙˆØ±Ù‡Ø§ØŒ Ø¨Ø¯ÙˆÙ† Ú©Ù¾ÛŒâ€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ Ù…Ú©Ø§Ù†ÛŒÚ©ÛŒ.

  
  
  

### Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ù…Ø¨Ø§Ù†ÛŒ ØªØ­Ù„ÛŒÙ„

  

Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø± Ø³Ù‡ Ù¾Ø§ÛŒÙ‡ Ø§Ø³ØªÙˆØ§Ø± Ø§Ø³Øª:

  
  

[scale=0.9]

Â  Â  % Ø³Ù‡ Ø³ØªÙˆÙ†

Â  Â  [

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=10pt,

Â  Â  Â  Â  draw=bleurepublique,

Â  Â  Â  Â  line width=1.5pt,

Â  Â  Â  Â  fill=bleulight,

Â  Â  Â  Â  minimum width=4.5cm,

Â  Â  Â  Â  minimum height=5cm,

Â  Â  Â  Â  align=center

Â  Â  ] (col1) at (0,0) {};

Â  Â  [

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=10pt,

Â  Â  Â  Â  draw=vertnapoleon,

Â  Â  Â  Â  line width=1.5pt,

Â  Â  Â  Â  fill=vertlight,

Â  Â  Â  Â  minimum width=4.5cm,

Â  Â  Â  Â  minimum height=5cm,

Â  Â  Â  Â  align=center

Â  Â  ] (col2) at (5.5,0) {};

Â  Â  [

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=10pt,

Â  Â  Â  Â  draw=violetempire,

Â  Â  Â  Â  line width=1.5pt,

Â  Â  Â  Â  fill=violetlight,

Â  Â  Â  Â  minimum width=4.5cm,

Â  Â  Â  Â  minimum height=5cm,

Â  Â  Â  Â  align=center

Â  Â  ] (col3) at (11,0) {};

Â  Â  % Ø¹Ù†Ø§ÙˆÛŒÙ†

Â  Â  [font=, color=bleurepublique] at (0,2) {Ù†Ø¸Ø±ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø°Ø§Ø±};

Â  Â  [font=, color=vertnapoleon] at (5.5,2) {Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ÛŒ};

Â  Â  [font=, color=violetempire] at (11,2) {ØªØ­Ù„ÛŒÙ„ Ø§Ø®ØªØµØ§ØµÛŒ};

Â  Â  % Ù…Ø­ØªÙˆØ§

Â  Â  [align=center, text width=4cm, font=] at (0,0) {

Â  Â  Â  Â  Ø§Ø³Ú©Ø§Ú†Ù¾ÙˆÙ„\\

Â  Â  Â  Â  ØªÛŒÙ„ÛŒ\\

Â  Â  Â  Â  Ø¬ÛŒÙ† Ø´Ø§Ø±Ù¾\\

Â  Â  Â  Â  Ù†Ø¸Ø±ÛŒÙ‡ Ú¯Ø°Ø§Ø± Ø¯Ù…ÙˆÚ©Ø±Ø§ØªÛŒÚ©\\

Â  Â  Â  Â  (Ù¾ÛŒÙˆØ³Øª Ø§Ù„Ù)

Â  Â  };

Â  Â  [align=center, text width=4cm, font=] at (5.5,0) {

Â  Â  Â  Â  Ù„Ù‡Ø³ØªØ§Ù†\\

Â  Â  Â  Â  Ú†Ú©Ø³Ù„ÙˆØ§Ú©ÛŒ\\

Â  Â  Â  Â  Ø¢ÙØ±ÛŒÙ‚Ø§ÛŒ Ø¬Ù†ÙˆØ¨ÛŒ\\

Â  Â  Â  Â  Ø±ÙˆÙ…Ø§Ù†ÛŒ\\

Â  Â  Â  Â  Ø³ÙˆØ±ÛŒÙ‡ (Ø¯Ø±Ø³ Ù…Ù†ÙÛŒ)\\

Â  Â  Â  Â  (Ù¾ÛŒÙˆØ³Øª Ø¨)

Â  Â  };

Â  Â  [align=center, text width=4cm, font=] at (11,0) {

Â  Â  Â  Â  Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯Ø±Øª Ø¬.Ø§.\\

Â  Â  Â  Â  Ø·ÛŒÙâ€ŒØ´Ù†Ø§Ø³ÛŒ Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ†\\

Â  Â  Â  Â  ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÛŒØ¯Ø§Ù†ÛŒ\\

Â  Â  Â  Â  Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§\\

Â  Â  Â  Â  (ÙØµÙˆÙ„ Ø§ØµÙ„ÛŒ)

Â  Â  };

  
  
  

### ØªÛŒÙ… Ù¾Ú˜ÙˆÙ‡Ø´ÛŒ (Ú†Ø§Ø±Ú†ÙˆØ¨ ØªØ­Ù„ÛŒÙ„ÛŒ)

  

Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø§Ø² Ù…Ù†Ø¸Ø± ÛŒÚ© ØªÛŒÙ… Ú†Ù†Ø¯ØªØ®ØµØµÛŒ ÙØ±Ø¶ÛŒ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ Ú©Ù‡ Ø´Ø§Ù…Ù„:

  

[rightmargin=2em]

Â  Â  - **ØªØ§Ø±ÛŒØ®â€ŒØ¯Ø§Ù† Ø§Ù†Ù‚Ù„Ø§Ø¨â€ŒÙ‡Ø§:** ØªØ­Ù„ÛŒÙ„ Ø§Ù„Ú¯ÙˆÙ‡Ø§ Ùˆ Ú†Ø±Ø®Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ

Â  Â  - **Ø¬Ø§Ù…Ø¹Ù‡â€ŒØ´Ù†Ø§Ø³ Ø³ÛŒØ§Ø³ÛŒ:** Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ù†Ø¨Ø´â€ŒÙ‡Ø§ØŒ Ø·Ø¨Ù‚Ø§Øª Ùˆ Ø¨Ø³ÛŒØ¬ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ

Â  Â  - **Ø±ÙˆØ§Ù†â€ŒØ´Ù†Ø§Ø³ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ:** Ø¯Ø±Ú© Ø°Ù‡Ù†ÛŒØª Ø¬Ù…Ø¹ÛŒ Ùˆ ÙØ±Ù‡Ù†Ú¯ Ø³ÛŒØ§Ø³ÛŒ

Â  Â  - **Ø§Ù‚ØªØµØ§Ø¯Ø¯Ø§Ù† Ø³ÛŒØ§Ø³ÛŒ:** ØªØ­Ù„ÛŒÙ„ Ù…Ù†Ø§ÙØ¹ Ù…Ø§Ø¯ÛŒ Ùˆ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù†ØªÛŒ

Â  Â  - **Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒØ³Øª Ù†Ø¸Ø§Ù…ÛŒ:** Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ØªÙˆØ§Ø²Ù† Ù‚ÙˆØ§ Ùˆ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

Â  Â  - **Ø­Ù‚ÙˆÙ‚â€ŒØ¯Ø§Ù† Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„:** Ú†Ø§Ø±Ú†ÙˆØ¨â€ŒÙ‡Ø§ÛŒ Ø­Ù‚ÙˆÙ‚ÛŒ Ùˆ Ù…Ú©Ø§Ù†ÛŒØ²Ù…â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ

  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ø³Ø§Ø®ØªØ§Ø± Ú©ØªØ§Ø¨

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  
  

[

Â  Â  node distance=0.5cm,

Â  Â  part/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=3pt,

Â  Â  Â  Â  draw=#1,

Â  Â  Â  Â  line width=1pt,

Â  Â  Â  Â  fill=#1!10,

Â  Â  Â  Â  minimum width=14cm,

Â  Â  Â  Â  minimum height=0.8cm,

Â  Â  Â  Â  align=right,

Â  Â  Â  Â  text width=13.5cm,

Â  Â  Â  Â  font=

Â  Â  },

Â  Â  title/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=5pt,

Â  Â  Â  Â  draw=#1,

Â  Â  Â  Â  line width=2pt,

Â  Â  Â  Â  fill=#1!30,

Â  Â  Â  Â  minimum width=14cm,

Â  Â  Â  Â  minimum height=1cm,

Â  Â  Â  Â  align=center,

Â  Â  Â  Â  font=

Â  Â  }

]

Â  Â  % Ø¨Ø®Ø´ Ø§ÙˆÙ„

Â  Â  [title=bleurepublique] (t1) {Ø¨Ø®Ø´ Ø§ÙˆÙ„: Ù…Ø¨Ø§Ù†ÛŒ Ùˆ ÙˆØ¶Ø¹ÛŒØªâ€ŒØ´Ù†Ø§Ø³ÛŒ};

Â  Â  [part=bleurepublique, below=of t1] (p1a) {ÙØµÙ„ Û²: ØªØ´Ø±ÛŒØ­ Ù†Ø¸Ø§Ù… Ø­Ø§Ú©Ù… --- Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯Ø±ØªØŒ Ù†Ù‚Ø§Ø· Ø¶Ø¹ÙØŒ Ø¸Ø±ÙÛŒØª Ø³Ø±Ú©ÙˆØ¨};

Â  Â  % Ø¨Ø®Ø´ Ø¯ÙˆÙ…

Â  Â  [title=vertnapoleon, below=0.8cm of p1a] (t2) {Ø¨Ø®Ø´ Ø¯ÙˆÙ…: Ø¨Ø§Ø²ÛŒÚ¯Ø±Ø§Ù† Ùˆ Ù†ÛŒØ±ÙˆÙ‡Ø§};

Â  Â  [part=vertnapoleon, below=of t2] (p2a) {ÙØµÙ„ Û³: Ø·ÛŒÙâ€ŒØ´Ù†Ø§Ø³ÛŒ Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ† --- Ù†Ù‚Ø´Ù‡ Ø¬Ø±ÛŒØ§Ù†Ø§ØªØŒ SWOTØŒ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø§Ø¦ØªÙ„Ø§Ù};

Â  Â  [part=vertnapoleon, below=of p2a] (p2b) {ÙØµÙ„ Ûµ: Ø¨ÙØ¹Ø¯ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ --- Ø¨Ø§Ø²ÛŒÚ¯Ø±Ø§Ù†ØŒ Ù…Ø¯Ø§Ø®Ù„Ù‡ØŒ Ø¯ÛŒÙ¾Ù„Ù…Ø§Ø³ÛŒ};

Â  Â  % Ø¨Ø®Ø´ Ø³ÙˆÙ…

Â  Â  [title=violetempire, below=0.8cm of p2b] (t3) {Ø¨Ø®Ø´ Ø³ÙˆÙ…: Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§};

Â  Â  [part=violetempire, below=of t3] (p3a) {ÙØµÙ„ Û´: Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ú¯Ø°Ø§Ø± --- Ù¾Ù†Ø¬ Ù…Ø³ÛŒØ± Ø¨Ø§ ØªØ­Ù„ÛŒÙ„ Ù‡Ø²ÛŒÙ†Ù‡-ÙØ§ÛŒØ¯Ù‡};

Â  Â  [part=violetempire, below=of p3a] (p3b) {ÙØµÙ„ Û¶: ØªÙ‚ÙˆÛŒØª Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ† --- Ú†Ú¯ÙˆÙ†Ù‡ Ù…Ø§ Ù‚ÙˆÛŒâ€ŒØªØ± Ùˆ Ø­Ú©ÙˆÙ…Øª Ø¶Ø¹ÛŒÙâ€ŒØªØ± Ø´ÙˆØ¯};

Â  Â  [part=violetempire, below=of p3b] (p3c) {ÙØµÙ„ Û¸: ØªØ­Ù„ÛŒÙ„ Ø±ÛŒØ³Ú© --- Ù…Ø§ØªØ±ÛŒØ³ Ø±ÛŒØ³Ú©ØŒ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø¨Ø¯ØªØ±ÛŒÙ† Ø­Ø§Ù„Øª};

Â  Â  % Ø¨Ø®Ø´ Ú†Ù‡Ø§Ø±Ù…

Â  Â  [title=orroyaldark, below=0.8cm of p3c] (t4) {Ø¨Ø®Ø´ Ú†Ù‡Ø§Ø±Ù…: Ø§Ø¬Ø±Ø§ Ùˆ Ø¢ÛŒÙ†Ø¯Ù‡};

Â  Â  [part=orroyaldark, below=of t4] (p4a) {ÙØµÙ„ Û·: Ù…Ø¯ÛŒØ±ÛŒØª Ø¯ÙˆØ±Ù‡ Ú¯Ø°Ø§Ø± --- Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ² Ø¨Ø¹Ø¯ØŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù‡Ø±Ø¬â€ŒÙˆÙ…Ø±Ø¬};

Â  Â  [part=orroyaldark, below=of p4a] (p4b) {ÙØµÙ„ Û¹: Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ --- Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®ØµØŒ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ø§Ù†ÛŒ};

Â  Â  [part=orroyaldark, below=of p4b] (p4c) {ÙØµÙ„ Û±Û°: Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ --- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒØŒ ÙØ±Ø§Ø®ÙˆØ§Ù† Ø¹Ù…Ù„};

  
  
  

### Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§: Ø¯Ø§Ù†Ø´ ØªÚ©Ù…ÛŒÙ„ÛŒ

  

Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ ØªÙ…Ø±Ú©Ø² ÙØµÙˆÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø± ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØŒ Ù…Ø¨Ø§Ø­Ø« Ù†Ø¸Ø±ÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙØµÛŒÙ„ÛŒ Ø¯Ø± Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯:

  
  

{1.5}

{|>{}c|r|p{8cm}|}

  
  

{**Ù¾ÛŒÙˆØ³Øª**} & {**Ø¹Ù†ÙˆØ§Ù†**} & {**Ù…Ø­ØªÙˆØ§**} \\

  

Ø§Ù„Ù & Ù†Ø¸Ø±ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ù‚Ù„Ø§Ø¨ Ùˆ Ú¯Ø°Ø§Ø± & Ø§Ø³Ú©Ø§Ú†Ù¾ÙˆÙ„ØŒ ØªÛŒÙ„ÛŒØŒ Ø´Ø§Ø±Ù¾ØŒ Ù†Ø¸Ø±ÛŒÙ‡ Ú¯Ø°Ø§Ø± Ø¯Ù…ÙˆÚ©Ø±Ø§ØªÛŒÚ© \\

  

Ø¨ & Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ÛŒ & Û±Û² Ù†Ù…ÙˆÙ†Ù‡ ØªØ§Ø±ÛŒØ®ÛŒ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„ ØªØ·Ø¨ÛŒÙ‚ÛŒ \\

  

Ø¬ & Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯Ø±Øª Ø¬.Ø§. & Ù†Ù…ÙˆØ¯Ø§Ø± Ø³Ø§Ø²Ù…Ø§Ù†ÛŒØŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯Ø±ØªØŒ Ù†Ù‚Ø§Ø· Ø¢Ø³ÛŒØ¨â€ŒÙ¾Ø°ÛŒØ± \\

  

Ø¯ & ØªØ§Ø±ÛŒØ® Ø¬Ù†Ø¨Ø´â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù† & Ø§Ø² Û±Û³ÛµÛ· ØªØ§ Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´ \\

  

Ù‡ & Ø¢Ù…Ø§Ø± Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ & Ø§Ù‚ØªØµØ§Ø¯ÛŒØŒ Ø¬Ù…Ø¹ÛŒØªÛŒØŒ Ù†Ø¸Ø§Ù…ÛŒ \\

  

Ùˆ & Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø­Ù‚ÙˆÙ‚ Ø¨Ø´Ø±ÛŒ & Ú©Ø´ØªØ§Ø±Ù‡Ø§ØŒ Ø²Ù†Ø¯Ø§Ù†ÛŒØ§Ù†ØŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ \\

  

Ø² & Ú©ØªØ§Ø¨â€ŒØ´Ù†Ø§Ø³ÛŒ ØªÙØµÛŒÙ„ÛŒ & Ù…Ù†Ø§Ø¨Ø¹ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ \\

  
  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

### Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù†

  

[Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± Ú©ØªØ§Ø¨]

Ø¯Ø± Ø§ÛŒÙ† Ú©ØªØ§Ø¨ Ø§Ø² Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª:

  
  

{1.4}

{|c|r|p{7cm}|}

  
  

{{0.4cm}} & **Ø¢Ø¨ÛŒ** & Ø®Ù„Ø§ØµÙ‡ ÙØµÙ„ Ùˆ Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ \\

  
  

{{0.4cm}} & **Ø·Ù„Ø§ÛŒÛŒ** & Ù†Ù‚Ù„â€ŒÙ‚ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ú¯ÙØªØ§Ø±Ù‡Ø§ÛŒ Ù…Ù‡Ù… \\

  
  

{{0.4cm}} & **Ø³Ø¨Ø²** & Ø§Ù„Ú¯ÙˆÙ‡Ø§ØŒ Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ùˆ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø«Ø¨Øª \\

  
  

{{0.4cm}} & **Ù‚Ø±Ù…Ø²** & Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ Ùˆ Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§ \\

  
  

{{0.4cm}} & **Ø¨Ù†ÙØ´** & Ù†Ú©Ø§Øª Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© \\

  
  

{{0.4cm}} & **Ø®Ø§Ú©Ø³ØªØ±ÛŒ** & ØªÙˆØ¶ÛŒØ­Ø§Øª ÙÙ†ÛŒ Ùˆ ØªÚ©Ù…ÛŒÙ„ÛŒ \\

  
  
  
  
  

### Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ

  

Ø¨Ø³ØªÙ‡ Ø¨Ù‡ Ù†ÛŒØ§Ø² Ùˆ Ø²Ù…Ø§Ù† Ø´Ù…Ø§ØŒ Ø³Ù‡ Ù…Ø³ÛŒØ± Ø®ÙˆØ§Ù†Ø¯Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯:

  
  

[

Â  Â  node distance=0.8cm,

Â  Â  path/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=8pt,

Â  Â  Â  Â  draw=#1,

Â  Â  Â  Â  line width=2pt,

Â  Â  Â  Â  fill=#1!15,

Â  Â  Â  Â  minimum width=13cm,

Â  Â  Â  Â  minimum height=2.5cm,

Â  Â  Â  Â  align=right,

Â  Â  Â  Â  text width=12.5cm

Â  Â  }

]

Â  Â  [path=bleurepublique] (fast) {

Â  Â  Â  Â  ** Ù…Ø³ÛŒØ± Ø³Ø±ÛŒØ¹ (Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡)**\\[5pt]

Â  Â  Â  Â  ÙÙ‚Ø· Ø®Ù„Ø§ØµÙ‡ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ (ÙØµÙ„ Û°) + Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ Ø¢Ø¨ÛŒ Ù‡Ø± ÙØµÙ„\\

Â  Â  Â  Â  {Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±Ø§Ù†ØŒ Ø§ÙØ±Ø§Ø¯ Ù¾Ø±Ù…Ø´ØºÙ„Ù‡}

Â  Â  };

Â  Â  [path=vertnapoleon, below=of fast] (medium) {

Â  Â  Â  Â  ** Ù…Ø³ÛŒØ± Ù…ÛŒØ§Ù†Ù‡ (Û³-Û´ Ø³Ø§Ø¹Øª)**\\[5pt]

Â  Â  Â  Â  ÙØµÙˆÙ„ Û° ØªØ§ Û±Û° Ø¨Ø¯ÙˆÙ† Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§\\

Â  Â  Â  Â  {Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: ÙØ¹Ø§Ù„Ø§Ù†ØŒ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯Ø§Ù† Ø¬Ø¯ÛŒ}

Â  Â  };

Â  Â  [path=violetempire, below=of medium] (full) {

Â  Â  Â  Â  ** Ù…Ø³ÛŒØ± Ú©Ø§Ù…Ù„ (Û±Û°+ Ø³Ø§Ø¹Øª)**\\[5pt]

Â  Â  Â  Â  ØªÙ…Ø§Ù… ÙØµÙˆÙ„ + Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø­ÙˆØ²Ù‡ Ú©Ø§Ø±ÛŒ Ø´Ù…Ø§\\

Â  Â  Â  Â  {Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ: Ù¾Ú˜ÙˆÙ‡Ø´Ú¯Ø±Ø§Ù†ØŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒØ³Øªâ€ŒÙ‡Ø§ØŒ Ø±Ù‡Ø¨Ø±Ø§Ù† Ø¬Ø±ÛŒØ§Ù†Ø§Øª}

Â  Â  };

  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

[Ø¢Ù†Ú†Ù‡ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù†ÛŒØ³Øª]

[rightmargin=2em]

Â  Â  - **Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚Ø·Ø¹ÛŒ Ù†ÛŒØ³Øª:** Ù‡ÛŒÚ†â€ŒÚ©Ø³ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø§ Ø¨Ø§ Ù‚Ø·Ø¹ÛŒØª Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ú©Ù†Ø¯. Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ù‡Ø³ØªÙ†Ø¯ØŒ Ù†Ù‡ Ù‚Ø·Ø¹ÛŒØ§Øª.

Â  Â  - **Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ù†Ø¸Ø§Ù…ÛŒ Ù†ÛŒØ³Øª:** Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø¸Ø§Ù…ÛŒ ÛŒØ§ Ø®Ø´ÙˆÙ†Øªâ€ŒØ¢Ù…ÛŒØ² Ù†ÛŒØ³Øª Ùˆ Ú†Ù†ÛŒÙ† ØªÙˆØµÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

Â  Â  - **Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ù†ÛŒØ³Øª:** Ø´Ø±Ø§ÛŒØ· Ø¨Ù‡ Ø³Ø±Ø¹Øª ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´ÙˆØ¯.

Â  Â  - **Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø§Ø¬Ù…Ø§Ø¹ Ù†ÛŒØ³Øª:** ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø­Ø«ØŒ Ù†Ù‚Ø¯ Ùˆ Ø§Ø¬Ù…Ø§Ø¹â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø±Ù†Ø¯.

Â  Â  - **Ø¨ÛŒâ€ŒØ·Ø±Ù Ù…Ø­Ø¶ Ù†ÛŒØ³Øª:** Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø§Ø² Ù…ÙˆØ¶Ø¹ Ø·Ø±ÙØ¯Ø§Ø±ÛŒ Ø§Ø² Ø¯Ù…ÙˆÚ©Ø±Ø§Ø³ÛŒ Ùˆ Ø­Ù‚ÙˆÙ‚ Ø¨Ø´Ø± Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.

  
  
  

[Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§Ù…Ù†ÛŒØª]

**Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ:** Ø§Ú¯Ø± Ø¯Ø± Ø¯Ø§Ø®Ù„ Ø§ÛŒØ±Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ùˆ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯. Ø§Ø² Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ Ø§Ù…Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ù‡ÙˆÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø­Ø§ÙØ¸Øª Ú©Ù†ÛŒØ¯.

  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

[Ú†Ø±Ø§ Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ù…ØŸ]

Ø¯Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´ØŒ Ù…Ø«Ù„ Ù…ÛŒÙ„ÛŒÙˆÙ†â€ŒÙ‡Ø§ Ø§ÛŒØ±Ø§Ù†ÛŒ Ø¯ÛŒÚ¯Ø±ØŒ Ø¨Ø§ Ù†Ø§Ø¨Ø§ÙˆØ±ÛŒ Ùˆ Ø¯Ø±Ø¯ Ø´Ø§Ù‡Ø¯ Ú©Ø´ØªØ§Ø± Ù‡Ù…â€ŒÙˆØ·Ù†Ø§Ù†Ù… Ø¨ÙˆØ¯Ù…. Ø³Ø¤Ø§Ù„ÛŒ Ú©Ù‡ Ø°Ù‡Ù†Ù… Ø±Ø§ Ø±Ù‡Ø§ Ù†Ù…ÛŒâ€ŒÚ©Ø±Ø¯ Ø§ÛŒÙ† Ø¨ÙˆØ¯: Â«Ø­Ø§Ù„Ø§ Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ú©Ø±Ø¯ØŸÂ»

  

Ø§ÛŒÙ† Ø³Ù†Ø¯ ØªÙ„Ø§Ø´ÛŒ Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø§ÛŒÙ† Ø³Ø¤Ø§Ù„ --- Ù†Ù‡ Ø¨Ø§ Ø´Ø¹Ø§Ø± Ùˆ Ø§Ø­Ø³Ø§Ø³Ø§ØªØŒ Ø¨Ù„Ú©Ù‡ Ø¨Ø§ ØªØ­Ù„ÛŒÙ„ØŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ. Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù… Ú©Ù‡ Ù†Ø§Ù‚Øµ Ø§Ø³Øª Ùˆ Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù… Ú©Ù‡ Ù†Ù‚Ø¯ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø§Ù…Ø§ Ø¨Ø§ÙˆØ± Ø¯Ø§Ø±Ù… Ú©Ù‡ Ø³Ú©ÙˆØª Ùˆ Ø§Ù†ÙØ¹Ø§Ù„ Ø¨Ø¯ØªØ± Ø§Ø² Ø§Ù‚Ø¯Ø§Ù… Ù†Ø§Ù‚Øµ Ø§Ø³Øª.

  

Ø§ÛŒÙ† Ø³Ù†Ø¯ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ù‡ÛŒÚ† Ø¬Ø±ÛŒØ§Ù† Ø³ÛŒØ§Ø³ÛŒ Ø®Ø§ØµÛŒ Ù†ÛŒØ³Øª. Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ù‡Ù…Ù‡ Ø§ÛŒØ±Ø§Ù†ÛŒØ§Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡â€ŒØ§ÛŒ Ø¢Ø²Ø§Ø¯ Ùˆ Ø¯Ù…ÙˆÚ©Ø±Ø§ØªÛŒÚ© Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù†Ø¯.

  
  

Â Ù…Ù‡Ø¯ÛŒ Ø³Ø§Ù„Ù…

  

Â Ø±ÛŒÚ†Ù…ÙˆÙ†Ø¯Ù‡ÛŒÙ„ØŒ Ø¨Ù‡Ù…Ù† Û±Û´Û°Û´

  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ø®Ø· Ø²Ù…Ø§Ù†ÛŒ: Ø§Ø² Ø§Ù†Ù‚Ù„Ø§Ø¨ ÛµÛ· ØªØ§ Ø§Ù…Ø±ÙˆØ²

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú© ÙˆØ¶Ø¹ÛŒØª Ú©Ù†ÙˆÙ†ÛŒØŒ Ù†Ú¯Ø§Ù‡ÛŒ Ú¯Ø°Ø±Ø§ Ø¨Ù‡ Ù…Ø³ÛŒØ± Ø·ÛŒâ€ŒØ´Ø¯Ù‡ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª:

  
  
  

[scale=0.75, transform shape]

Â  Â  % Ø®Ø· Ø§ØµÙ„ÛŒ

Â  Â  [line width=4pt, color=bleurepublique] (0,0) -- (24,0);

Â  Â  % Ø¯Ù‡Ù‡â€ŒÙ‡Ø§

Â  Â  Â / in {0/Û±Û³ÛµÛ·, 6/Û±Û³Û¶Û·, 12/Û±Û³Û·Û·, 18/Û±Û³Û¸Û·, 24/Û±Û³Û¹Û·} {

Â  Â  Â  Â  [line width=2pt, color=bleurepublique] (,-0.3) -- (,0.3);

Â  Â  Â  Â  [below=0.5cm, font=] at (,0) {};

Â  Â  }

Â  Â  % Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ - Ø¨Ø§Ù„Ø§

Â  Â  [above=1cm, align=center, text width=2.5cm, font=] at (0,0) {

Â  Â  Â  Â  **Ø§Ù†Ù‚Ù„Ø§Ø¨ ÛµÛ·**\\

Â  Â  Â  Â  Ø³Ù‚ÙˆØ· Ù¾Ù‡Ù„ÙˆÛŒ

Â  Â  };

Â  Â  [color=rougerevolution] (0,0) circle (0.25);

Â  Â  [above=2.5cm, align=center, text width=2.5cm, font=] at (3,0) {

Â  Â  Â  Â  **Ø¬Ù†Ú¯ Û¸ Ø³Ø§Ù„Ù‡**\\

Â  Â  Â  Â  Û±Û³ÛµÛ¹-Û±Û³Û¶Û·

Â  Â  };

Â  Â  [color=orroyaldark] (3,0) circle (0.2);

Â  Â  [dashed, color=orroyaldark] (3,0) -- (3,2);

Â  Â  [above=1cm, align=center, text width=2.5cm, font=] at (6,0) {

Â  Â  Â  Â  **Ú©Ø´ØªØ§Ø± Û¶Û·**\\

Â  Â  Â  Â  Ù‡Ø²Ø§Ø±Ø§Ù† Ø§Ø¹Ø¯Ø§Ù…

Â  Â  };

Â  Â  [color=rougerevolution] (6,0) circle (0.25);

Â  Â  [above=2.5cm, align=center, text width=2.5cm, font=] at (9,0) {

Â  Â  Â  Â  **Ø³Ø§Ø²Ù†Ø¯Ú¯ÛŒ**\\

Â  Â  Â  Â  Ø±ÙØ³Ù†Ø¬Ø§Ù†ÛŒ

Â  Â  };

Â  Â  [color=gris] (9,0) circle (0.15);

Â  Â  [dashed, color=gris] (9,0) -- (9,2);

Â  Â  [above=1cm, align=center, text width=2.5cm, font=] at (12,0) {

Â  Â  Â  Â  **Ø§ØµÙ„Ø§Ø­Ø§Øª**\\

Â  Â  Â  Â  Ø®Ø§ØªÙ…ÛŒ

Â  Â  };

Â  Â  [color=vertnapoleon] (12,0) circle (0.2);

Â  Â  [above=2.5cm, align=center, text width=2.5cm, font=] at (14,0) {

Â  Â  Â  Â  **Û±Û¸ ØªÛŒØ± Û·Û¸**\\

Â  Â  Â  Â  Ú©ÙˆÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡

Â  Â  };

Â  Â  [color=scenario4] (14,0) circle (0.2);

Â  Â  [dashed, color=scenario4] (14,0) -- (14,2);

Â  Â  [above=1cm, align=center, text width=2.5cm, font=] at (18,0) {

Â  Â  Â  Â  **Ø¬Ù†Ø¨Ø´ Ø³Ø¨Ø²**\\

Â  Â  Â  Â  Û±Û³Û¸Û¸

Â  Â  };

Â  Â  [color=vertnapoleon] (18,0) circle (0.25);

Â  Â  [above=2.5cm, align=center, text width=2.5cm, font=] at (20,0) {

Â  Â  Â  Â  **Ø¯ÛŒ Û¹Û¶**\\

Â  Â  Â  Â  Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª

Â  Â  };

Â  Â  [color=scenario4] (20,0) circle (0.2);

Â  Â  [dashed, color=scenario4] (20,0) -- (20,2);

Â  Â  [above=1cm, align=center, text width=2.5cm, font=] at (22,0) {

Â  Â  Â  Â  **Ø¢Ø¨Ø§Ù† Û¹Û¸**\\

Â  Â  Â  Â  Û±ÛµÛ°Û° Ú©Ø´ØªÙ‡

Â  Â  };

Â  Â  [color=rougerevolution] (22,0) circle (0.25);

Â  Â  % Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ± - Ù¾Ø§ÛŒÛŒÙ†

Â  Â  [below=1.5cm, align=center, text width=2.8cm, font=] at (23,0) {

Â  Â  Â  Â  **Ù…Ù‡Ø³Ø§ Û±Û´Û°Û±**\\

Â  Â  Â  Â  Ø²Ù†ØŒ Ø²Ù†Ø¯Ú¯ÛŒØŒ Ø¢Ø²Ø§Ø¯ÛŒ

Â  Â  };

Â  Â  [color=violetempire] (23,0) circle (0.25);

Â  Â  [dashed, color=violetempire] (23,0) -- (23,-1);

Â  Â  % Ù†Ù‚Ø·Ù‡ Ø¹Ø·Ù

Â  Â  [below=3cm, align=center, text width=3cm, font=,

Â  Â  Â  Â  Â  fill=rougelight, draw=rougerevolution, rounded corners=5pt,

Â  Â  Â  Â  Â  line width=1.5pt, inner sep=5pt] at (24.5,0) {

Â  Â  Â  Â  **Ø¯ÛŒ Û±Û´Û°Û´**\\

Â  Â  Â  Â  Û³Û° Ù…ÛŒÙ„ÛŒÙˆÙ† Ù†ÙØ±\\

Â  Â  Â  Â  Ø¯Ù‡â€ŒÙ‡Ø§ Ù‡Ø²Ø§Ø± Ú©Ø´ØªÙ‡

Â  Â  };

Â  Â  [line width=2pt, color=rougerevolution, ->] (24,0) -- (24,-2.2);

Â  Â  % Ø±Ø§Ù‡Ù†Ù…Ø§

Â  Â  [anchor=north west] at (0,-4) {

Â  Â  Â  Â  {r@{ }l}

Â  Â  Â  Â  [rougerevolution] (0,0) circle (0.15); & Ø³Ø±Ú©ÙˆØ¨ Ø®ÙˆÙ†ÛŒÙ† \\

Â  Â  Â  Â  [vertnapoleon] (0,0) circle (0.15); & Ø¬Ù†Ø¨Ø´ Ù…Ø±Ø¯Ù…ÛŒ \\

Â  Â  Â  Â  [orroyaldark] (0,0) circle (0.15); & Ø¨Ø­Ø±Ø§Ù† \\

Â  Â  Â  Â  [gris] (0,0) circle (0.15); & ØªØ­ÙˆÙ„ Ø³ÛŒØ§Ø³ÛŒ \\

Â  Â  };

  
  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ú†Ø§Ø±Ú†ÙˆØ¨ ØªØ­Ù„ÛŒÙ„ÛŒ: Ú†Ù‡Ø§Ø± Ø³Ø¤Ø§Ù„ Ø¨Ù†ÛŒØ§Ø¯ÛŒÙ†

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

ØªÙ…Ø§Ù… Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø­ÙˆÙ„ Ú†Ù‡Ø§Ø± Ø³Ø¤Ø§Ù„ Ø§Ø³Ø§Ø³ÛŒ Ø³Ø§Ø²Ù…Ø§Ù† ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª:

  
  

[

Â  Â  node distance=2cm,

Â  Â  question/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=10pt,

Â  Â  Â  Â  draw=#1,

Â  Â  Â  Â  line width=2pt,

Â  Â  Â  Â  fill=#1!15,

Â  Â  Â  Â  minimum width=6cm,

Â  Â  Â  Â  minimum height=2cm,

Â  Â  Â  Â  align=center,

Â  Â  Â  Â  font=

Â  Â  },

Â  Â  answer/.style={

Â  Â  Â  Â  rectangle,

Â  Â  Â  Â  rounded corners=5pt,

Â  Â  Â  Â  draw=gris,

Â  Â  Â  Â  fill=grislight,

Â  Â  Â  Â  minimum width=5.5cm,

Â  Â  Â  Â  minimum height=1.2cm,

Â  Â  Â  Â  align=center,

Â  Â  Â  Â  font=

Â  Â  }

]

Â  Â  % Ø³Ø¤Ø§Ù„â€ŒÙ‡Ø§

Â  Â  [question=bleurepublique] (q1) at (0,4) {

Â  Â  Â  Â  {c}

Â  Â  Â  Â  Û±. ÙˆØ¶Ø¹ÛŒØª Ú†ÛŒØ³ØªØŸ\\

Â  Â  Â  Â  Â (ÙØµÙˆÙ„ Û²ØŒ Û³ØŒ Ûµ)

Â  Â  };

Â  Â  [question=vertnapoleon] (q2) at (8,4) {

Â  Â  Â  Â  {c}

Â  Â  Â  Â  Û². Ú†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ú©Ø±Ø¯ØŸ\\

Â  Â  Â  Â  Â (ÙØµÙˆÙ„ Û´ØŒ Û¶)

Â  Â  };

Â  Â  [question=violetempire] (q3) at (0,0) {

Â  Â  Â  Â  {c}

Â  Â  Â  Â  Û³. Ú†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø´ÙˆØ¯ØŸ\\

Â  Â  Â  Â  Â (ÙØµÙ„ Û¸)

Â  Â  };

Â  Â  [question=orroyaldark] (q4) at (8,0) {

Â  Â  Â  Â  {c}

Â  Â  Â  Â  Û´. Ú¯Ø§Ù… Ø¨Ø¹Ø¯ÛŒ Ú†ÛŒØ³ØªØŸ\\

Â  Â  Â  Â  Â (ÙØµÙˆÙ„ Û·ØŒ Û¹)

Â  Â  };

Â  Â  % Ù…Ø±Ú©Ø²

Â  Â  [ellipse, draw=rougerevolution, line width=2pt, fill=rougelight,

Â  Â  Â  Â  Â  minimum width=3cm, minimum height=1.5cm] (center) at (4,2) {

Â  Â  Â  Â  **Ú¯Ø°Ø§Ø± Ù…ÙˆÙÙ‚**

Â  Â  };

Â  Â  % Ø§ØªØµØ§Ù„Ø§Øª

Â  Â  [->, line width=1.5pt, color=bleurepublique] (q1) -- (center);

Â  Â  [->, line width=1.5pt, color=vertnapoleon] (q2) -- (center);

Â  Â  [->, line width=1.5pt, color=violetempire] (q3) -- (center);

Â  Â  [->, line width=1.5pt, color=orroyaldark] (q4) -- (center);

  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## ØªØ¹Ø±ÛŒÙ Ù…ÙØ§Ù‡ÛŒÙ… Ú©Ù„ÛŒØ¯ÛŒ

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

Ø¨Ø±Ø§ÛŒ Ø§Ø¬ØªÙ†Ø§Ø¨ Ø§Ø² Ø³ÙˆØ¡ØªÙØ§Ù‡Ù…ØŒ ØªØ¹Ø±ÛŒÙ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø®ÛŒ Ù…ÙØ§Ù‡ÛŒÙ… Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª:

  
  

{1.6}

{|>{}r|p{11cm}|}

  
  

{**Ù…ÙÙ‡ÙˆÙ…**} & {**ØªØ¹Ø±ÛŒÙ Ø¯Ø± Ø§ÛŒÙ† Ø³Ù†Ø¯**} \\

  
  
  
  

{**Ù…ÙÙ‡ÙˆÙ…**} & {**ØªØ¹Ø±ÛŒÙ Ø¯Ø± Ø§ÛŒÙ† Ø³Ù†Ø¯**} \\

  
  

Ú¯Ø°Ø§Ø± &

ÙØ±Ø¢ÛŒÙ†Ø¯ ØªØºÛŒÛŒØ± Ù†Ø¸Ø§Ù… Ø³ÛŒØ§Ø³ÛŒ Ø§Ø² Ø§Ù‚ØªØ¯Ø§Ø±Ú¯Ø±Ø§ÛŒÛŒ Ø¨Ù‡ Ø¯Ù…ÙˆÚ©Ø±Ø§Ø³ÛŒØŒ ØµØ±Ùâ€ŒÙ†Ø¸Ø± Ø§Ø² Ø±ÙˆØ´ (Ø§Ù†Ù‚Ù„Ø§Ø¨ØŒ Ø§ØµÙ„Ø§Ø­ØŒ Ù…Ø°Ø§Ú©Ø±Ù‡ØŒ ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ) \\

  

Ø³Ø±Ù†Ú¯ÙˆÙ†ÛŒ &

Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ† Ù†Ø¸Ø§Ù… Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø¨Ù‡ Ø´Ú©Ù„ ÙØ¹Ù„ÛŒØŒ Ù†Ù‡ Ù„Ø²ÙˆÙ…Ø§Ù‹ Ø¨Ø§ Ø®Ø´ÙˆÙ†Øª \\

  

ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ &

Ø§Ø² Ù‡Ù… Ù¾Ø§Ø´ÛŒØ¯Ù† Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯Ø±Øª Ø§Ø² Ø¯Ø±ÙˆÙ†ØŒ Ø¨Ø¯ÙˆÙ† ÙØ´Ø§Ø± Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÛŒØ§ÙØªÙ‡ Ø¨ÛŒØ±ÙˆÙ†ÛŒ \\

  

Ø§Ù†Ù‚Ù„Ø§Ø¨ &

ØªØºÛŒÛŒØ± Ø¨Ù†ÛŒØ§Ø¯ÛŒÙ† Ø¯Ø± Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯Ø±Øª Ø¨Ø§ Ù…Ø´Ø§Ø±Ú©Øª Ú¯Ø³ØªØ±Ø¯Ù‡ Ù…Ø±Ø¯Ù…ÛŒ \\

  

Ú©ÙˆØ¯ØªØ§ &

ØªØºÛŒÛŒØ± Ù‚Ø¯Ø±Øª ØªÙˆØ³Ø· Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù†ÛŒØ±ÙˆÙ‡Ø§ÛŒ Ù…Ø³Ù„Ø­ ÛŒØ§ Ù†Ø®Ø¨Ú¯Ø§Ù† Ø­Ø§Ú©Ù… \\

  

Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ† &

Ù‡Ù…Ù‡ Ù†ÛŒØ±ÙˆÙ‡Ø§ Ùˆ Ø§ÙØ±Ø§Ø¯ÛŒ Ú©Ù‡ Ø®ÙˆØ§Ù‡Ø§Ù† ØªØºÛŒÛŒØ± Ù†Ø¸Ø§Ù… Ø³ÛŒØ§Ø³ÛŒ Ù‡Ø³ØªÙ†Ø¯ \\

  

Ù†Ø§ÙØ±Ù…Ø§Ù†ÛŒ Ù…Ø¯Ù†ÛŒ &

Ø³Ø±Ù¾ÛŒÚ†ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÛŒØ§ÙØªÙ‡ Ùˆ Ø®Ø´ÙˆÙ†Øªâ€ŒÙ¾Ø±Ù‡ÛŒØ² Ø§Ø² Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø­Ú©ÙˆÙ…Øª \\

  

Ø®Ø´ÙˆÙ†Øªâ€ŒÙ¾Ø±Ù‡ÛŒØ²ÛŒ &

Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…Ø¨Ø§Ø±Ø²Ù‡ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø®Ø´ÙˆÙ†Øª ÙÛŒØ²ÛŒÚ©ÛŒ Ø¹Ù„ÛŒÙ‡ Ø§Ù†Ø³Ø§Ù†â€ŒÙ‡Ø§ \\

  

Ø§Ø¦ØªÙ„Ø§Ù &

Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¬Ø±ÛŒØ§Ù†Ø§Øª Ù…Ø®ØªÙ„Ù Ø­ÙˆÙ„ Ø§Ù‡Ø¯Ø§Ù Ù…Ø´ØªØ±Ú©ØŒ Ø¨Ø§ Ø­ÙØ¸ Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ù‡Ø± Ø¬Ø±ÛŒØ§Ù† \\

  

Ø¹Ø¯Ø§Ù„Øª Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ &

Ù…Ú©Ø§Ù†ÛŒØ²Ù…â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø¨Ù‡ Ù†Ù‚Ø¶ Ø­Ù‚ÙˆÙ‚ Ø¨Ø´Ø± Ú¯Ø°Ø´ØªÙ‡ØŒ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø¢Ø´ØªÛŒ Ù…Ù„ÛŒ \\

  
  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ù†Ø¯Ù‡

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

Ø¯Ø± Ù¾Ø§ÛŒØ§Ù† Ù‡Ø± ÙØµÙ„ØŒ Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªØ£Ù…Ù„ Ùˆ Ø¨Ø­Ø« Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ÙØµÙ„:

  

[Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªØ£Ù…Ù„]

[label=**.**, rightmargin=2em]

Â  Â  - Ø¢ÛŒØ§ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª ÙˆØ§Ù‚Ø¹Ø§Ù‹ Â«Ø¨Ø§Ø²Ú¯Ø´Øªâ€ŒÙ†Ø§Ù¾Ø°ÛŒØ±Â» Ø´Ø¯Ù‡ Ø§Ø³ØªØŸ Ú†Ø±Ø§ØŸ

Â  Â  - Ú©Ø¯Ø§Ù… Ù…Ø®Ø§Ø·Ø¨ Ø§ÛŒÙ† Ø³Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯ Ùˆ Ú†Ù‡ Ø§Ù†ØªØ¸Ø§Ø±ÛŒ Ø§Ø² Ø¢Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ

Â  Â  - Ø¯Ø± Ø·ÛŒÙ Â«Ø®ÙˆØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªØ§ Ø¨Ø¯Ø¨ÛŒÙ†ÛŒÂ» Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§Ù…Ú©Ø§Ù† Ú¯Ø°Ø§Ø±ØŒ Ø®ÙˆØ¯ Ø±Ø§ Ú©Ø¬Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒØ¯ØŸ

Â  Â  - Ú†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒØ§ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ø¨ÛŒÙ†ÛŒØ¯ØŸ

Â  Â  - Ø§Ú¯Ø± ÛŒÚ© ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø³ØªÛŒØ¯ Ø¨Ù‡ Ø§Ù¾ÙˆØ²ÛŒØ³ÛŒÙˆÙ† Ø¨Ø¯Ù‡ÛŒØ¯ØŒ Ú†Ù‡ Ø¨ÙˆØ¯ØŸ

  
  
  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

%â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  

[rightmargin=2em, font=]

Â  Â  - Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø­Ù‚ÙˆÙ‚ Ø¨Ø´Ø±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ Û±Û´Û°Û´

Â  Â  - ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø§Ú©Ø² Ù¾Ú˜ÙˆÙ‡Ø´ÛŒ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ

Â  Â  - Ù…ØµØ§Ø­Ø¨Ù‡â€ŒÙ‡Ø§ Ùˆ Ø´Ù‡Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø§Ù‡Ø¯Ø§Ù† Ø¹ÛŒÙ†ÛŒ

Â  Â  - Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø³ØªÙ‚Ù„

Â  Â  - Ø§Ø¯Ø¨ÛŒØ§Øª Ù†Ø¸Ø±ÛŒ Ú¯Ø°Ø§Ø± Ø¯Ù…ÙˆÚ©Ø±Ø§ØªÛŒÚ© (ØªÙØµÛŒÙ„ Ø¯Ø± Ù¾ÛŒÙˆØ³Øª Ø§Ù„Ù)

  
  
  
  
  
  

Â  Â  [line width=2pt, color=orroyal] (0,0) -- (12,0);

  
  
  
  
  
  

*Ø¯Ø± ÙØµÙ„ Ø¨Ø¹Ø¯ØŒ Ø¨Ù‡ ØªØ´Ø±ÛŒØ­ Ø¯Ù‚ÛŒÙ‚ Ù†Ø¸Ø§Ù… Ø­Ø§Ú©Ù… Ù…ÛŒâ€ŒÙ¾Ø±Ø¯Ø§Ø²ÛŒÙ…: Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯Ø±ØªØŒ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù Ùˆ Ø¸Ø±ÙÛŒØª Ø³Ø±Ú©ÙˆØ¨.*

%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

% ÙØµÙ„ Ø¯ÙˆÙ…: ØªØ´Ø±ÛŒØ­ Ù†Ø¸Ø§Ù… Ø­Ø§Ú©Ù…

%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### # ØªØ´Ø®ÛŒØµ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø±Ø§Ù‡â€ŒØ­Ù„ Ú©Ø§Ù…Ù„

#  Ù¾Ø§Ø³Ø® ... 
## ğŸ”ØªØ´Ø®ÛŒØµ Ù…Ø´Ú©Ù„

Ø§Ú©Ù†ÙˆÙ† Ù…Ø´Ú©Ù„ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù…! Ø¯Ø± Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ú©Ù‡ ÙØ±Ø³ØªØ§Ø¯ÛŒØ¯:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ù…Ø´Ú©Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ÙØ§ÛŒÙ„ LaTeX Ø´Ù…Ø§:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ \begin{tikzpicture}[...]                â”‚                    â”‚
â”‚  â”‚   \node[audience=bleurepublique] (a1)   â”‚                    â”‚
â”‚  â”‚   {...}                                  â”‚                    â”‚
â”‚  â”‚ \end{tikzpicture}                       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼ Pandoc                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ [node distance=0.3cm,                   â”‚  âŒ Ø®Ø±ÙˆØ¬ÛŒ Ø®Ø±Ø§Ø¨     â”‚
â”‚  â”‚ audience/.style={...}]                  â”‚                    â”‚
â”‚  â”‚ (a1) {...}                              â”‚  â† Ø¨Ø¯ÙˆÙ† wrapper    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â† Ú©Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù‚Øµ   â”‚
â”‚                                                                   â”‚
â”‚  âš ï¸ Pandoc Ú©Ø§Ù…Ù†Ø¯Ù‡Ø§ÛŒ TikZ Ø±Ø§ Ù†Ù…ÛŒâ€ŒÙÙ‡Ù…Ø¯ Ùˆ Ø¢Ù†Ù‡Ø§ Ø±Ø§                  â”‚
â”‚     Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªÙ† Ø®Ø§Ù…/Ù†Ø§Ù‚Øµ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Ù‡Ù…Ú†Ù†ÛŒÙ† Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù… Ú©Ù‡ Ø§Ø² **Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯:
- `bleurepublique`, `bleulight`
- `vertnapoleon`, `vertlight`
- `violetempire`, `rougerevolution`
- `orroyaldark`, `gris`, `grisclair`

---

## ğŸ› ï¸ Ø±Ø§Ù‡â€ŒØ­Ù„ Ú©Ø§Ù…Ù„: Pipeline Ø³Ù‡â€ŒÙ…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Pipeline Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø­ØªÙˆØ§                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  LaTeX   â”‚â”€â”€â”€â”€â–¶â”‚   Pre-   â”‚â”€â”€â”€â”€â–¶â”‚  Pandoc  â”‚â”€â”€â”€â”€â–¶â”‚  Post- â”‚ â”‚
â”‚  â”‚  Source  â”‚     â”‚ Process  â”‚     â”‚          â”‚     â”‚ Processâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                 â”‚      â”‚
â”‚                        â–¼                                 â–¼      â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                 â”‚ TikZ â†’ SVG   â”‚                 â”‚ Cleanup &  â”‚ â”‚
â”‚                 â”‚ + Placeholderâ”‚                 â”‚ Fix RTL    â”‚ â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                     â”‚  Clean .md     â”‚                          â”‚
â”‚                     â”‚  + SVG files   â”‚                          â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                     â”‚     Astro      â”‚                          â”‚
â”‚                     â”‚     Build      â”‚                          â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯

```
your-site/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”œâ”€â”€ articles/
â”‚   â”‚   â”œâ”€â”€ books/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ MermaidDiagram.astro    â† Ø¬Ø¯ÛŒØ¯
â”‚   â”‚   â”œâ”€â”€ TikzDiagram.astro       â† Ø¬Ø¯ÛŒØ¯
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ layouts/
â”‚       â””â”€â”€ ArticleLayout.astro     â† Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡
â”œâ”€â”€ scripts/                         â† Ù¾ÙˆØ´Ù‡ Ø¬Ø¯ÛŒØ¯
â”‚   â”œâ”€â”€ process-book.mjs            â† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ
â”‚   â”œâ”€â”€ tikz-renderer.mjs           â† Ø±Ù†Ø¯Ø± TikZ
â”‚   â”œâ”€â”€ color-definitions.tex       â† ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§
â”‚   â””â”€â”€ post-process.mjs            â† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
â”œâ”€â”€ content-source/                  â† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ LaTeX
â”‚   â””â”€â”€ books/
â”‚       â””â”€â”€ transition-guide/
â”‚           â”œâ”€â”€ main.tex
â”‚           â”œâ”€â”€ chapter1.tex
â”‚           â””â”€â”€ ...
â”œâ”€â”€ public/
â”‚   â””â”€â”€ diagrams/                    â† SVG Ù‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡
â””â”€â”€ package.json
```

---

## ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡

### Û±. ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ Ø´Ù…Ø§

**ÙØ§ÛŒÙ„ `scripts/color-definitions.tex`:**

```latex
% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
% ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

\usepackage{xcolor}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨ÛŒ
\definecolor{bleurepublique}{RGB}{26, 115, 232}
\definecolor{bleulight}{RGB}{232, 244, 248}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø²
\definecolor{vertnapoleon}{RGB}{52, 168, 83}
\definecolor{vertlight}{RGB}{232, 248, 237}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ù†ÙØ´
\definecolor{violetempire}{RGB}{142, 68, 173}
\definecolor{violetlight}{RGB}{245, 238, 248}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ù…Ø²
\definecolor{rougerevolution}{RGB}{234, 67, 53}
\definecolor{rougelight}{RGB}{252, 237, 236}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø·Ù„Ø§ÛŒÛŒ/Ù†Ø§Ø±Ù†Ø¬ÛŒ
\definecolor{orroyal}{RGB}{251, 188, 4}
\definecolor{orroyaldark}{RGB}{230, 150, 0}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ú©Ø³ØªØ±ÛŒ
\definecolor{gris}{RGB}{95, 99, 104}
\definecolor{grisclair}{RGB}{218, 220, 224}
\definecolor{grislight}{RGB}{248, 249, 250}

% Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ
\definecolor{scenario1}{RGB}{66, 133, 244}
\definecolor{scenario2}{RGB}{52, 168, 83}
\definecolor{scenario3}{RGB}{251, 188, 4}
\definecolor{scenario4}{RGB}{234, 67, 53}
```

### Û². Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´

**ÙØ§ÛŒÙ„ `scripts/process-book.mjs`:**

```javascript
#!/usr/bin/env node
/**
 * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ LaTeX Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Markdown
 * 
 * Ø§Ø³ØªÙØ§Ø¯Ù‡:
 *   node scripts/process-book.mjs content-source/books/my-book/main.tex
 *   node scripts/process-book.mjs content-source/books/my-book/ --all-chapters
 */

import { exec } from 'child_process';
import { promisify } from 'util';
import fs from 'fs/promises';
import path from 'path';
import crypto from 'crypto';
import { globby } from 'globby';

const execAsync = promisify(exec);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  tempDir: '/tmp/latex-processor',
  outputDiagramsDir: './public/diagrams',
  colorDefsFile: './scripts/color-definitions.tex',
  
  // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ TikZ
  tikzPatterns: [
    // tikzpicture Ù…Ø¹Ù…ÙˆÙ„ÛŒ
    /\\begin\{tikzpicture\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{tikzpicture\}/g,
    // forest
    /\\begin\{forest\}([\s\S]*?)\\end\{forest\}/g,
    // ganttchart
    /\\begin\{ganttchart\}(\[[\s\S]*?\])?([\s\S]*?)\\end\{ganttchart\}/g,
  ],
  
  // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø¬Ø¯Ø§ÙˆÙ„
  tablePatterns: [
    /\\begin\{tabular\}(\{[\s\S]*?\})([\s\S]*?)\\end\{tabular\}/g,
    /\\begin\{longtable\}(\{[\s\S]*?\})([\s\S]*?)\\end\{longtable\}/g,
  ],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± TikZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class TikZProcessor {
  constructor() {
    this.processedCount = 0;
    this.failedCount = 0;
    this.cache = new Map();
  }

  /**
   * ØªÙˆÙ„ÛŒØ¯ Ù‡Ø´ ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ TikZ
   */
  generateHash(code) {
    return crypto.createHash('md5').update(code).digest('hex').slice(0, 10);
  }

  /**
   * Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ LaTeX Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù†Ù…ÙˆØ¯Ø§Ø±
   */
  buildStandaloneTeX(tikzCode, options = {}) {
    const { scale = 1, font = 'Vazirmatn' } = options;
    
    return `
\\documentclass[tikz,border=15pt]{standalone}

% Ø¨Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
\\usepackage{fontspec}
\\usepackage{xcolor}
\\usepackage{tikz}
\\usepackage{pgfplots}
\\pgfplotsset{compat=1.18}

% Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ TikZ
\\usetikzlibrary{
  shapes.geometric,
  shapes.misc,
  arrows.meta,
  positioning,
  calc,
  backgrounds,
  fit,
  decorations.pathreplacing,
  shadows,
  trees
}

% ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ
\\setmainfont[Script=Arabic,Scale=${scale}]{${font}}

% ØªØ¹Ø±ÛŒÙ Ø±Ù†Ú¯â€ŒÙ‡Ø§
\\input{${path.resolve(CONFIG.colorDefsFile)}}

\\begin{document}
${tikzCode}
\\end{document}
`;
  }

  /**
   * ØªØ¨Ø¯ÛŒÙ„ Ú©Ø¯ TikZ Ø¨Ù‡ SVG
   */
  async renderToSVG(tikzCode, outputName) {
    const hash = this.generateHash(tikzCode);
    const svgPath = path.join(CONFIG.outputDiagramsDir, `${outputName}-${hash}.svg`);
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´
    if (this.cache.has(hash)) {
      console.log(`   âš¡ Ø§Ø² Ú©Ø´: ${outputName}`);
      return this.cache.get(hash);
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯
    try {
      await fs.access(svgPath);
      console.log(`   ğŸ“ Ù…ÙˆØ¬ÙˆØ¯: ${outputName}`);
      this.cache.set(hash, svgPath);
      return svgPath;
    } catch {}
    
    // Ø³Ø§Ø®Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§
    await fs.mkdir(CONFIG.tempDir, { recursive: true });
    await fs.mkdir(CONFIG.outputDiagramsDir, { recursive: true });
    
    const texContent = this.buildStandaloneTeX(tikzCode);
    const texFile = path.join(CONFIG.tempDir, `${outputName}.tex`);
    const pdfFile = path.join(CONFIG.tempDir, `${outputName}.pdf`);
    
    try {
      // Ù†ÙˆØ´ØªÙ† ÙØ§ÛŒÙ„ TeX
      await fs.writeFile(texFile, texContent, 'utf-8');
      
      // Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø¨Ø§ XeLaTeX
      console.log(`   ğŸ”„ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„: ${outputName}...`);
      await execAsync(
        `cd "${CONFIG.tempDir}" && xelatex -interaction=nonstopmode -halt-on-error "${outputName}.tex"`,
        { timeout: 60000 }
      );
      
      // ØªØ¨Ø¯ÛŒÙ„ PDF Ø¨Ù‡ SVG
      await execAsync(`pdf2svg "${pdfFile}" "${svgPath}"`);
      
      // Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ SVG
      let svgContent = await fs.readFile(svgPath, 'utf-8');
      svgContent = this.optimizeSVG(svgContent, outputName);
      await fs.writeFile(svgPath, svgContent, 'utf-8');
      
      console.log(`   âœ… ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯: ${outputName}`);
      this.processedCount++;
      this.cache.set(hash, svgPath);
      
      return svgPath;
      
    } catch (error) {
      console.error(`   âŒ Ø®Ø·Ø§ Ø¯Ø± ${outputName}:`, error.message);
      this.failedCount++;
      
      // Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§
      const logFile = path.join(CONFIG.tempDir, `${outputName}.log`);
      try {
        const logContent = await fs.readFile(logFile, 'utf-8');
        const errorLines = logContent.split('\n').filter(l => l.includes('!') || l.includes('Error'));
        console.error(`   ğŸ“‹ Ø¬Ø²Ø¦ÛŒØ§Øª:`, errorLines.slice(0, 5).join('\n'));
      } catch {}
      
      return null;
    }
  }

  /**
   * Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„Ø§Ø³ Ø¨Ù‡ SVG
   */
  optimizeSVG(svgContent, name) {
    return svgContent
      // Ø­Ø°Ù Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§
      .replace(/<!--[\s\S]*?-->/g, '')
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ Ùˆ Ø´Ù†Ø§Ø³Ù‡
      .replace(
        '<svg',
        `<svg class="tikz-diagram" id="diagram-${name}" role="img" aria-label="Ù†Ù…ÙˆØ¯Ø§Ø± ${name}"`
      )
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø³ØªØ§ÛŒÙ„ dark mode
      .replace(
        '</svg>',
        `<style>
          @media (prefers-color-scheme: dark) {
            .tikz-diagram text { fill: #e2e8f0; }
            .tikz-diagram path[stroke="#000"], 
            .tikz-diagram line[stroke="#000"] { stroke: #e2e8f0; }
          }
        </style></svg>`
      );
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ú©Ù„Ø§Ø³ Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± Ø§ØµÙ„ÛŒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class LaTeXToMarkdownProcessor {
  constructor() {
    this.tikzProcessor = new TikZProcessor();
    this.diagramCounter = 0;
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‡Ù…Ù‡ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ TikZ
   */
  extractTikZBlocks(content) {
    const blocks = [];
    
    for (const pattern of CONFIG.tikzPatterns) {
      let match;
      const regex = new RegExp(pattern.source, 'g');
      
      while ((match = regex.exec(content)) !== null) {
        blocks.push({
          full: match[0],
          code: match[0],
          index: match.index,
          type: this.detectTikZType(match[0])
        });
      }
    }
    
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆÙ‚Ø¹ÛŒØª (Ø§Ø² Ø¢Ø®Ø± Ø¨Ù‡ Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø§Ù…Ù†)
    return blocks.sort((a, b) => b.index - a.index);
  }

  /**
   * ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ù†Ù…ÙˆØ¯Ø§Ø± TikZ
   */
  detectTikZType(code) {
    if (code.includes('\\begin{forest}')) return 'tree';
    if (code.includes('\\begin{ganttchart}')) return 'gantt';
    if (code.includes('axis') || code.includes('\\addplot')) return 'chart';
    if (code.includes('mindmap')) return 'mindmap';
    if (code.includes('flowchart') || code.includes('->')) return 'flowchart';
    return 'diagram';
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„ LaTeX
   */
  async processFile(inputPath, outputDir, options = {}) {
    const { bookSlug, chapterNumber, lang = 'fa' } = options;
    
    console.log(`\n${'â•'.repeat(60)}`);
    console.log(`ğŸ“„ Ù¾Ø±Ø¯Ø§Ø²Ø´: ${inputPath}`);
    console.log(`${'â•'.repeat(60)}`);
    
    let content = await fs.readFile(inputPath, 'utf-8');
    
    // Û±. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ TikZ
    console.log('\nğŸ“Š Ù…Ø±Ø­Ù„Ù‡ Û±: Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§...');
    content = await this.processTikZBlocks(content, bookSlug);
    
    // Û². Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø±Ø§ÛŒ Pandoc
    console.log('\nğŸ”§ Ù…Ø±Ø­Ù„Ù‡ Û²: Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´...');
    content = this.preProcessForPandoc(content);
    
    // Û³. Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Pandoc
    console.log('\nğŸ“ Ù…Ø±Ø­Ù„Ù‡ Û³: ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Pandoc...');
    const tempTexFile = path.join(CONFIG.tempDir, 'processed.tex');
    await fs.writeFile(tempTexFile, content, 'utf-8');
    
    const tempMdFile = path.join(CONFIG.tempDir, 'output.md');
    await execAsync(
      `pandoc "${tempTexFile}" -o "${tempMdFile}" --wrap=none --columns=1000`
    );
    
    let markdown = await fs.readFile(tempMdFile, 'utf-8');
    
    // Û´. Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Markdown
    console.log('\nâœ¨ Ù…Ø±Ø­Ù„Ù‡ Û´: Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´...');
    markdown = this.postProcessMarkdown(markdown, { lang });
    
    // Ûµ. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† frontmatter
    markdown = this.addFrontmatter(markdown, inputPath, options);
    
    // Û¶. Ø°Ø®ÛŒØ±Ù‡ Ø®Ø±ÙˆØ¬ÛŒ
    await fs.mkdir(outputDir, { recursive: true });
    const outputFileName = this.generateOutputFileName(inputPath, options);
    const outputPath = path.join(outputDir, outputFileName);
    await fs.writeFile(outputPath, markdown, 'utf-8');
    
    console.log(`\nâœ… Ø®Ø±ÙˆØ¬ÛŒ: ${outputPath}`);
    console.log(`   ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§: ${this.tikzProcessor.processedCount} Ù…ÙˆÙÙ‚ØŒ ${this.tikzProcessor.failedCount} Ù†Ø§Ù…ÙˆÙÙ‚`);
    
    return outputPath;
  }

  /**
   * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ TikZ
   */
  async processTikZBlocks(content, prefix = 'diagram') {
    const blocks = this.extractTikZBlocks(content);
    
    console.log(`   ÛŒØ§ÙØª Ø´Ø¯: ${blocks.length} Ù†Ù…ÙˆØ¯Ø§Ø±`);
    
    for (const block of blocks) {
      this.diagramCounter++;
      const diagramName = `${prefix}-${this.diagramCounter}-${block.type}`;
      
      const svgPath = await this.tikzProcessor.renderToSVG(block.code, diagramName);
      
      if (svgPath) {
        // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¨Ø§ ØªÚ¯ ØªØµÙˆÛŒØ±
        const relativePath = `/diagrams/${path.basename(svgPath)}`;
        const replacement = `\n\n![${block.type}](${relativePath}){.tikz-diagram}\n\n`;
        content = content.replace(block.full, replacement);
      } else {
        // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù†Øª Ø¨Ú¯Ø°Ø§Ø±
        const replacement = `\n\n<!-- TIKZ_ERROR: Ù†Ù…ÙˆØ¯Ø§Ø± ${diagramName} Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¯Ø± Ù†Ø¨ÙˆØ¯ -->\n\n`;
        content = content.replace(block.full, replacement);
      }
    }
    
    return content;
  }

  /**
   * Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø±Ø§ÛŒ Pandoc
   */
  preProcessForPandoc(content) {
    return content
      // ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ tcolorbox Ø¨Ù‡ blockquote
      .replace(/\\begin\{tcolorbox\}\[([^\]]*title=\{([^}]*)\}[^\]]*)\]([\s\S]*?)\\end\{tcolorbox\}/g, 
        (_, opts, title, body) => `\n\n> **${title}**\n> ${body.trim().replace(/\n/g, '\n> ')}\n\n`)
      
      // ØªØ¨Ø¯ÛŒÙ„ itemize ÙØ§Ø±Ø³ÛŒ
      .replace(/\\begin\{itemize\}\[([^\]]*)\]/g, '\\begin{itemize}')
      
      // ØªØ¨Ø¯ÛŒÙ„ enumerate ÙØ§Ø±Ø³ÛŒ
      .replace(/\\begin\{enumerate\}\[([^\]]*)\]/g, '\\begin{enumerate}')
      
      // Ø­Ø°Ù Ú©Ø§Ù…Ù†Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù…Ø±Ø¨ÙˆØ·
      .replace(/\\renewcommand\{[^}]*\}\{[^}]*\}/g, '')
      .replace(/\\setcounter\{[^}]*\}\{[^}]*\}/g, '')
      
      // ØªØ¨Ø¯ÛŒÙ„ Ø®Ø· ØªØ²Ø¦ÛŒÙ†ÛŒ
      .replace(/\\begin\{tikzpicture\}[\s\S]*?\\draw\[line width=2pt[^\]]*\][\s\S]*?\\end\{tikzpicture\}/g, 
        '\n\n---\n\n')
      
      // Ø­Ø°Ù Ø®Ø·ÙˆØ· Ø®Ø§Ù„ÛŒ Ø§Ø¶Ø§ÙÛŒ
      .replace(/\n{4,}/g, '\n\n\n');
  }

  /**
   * Ù¾Ø³â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Markdown
   */
  postProcessMarkdown(markdown, options = {}) {
    const { lang = 'fa' } = options;
    
    let result = markdown
      // Ø­Ø°Ù Ú©Ø¯Ù‡Ø§ÛŒ TikZ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ (Ú©Ù‡ Pandoc Ù†ÙÙ‡Ù…ÛŒØ¯Ù‡)
      .replace(/\[node distance[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\[scale[\s\S]*?(?=\n\n|\n#|$)/g, '')
      .replace(/\\node[\s\S]*?;/g, '')
      .replace(/\\draw[\s\S]*?;/g, '')
      .replace(/\\begin\{scope\}[\s\S]*?\\end\{scope\}/g, '')
      .replace(/\([\w]+\)\s*\{[\s\S]*?\};/g, '')
      
      // Ø§ØµÙ„Ø§Ø­ ØªØµØ§ÙˆÛŒØ±
      .replace(/!\[(.*?)\]\((.+?)\)\{\.tikz-diagram\}/g, 
        '\n<figure class="tikz-figure">\n  <img src="$2" alt="$1" class="tikz-diagram" loading="lazy" />\n</figure>\n')
      
      // ØªØ¨Ø¯ÛŒÙ„ blockquote Ù‡Ø§ÛŒ Ø®Ø§Øµ Ø¨Ù‡ Ú©Ù„Ø§Ø³â€ŒØ¯Ø§Ø±
      .replace(/> \*\*Ø®Ù„Ø§ØµÙ‡ ÙØµÙ„\*\*/g, '> {.summary}\n> **Ø®Ù„Ø§ØµÙ‡ ÙØµÙ„**')
      .replace(/> \*\*Ù‡Ø´Ø¯Ø§Ø±/g, '> {.warning}\n> **Ù‡Ø´Ø¯Ø§Ø±')
      .replace(/> \*\*Ù†Ú©ØªÙ‡/g, '> {.note}\n> **Ù†Ú©ØªÙ‡')
      
      // Ø§ØµÙ„Ø§Ø­ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
      .replace(/\{#([\w-]+)\}/g, '')
      
      // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
      .replace(/\n{3,}/g, '\n\n')
      .trim();
    
    return result;
  }

  /**
   * ØªÙˆÙ„ÛŒØ¯ frontmatter
   */
  addFrontmatter(markdown, inputPath, options = {}) {
    const { bookSlug, chapterNumber, lang = 'fa', title } = options;
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†ÙˆØ§Ù† Ø§Ø² Ù…Ø­ØªÙˆØ§
    const titleMatch = markdown.match(/^#\s+(.+)$/m);
    const extractedTitle = titleMatch ? titleMatch[1] : path.basename(inputPath, '.tex');
    
    const frontmatter = `---
title: "${title || extractedTitle}"
description: "${title || extractedTitle}"
lang: ${lang}
${chapterNumber ? `chapterNumber: ${chapterNumber}` : ''}
${bookSlug ? `book: "${bookSlug}"` : ''}
---

`;
    
    return frontmatter + markdown;
  }

  /**
   * ØªÙˆÙ„ÛŒØ¯ Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ
   */
  generateOutputFileName(inputPath, options = {}) {
    const { chapterNumber } = options;
    const baseName = path.basename(inputPath, '.tex');
    
    if (chapterNumber) {
      return `ch${String(chapterNumber).padStart(2, '0')}-${baseName}.md`;
    }
    
    return `${baseName}.md`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨ Ú©Ø§Ù…Ù„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function processBook(bookDir, outputDir, options = {}) {
  const { lang = 'fa', slug } = options;
  const processor = new LaTeXToMarkdownProcessor();
  
  console.log(`\n${'â•'.repeat(60)}`);
  console.log(`ğŸ“š Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨: ${bookDir}`);
  console.log(`${'â•'.repeat(60)}`);
  
  // ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙØµÙ„
  const chapterFiles = await globby([
    path.join(bookDir, 'chapter*.tex'),
    path.join(bookDir, 'ch*.tex'),
    path.join(bookDir, 'ÙØµÙ„*.tex'),
  ]);
  
  // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ ÙØµÙ„â€ŒÙ‡Ø§
  chapterFiles.sort((a, b) => {
    const numA = parseInt(a.match(/\d+/)?.[0] || '0');
    const numB = parseInt(b.match(/\d+/)?.[0] || '0');
    return numA - numB;
  });
  
  console.log(`   ÛŒØ§ÙØª Ø´Ø¯: ${chapterFiles.length} ÙØµÙ„`);
  
  // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ø± ÙØµÙ„
  for (let i = 0; i < chapterFiles.length; i++) {
    const chapterFile = chapterFiles[i];
    await processor.processFile(chapterFile, outputDir, {
      bookSlug: slug,
      chapterNumber: i + 1,
      lang,
    });
  }
  
  // Ø§ÛŒØ¬Ø§Ø¯ index.md
  const indexContent = `---
title: "${slug}"
description: ""
lang: ${lang}
---

# ÙÙ‡Ø±Ø³Øª ÙØµÙˆÙ„

${chapterFiles.map((f, i) => `${i + 1}. [ÙØµÙ„ ${i + 1}](./ch${String(i + 1).padStart(2, '0')}-${path.basename(f, '.tex')})`).join('\n')}
`;
  
  await fs.writeFile(path.join(outputDir, 'index.md'), indexContent);
  
  console.log(`\nâœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨ Ú©Ø§Ù…Ù„ Ø´Ø¯!`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const args = process.argv.slice(2);

if (args.length === 0) {
  console.log(`
Ø§Ø³ØªÙØ§Ø¯Ù‡:
  
  Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„:
    node scripts/process-book.mjs <input.tex> [output-dir]
  
  Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ØªØ§Ø¨ Ú©Ø§Ù…Ù„:
    node scripts/process-book.mjs <book-directory> --book --slug=my-book --lang=fa
  
Ù…Ø«Ø§Ù„:
    node scripts/process-book.mjs content-source/books/transition-guide/ \\
      --book --slug=transition-guide --lang=fa
`);
  process.exit(1);
}

const inputPath = args[0];
const isBook = args.includes('--book');
const lang = args.find(a => a.startsWith('--lang='))?.split('=')[1] || 'fa';
const slug = args.find(a => a.startsWith('--slug='))?.split('=')[1] || path.basename(inputPath);

(async () => {
  try {
    if (isBook) {
      const outputDir = `src/content/books/${lang}/${slug}`;
      await processBook(inputPath, outputDir, { lang, slug });
    } else {
      const processor = new LaTeXToMarkdownProcessor();
      const outputDir = args[1] || `src/content/articles/${lang}`;
      await processor.processFile(inputPath, outputDir, { lang });
    }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§:', error);
    process.exit(1);
  }
})();

export { LaTeXToMarkdownProcessor, TikZProcessor, processBook };
```

### Û³. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Astro Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§

**ÙØ§ÛŒÙ„ `src/components/TikzDiagram.astro`:**

```astro
---
interface Props {
  src: string;
  alt?: string;
  caption?: string;
  class?: string;
}

const { src, alt = 'Ù†Ù…ÙˆØ¯Ø§Ø±', caption, class: className = '' } = Astro.props;
---

<figure class={`tikz-figure ${className}`}>
  <img 
    src={src} 
    alt={alt}
    class="tikz-diagram"
    loading="lazy"
    decoding="async"
  />
  {caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
  .tikz-figure {
    margin: 2rem auto;
    text-align: center;
  }
  
  .tikz-diagram {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }
   
  figcaption {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: #6b7280;
  }
  
  /* Dark mode */
  :global(.dark) .tikz-diagram {
    filter: invert(0.9) hue-rotate(180deg);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
  }
  
  :global(.dark) figcaption {
    color: #9ca3af;
  }
</style>
```

---

### Û´. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Mermaid

**ÙØ§ÛŒÙ„ `src/components/MermaidDiagram.astro`:**

```astro
---
interface Props {
  chart: string;
  caption?: string;
  theme?: 'default' | 'dark' | 'forest' | 'neutral';
}

const { chart, caption, theme = 'neutral' } = Astro.props;
const id = `mermaid-${Math.random().toString(36).substr(2, 9)}`;
---

<figure class="mermaid-figure">
  <div class="mermaid-wrapper">
    <pre id={id} class="mermaid" data-theme={theme}>
      {chart}
    </pre>
  </div>
  {caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
  .mermaid-figure {
    margin: 2rem auto;
    text-align: center;
    direction: ltr;
  }
  
  .mermaid-wrapper {
    overflow-x: auto;
    padding: 1rem;
    background: #fafafa;
    border-radius: 8px;
  }
  
  :global(.dark) .mermaid-wrapper {
    background: #1e293b;
  }
  
  .mermaid {
    display: flex;
    justify-content: center;
  }
  
  figcaption {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: #6b7280;
    direction: rtl;
  }
</style>
```

---

### Ûµ. Layout Ø¨Ù‡â€ŒØ±ÙˆØ²Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§Ù„Ø§Øª

**ÙØ§ÛŒÙ„ `src/layouts/ArticleLayout.astro`:**

```astro
---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description?: string;
  pubDate?: Date;
  updatedDate?: Date;
  heroImage?: string;
  lang?: 'fa' | 'en';
  tags?: string[];
  chapterNumber?: number;
  book?: string;
}

const { 
  title, 
  description, 
  pubDate, 
  updatedDate, 
  heroImage,
  lang = 'fa',
  tags = [],
  chapterNumber,
  book
} = Astro.props;

const isRTL = lang === 'fa';
---

<!DOCTYPE html>
<html lang={lang} dir={isRTL ? 'rtl' : 'ltr'}>
<head>
  <BaseHead title={title} description={description} image={heroImage} />
  
  <!-- KaTeX Ø¨Ø±Ø§ÛŒ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ§Ø¶ÛŒ -->
  <link 
    rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    crossorigin="anonymous"
  />
  
  <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
  <link 
    href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" 
    rel="stylesheet" 
  />
  
  <style is:global>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ RTL                                         */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      --font-persian: 'Vazirmatn', system-ui, sans-serif;
      --font-english: 'Inter', system-ui, sans-serif;
      
      /* Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ ØªÙ… Ø´Ù…Ø§ */
      --color-primary: #1a73e8;
      --color-primary-light: #e8f4f8;
      --color-success: #34a853;
      --color-success-light: #e8f8ed;
      --color-warning: #fbbc04;
      --color-danger: #ea4335;
      --color-danger-light: #fcedec;
      --color-purple: #8e44ad;
      --color-purple-light: #f5eef8;
    }
    
    body {
      font-family: var(--font-persian);
    }
    
    [dir="rtl"] {
      text-align: right;
    }
    
    [dir="ltr"] {
      text-align: left;
      font-family: var(--font-english);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ùˆ ØªØµØ§ÙˆÛŒØ± (Ù‡Ù…ÛŒØ´Ù‡ LTR)                               */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .tikz-figure,
    .mermaid-figure,
    .chart-container {
      direction: ltr !important;
      text-align: center !important;
      margin: 2rem auto;
      max-width: 100%;
      overflow-x: auto;
    }
    
    .tikz-figure figcaption,
    .mermaid-figure figcaption {
      direction: rtl;
      text-align: center;
    }
    
    .tikz-diagram {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ø¬Ø¯Ø§ÙˆÙ„                                                       */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 0.95rem;
    }
    
    th, td {
      border: 1px solid #e2e8f0;
      padding: 0.75rem 1rem;
    }
    
    [dir="rtl"] th,
    [dir="rtl"] td {
      text-align: right;
    }
    
    th {
      background: #f8fafc;
      font-weight: 600;
    }
    
    tr:nth-child(even) {
      background: #fafafa;
    }
    
    /* Dark mode tables */
    .dark th {
      background: #1e293b;
    }
    
    .dark td {
      border-color: #334155;
    }
    
    .dark tr:nth-child(even) {
      background: #1e293b;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ (Callouts)                                     */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    blockquote {
      border-right: 4px solid var(--color-primary);
      border-left: none;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      background: var(--color-primary-light);
      border-radius: 0 8px 8px 0;
    }
    
    [dir="ltr"] blockquote {
      border-left: 4px solid var(--color-primary);
      border-right: none;
      border-radius: 8px 0 0 8px;
    }
    
    blockquote.summary {
      border-color: var(--color-primary);
      background: var(--color-primary-light);
    }
    
    blockquote.warning {
      border-color: var(--color-danger);
      background: var(--color-danger-light);
    }
    
    blockquote.note {
      border-color: var(--color-success);
      background: var(--color-success-light);
    }
    
    blockquote.strategy {
      border-color: var(--color-purple);
      background: var(--color-purple-light);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ú©Ø¯                                                          */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    pre, code {
      direction: ltr !important;
      text-align: left !important;
      font-family: 'Fira Code', 'JetBrains Mono', monospace;
    }
    
    pre {
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
    }
    
    :not(pre) > code {
      background: #f1f5f9;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .dark :not(pre) > code {
      background: #334155;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ§Ø¶ÛŒ                                              */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .katex-display {
      direction: ltr !important;
      overflow-x: auto;
      padding: 1rem 0;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§                                                      */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    [dir="rtl"] ul,
    [dir="rtl"] ol {
      padding-right: 1.5rem;
      padding-left: 0;
    }
    
    [dir="rtl"] li::marker {
      unicode-bidi: isolate;
    }
  </style>
</head>

<body class="bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen">
  <Header lang={lang} />
  
  <main class="max-w-4xl mx-auto px-4 py-8">
    <article class="article-content">
      <!-- Ù‡Ø¯Ø± Ù…Ù‚Ø§Ù„Ù‡ -->
      <header class="mb-8 pb-8 border-b border-slate-200 dark:border-slate-700">
        {book && chapterNumber && (
          <div class="text-sm text-slate-500 dark:text-slate-400 mb-2">
            <a href={`/books/${lang}/${book}`} class="hover:text-primary">
              {book}
            </a>
            <span class="mx-2">â€º</span>
            <span>ÙØµÙ„ {chapterNumber}</span>
          </div>
        )}
        
        <h1 class="text-3xl md:text-4xl font-bold mb-4 leading-tight">
          {title}
        </h1>
        
        {description && (
          <p class="text-lg text-slate-600 dark:text-slate-300 mb-4">
            {description}
          </p>
        )}
        
        <div class="flex flex-wrap items-center gap-4 text-sm text-slate-500 dark:text-slate-400">
          {pubDate && (
            <time datetime={pubDate.toISOString()}>
              ğŸ“… {pubDate.toLocaleDateString(lang === 'fa' ? 'fa-IR' : 'en-US')}
            </time>
          )}
          
          {updatedDate && (
            <span>
              ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {updatedDate.toLocaleDateString(lang === 'fa' ? 'fa-IR' : 'en-US')}
            </span>
          )}
        </div>
        
        {tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-4">
            {tags.map(tag => (
              <a 
                href={`/${lang === 'fa' ? '' : 'en/'}tags/${tag}`}
                class="px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-full text-sm hover:bg-primary hover:text-white transition-colors"
              >
                #{tag}
              </a>
            ))}
          </div>
        )}
      </header>
      
      <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
      <div class="prose prose-lg dark:prose-invert max-w-none
                  prose-headings:font-bold
                  prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-6
                  prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-4
                  prose-p:leading-relaxed prose-p:mb-4
                  prose-li:my-1
                  prose-img:rounded-lg prose-img:shadow-md">
        <slot />
      </div>
    </article>
  </main>
  
  <Footer lang={lang} />
  
  <!-- Mermaid.js -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    
    const isDark = document.documentElement.classList.contains('dark') ||
                   window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    mermaid.initialize({
      startOnLoad: true,
      theme: isDark ? 'dark' : 'neutral',
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        curve: 'basis'
      },
      fontFamily: 'Vazirmatn, sans-serif',
      securityLevel: 'loose'
    });
    
    // Re-render Ø§Ú¯Ø± ØªÙ… Ø¹ÙˆØ¶ Ø´Ø¯
    document.addEventListener('theme-changed', () => {
      location.reload();
    });
  </script>
  
  <!-- KaTeX auto-render -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (typeof renderMathInElement !== 'undefined') {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError: false
        });
      }
    });
  </script>
</body>
</html>
```

---

### Û¶. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ `package.json`

```json
{
  "name": "your-site",
  "type": "module",
  "scripts": {
    "dev": "astro dev",
    "build": "npm run process:all && astro build",
    "preview": "astro preview",
    
    "process:all": "npm run process:books && npm run process:articles",
    "process:books": "node scripts/process-all-books.mjs",
    "process:articles": "node scripts/process-all-articles.mjs",
    
    "process:book": "node scripts/process-book.mjs",
    "process:file": "node scripts/process-book.mjs",
    
    "clean:diagrams": "rm -rf public/diagrams/*",
    "clean:generated": "rm -rf src/content/**/generated-*"
  },
  "dependencies": {
    "astro": "^4.0.0",
    "@astrojs/tailwind": "^5.0.0",
    "@astrojs/mdx": "^2.0.0"
  },
  "devDependencies": {
    "globby": "^14.0.0",
    "gray-matter": "^4.0.3",
    "tailwindcss": "^4.0.0"
  }
}
```

---

### Û·. Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§

**ÙØ§ÛŒÙ„ `scripts/process-all-books.mjs`:**

```javascript
#!/usr/bin/env node
/**
 * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± content-source
 */

import { globby } from 'globby';
import path from 'path';
import { processBook } from './process-book.mjs';

async function processAllBooks() {
  console.log('ğŸ“š Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§...\n');
  
  // ÛŒØ§ÙØªÙ† Ù‡Ù…Ù‡ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©ØªØ§Ø¨
  const bookDirs = await globby('content-source/books/*', { 
    onlyDirectories: true 
  });
  
  console.log(`ÛŒØ§ÙØª Ø´Ø¯: ${bookDirs.length} Ú©ØªØ§Ø¨\n`);
  
  for (const bookDir of bookDirs) {
    const slug = path.basename(bookDir);
    
    // ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù† Ø§Ø² Ù†Ø§Ù… ÛŒØ§ Ù…Ø­ØªÙˆØ§
    const lang = bookDir.includes('/en/') ? 'en' : 'fa';
    
    const outputDir = `src/content/books/${lang}/${slug}`;
    
    try {
      await processBook(bookDir, outputDir, { lang, slug });
    } catch (error) {
      console.error(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ ${slug}:`, error.message);
    }
  }
  
  console.log('\nâœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯!');
}

processAllBooks().catch(console.error);
```

---

## ğŸš€ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ú¯Ø§Ù… Û±: Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

```bash
#Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…

#macOS
brew install texlive-full pdf2svg

#Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y \
  texlive-full \
  texlive-xetex \
  texlive-lang-arabic \
  pdf2svg \
  fonts-vazirmatn

#Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Node
npm install
```

### Ú¯Ø§Ù… Û²: Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ LaTeX

```
content-source/
â””â”€â”€ books/
    â””â”€â”€ transition-guide/           # Ú©ØªØ§Ø¨ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú¯Ø°Ø§Ø±
        â”œâ”€â”€ main.tex                # ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        â”œâ”€â”€ chapter1.tex            # ÙØµÙ„ Û±
        â”œâ”€â”€ chapter2.tex            # ÙØµÙ„ Û²
        â”œâ”€â”€ ...
        â””â”€â”€ images/                 # ØªØµØ§ÙˆÛŒØ± Ø§ØµÙ„ÛŒ
```

### Ú¯Ø§Ù… Û³: Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø­ØªÙˆØ§

```bash
# Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© Ú©ØªØ§Ø¨
npm run process:book content-source/books/transition-guide/ \
  --book --slug=transition-guide --lang=fa

# Ù¾Ø±Ø¯Ø§Ø²Ø´ ÛŒÚ© ÙØ§ÛŒÙ„ ØªÚ©ÛŒ
npm run process:file content-source/articles/my-article.tex \
  src/content/articles/fa/

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ù‡ Ù…Ø­ØªÙˆØ§
npm run process:all

# Build Ù†Ù‡Ø§ÛŒÛŒ
npm run build
```

### Ú¯Ø§Ù… Û´: Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÙˆØ¬ÛŒ

```bash
#Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø­Ù„ÛŒ
npm run dev

#Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±
open http://localhost:4321/books/fa/transition-guide/
```

---

## ğŸ”§ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬

### Ù…Ø´Ú©Ù„ Û±: ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ ÙÙˆÙ†Øª
fc-list | grep -i vazir

# Ù†ØµØ¨ ÙÙˆÙ†Øª
# macOS
brew tap homebrew/cask-fonts
brew install font-vazirmatn

# Ubuntu
sudo apt-get install fonts-vazirmatn
```

### Ù…Ø´Ú©Ù„ Û²: Ø®Ø·Ø§ÛŒ XeLaTeX

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨
which xelatex

# Ù†ØµØ¨ Ú©Ø§Ù…Ù„ TeXLive
# macOS
brew install --cask mactex-no-gui

# Ubuntu
sudo apt-get install texlive-full
```

### Ù…Ø´Ú©Ù„ Û³: Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ TikZ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª

Ø¯Ø± ÙØ§ÛŒÙ„ `scripts/process-book.mjs`ØŒ Ø¨Ø®Ø´ `buildStandaloneTeX` Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯:

```javascript
buildStandaloneTeX(tikzCode, options = {}) {
  return `
\\documentclass[tikz,border=15pt]{standalone}
\\usepackage{tikz}
\\usetikzlibrary{
  shapes.geometric,
  arrows.meta,
  positioning,
  calc,
  backgrounds,
  fit,
  decorations.pathreplacing,
  shadows,
  trees,
  mindmap,          % Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
  calendar,         % Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
  matrix            % Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
}
% ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
`;
}
```

---

## ğŸ“Š Ø®Ù„Ø§ØµÙ‡ Ø±Ø§Ù‡â€ŒØ­Ù„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ø®Ù„Ø§ØµÙ‡ Ø±Ø§Ù‡â€ŒØ­Ù„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  âœ… Ù…Ø´Ú©Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯:                                             â”‚
â”‚     Pandoc Ú©Ø¯Ù‡Ø§ÛŒ TikZ Ø±Ø§ Ù†Ù…ÛŒâ€ŒÙÙ‡Ù…Ø¯ Ùˆ Ø®Ø±Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯                   â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ø±Ø§Ù‡â€ŒØ­Ù„:                                                       â”‚
â”‚     Pre-processor Ú©Ù‡ TikZ Ø±Ø§ Ù‚Ø¨Ù„ Ø§Ø² Pandoc Ø¨Ù‡ SVG ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†Ø¯     â”‚
â”‚                                                                   â”‚
â”‚  âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ:                                               â”‚
â”‚     1. scripts/process-book.mjs      â†’ Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± Ø§ØµÙ„ÛŒ            â”‚
â”‚     2. scripts/color-definitions.tex â†’ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ           â”‚
â”‚     3. src/layouts/ArticleLayout.astro â†’ Layout Ø¨Ø§ RTL          â”‚
â”‚                                                                   â”‚
â”‚  âœ… Ø¯Ø³ØªÙˆØ± Ø§Ø¬Ø±Ø§:                                                   â”‚
â”‚     npm run process:all && npm run build                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



# Ø³Ø§ÛŒØ±
